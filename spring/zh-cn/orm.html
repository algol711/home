<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>&#31532;&nbsp;11&nbsp;&#31456;&nbsp;&#20351;&#29992;ORM&#24037;&#20855;&#36827;&#34892;&#25968;&#25454;&#35775;&#38382; </title><link rel="stylesheet" href="../styles/html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.65.1"><link rel="home" href="index.html" title="Spring - Java/J2EE Application Framework"><link rel="up" href="index.html" title="Spring - Java/J2EE Application Framework"><link rel="previous" href="jdbc.html" title="&#31532;&nbsp;10&nbsp;&#31456;&nbsp;&#20351;&#29992;JDBC&#36827;&#34892;&#25968;&#25454;&#35775;&#38382;"><link rel="next" href="mvc.html" title="&#31532;&nbsp;12&nbsp;&#31456;&nbsp;Web&#26694;&#26550;"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">&#31532;&nbsp;11&nbsp;&#31456;&nbsp;&#20351;&#29992;ORM&#24037;&#20855;&#36827;&#34892;&#25968;&#25454;&#35775;&#38382; </th></tr><tr><td width="20%" align="left"><a accesskey="p" href="jdbc.html">&#19978;&#19968;&#39029;</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="mvc.html">&#19979;&#19968;&#39029;</a></td></tr></table><hr></div><div class="chapter" lang="zh_cn"><div class="titlepage"><div><div><h2 class="title"><a name="orm"></a>&#31532;&nbsp;11&nbsp;&#31456;&nbsp;&#20351;&#29992;ORM&#24037;&#20855;&#36827;&#34892;&#25968;&#25454;&#35775;&#38382; </h2></div></div><div></div></div><div class="sect1" lang="zh_cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="orm-introducion"></a>11.1.&nbsp;&#31616;&#20171;</h2></div></div><div></div></div><p>Spring&#22312;&#36164;&#28304;&#31649;&#29702;&#65292;DAO&#23454;&#29616;&#25903;&#25345;&#20197;&#21450;&#23454;&#29289;&#31574;&#30053;&#31561;&#26041;&#38754;&#25552;&#20379;&#20102;&#19982;Hibernate, JDO&#21644;iBATIS SQL&#26144;&#23556;&#30340;&#38598;&#25104;&#12290; &#23545;Hibernate&#65292;Spring&#20351;&#29992;&#20102;&#24456;&#22810;IoC&#30340;&#26041;&#20415;&#30340;&#29305;&#24615;&#25552;&#20379;&#20102;&#19968;&#27969;&#30340;&#25903;&#25345;&#65292;&#24110;&#21161;&#20320;&#22788;&#29702;&#24456;&#22810;&#20856;&#22411;&#30340;Hibernate&#25972;&#21512;&#30340;&#38382;&#39064;&#12290;&#25152;&#26377;&#30340;&#36825;&#20123;&#37117;&#36981;&#23432;Spring&#36890;&#29992;&#30340;&#20107;&#21153;&#21644;DAO&#24322;&#24120;&#20307;&#31995;.</p><p>
    &#24403;&#24744;&#36873;&#25321;&#20351;&#29992;O/R&#26144;&#23556;&#26469;&#21019;&#24314;&#25968;&#25454;&#35775;&#38382;&#24212;&#29992;&#31243;&#24207;&#30340;&#26102;&#20505;&#65292;Spring&#30340;&#22686;&#21152;&#37096;&#20998;&#23601;&#20250;&#21521;&#24744;&#25552;&#20379;&#37325;&#35201;&#30340;&#25903;&#25345;&#12290;&#39318;&#20808;&#20320;&#24212;&#35813;&#20102;&#35299;&#30340;&#26159;&#65292;&#19968;&#26086;&#20320;&#20351;&#29992;&#20102;Spring&#23545;O/R&#26144;&#23556;&#30340;&#25903;&#25345;&#65292;&#20320;&#19981;&#38656;&#35201;&#20146;&#33258;&#20316;&#25152;&#26377;&#30340;&#20107;&#24773;&#12290;&#22312;&#20915;&#23450;&#33457;&#36153;&#21147;&#27668;&#65292;&#20882;&#30528;&#39118;&#38505;&#24314;&#36896;&#31867;&#20284;&#30340;&#20869;&#37096;&#24213;&#23618;&#32467;&#26500;&#20043;&#21069;&#65292;&#25105;&#20204;&#37117;&#24314;&#35758;&#24744;&#32771;&#34385;&#21644;&#21033;&#29992;Spring&#30340;&#35299;&#20915;&#26041;&#26696;&#12290;&#19981;&#31649;&#20320;&#20351;&#29992;&#30340;&#26159;&#20309;&#31181;&#25216;&#26415;&#65292;&#22823;&#37096;&#20998;&#30340;O/R&#26144;&#23556;&#25903;&#25345;&#37117;&#21487;&#20197;&#20197;library&#26679;&#24335;&#34987;&#20351;&#29992;&#65292;&#22240;&#20026;&#25152;&#26377;&#30340;&#19996;&#35199;&#37117;&#26159;&#34987;&#35774;&#35745;&#25104;&#19968;&#32452;&#21487;&#37325;&#22797;&#21033;&#29992;&#30340;JavaBeans&#12290;&#22312;ApplicationContext&#21644;BeanFactory&#20013;&#20351;&#29992;&#26356;&#26159;&#25552;&#20379;&#20102;&#37197;&#32622;&#21644;&#37096;&#32626;&#31616;&#21333;&#30340;&#22909;&#22788;&#65292;&#22240;&#27492;&#65292;&#36825;&#19968;&#31456;&#37324;&#30340;&#22823;&#22810;&#25968;&#20363;&#23376;&#37117;&#26159;&#22312;ApplicationContext&#20013;&#37197;&#32622;&#12290;
    </p><p>
    &#20351;&#29992;Spring&#26500;&#24314;&#20320;&#30340;ORM&#24212;&#29992;&#30340;&#22909;&#22788;&#21253;&#25324;:
    </p><div class="itemizedlist"><ul type="disc"><li><p>
        <span class="emphasis"><em>&#36991;&#20813;&#32465;&#23450;&#29305;&#27530;&#30340;&#25216;&#26415;&#65292;&#20801;&#35768;mix-and-match&#30340;&#23454;&#29616;&#31574;&#30053;&#12290;</em></span>
        &#34429;&#28982;Hibernate&#38750;&#24120;&#24378;&#22823;&#65292;&#28789;&#27963;&#65292;&#24320;&#28304;&#32780;&#19988;&#20813;&#36153;&#65292;&#20294;&#23427;&#36824;&#26159;&#20351;&#29992;&#20102;&#33258;&#24049;&#30340;&#29305;&#23450;&#30340;API&#12290;&#27492;&#22806;&#26377;&#20154;&#20063;&#35768;&#20250;&#20105;&#36777;&#65306;iBatis&#26356;&#36731;&#20415;&#32780;&#19988;&#22312;&#19981;&#38656;&#35201;&#22797;&#26434;&#30340;O/R&#26144;&#23556;&#31574;&#30053;&#30340;&#24212;&#29992;&#20013;&#20351;&#29992;&#20063;&#24456;&#20248;&#31168;&#12290;&#33021;&#22815;&#36873;&#25321;&#30340;&#35805;&#65292;&#20351;&#29992;&#26631;&#20934;&#25110;&#25277;&#35937;&#30340;API&#26469;&#23454;&#29616;&#20027;&#35201;&#30340;&#24212;&#29992;&#38656;&#27714;&#65292;&#36890;&#24120;&#26159;&#26356;&#22909;&#30340;&#12290;&#23588;&#20854;&#65292;&#24403;&#20320;&#21487;&#33021;&#20250;&#22240;&#20026;&#21151;&#33021;&#65292;&#24615;&#33021;&#25110;&#20854;&#20182;&#26041;&#38754;&#30340;&#21407;&#22240;&#32780;&#38656;&#35201;&#20999;&#25442;&#21040;&#21478;&#19968;&#20010;&#23454;&#29616;&#30340;&#26102;&#20505;&#12290;&#20030;&#20363;&#26469;&#35828;&#65292;Spring&#23545;Hibernate&#20107;&#21153;&#21644;&#24322;&#24120;&#30340;&#25277;&#35937;&#65292;&#20197;&#21450;&#33021;&#22815;&#35753;&#20320;&#36731;&#26494;&#20132;&#25442;mapper&#21644;DAO&#23545;&#35937;&#65288;&#23454;&#29616;&#25968;&#25454;&#35775;&#38382;&#21151;&#33021;&#65289;&#30340;IoC&#26426;&#21046;&#65292;&#36825;&#20004;&#20010;&#29305;&#24615;&#21487;&#20197;&#35753;&#20320;&#22312;&#19981;&#29306;&#29298;Hibernate&#24615;&#33021;&#30340;&#24773;&#20917;&#19979;&#65292;&#22312;&#20320;&#30340;&#24212;&#29992;&#31243;&#24207;&#20013;&#38548;&#31163;Hibernate&#30340;&#30456;&#20851;&#20195;&#30721;&#12290;&#22788;&#29702;DAO&#30340;&#39640;&#23618;&#27425;&#30340;service&#20195;&#30721;&#19981;&#38656;&#35201;&#30693;&#36947;DAO&#30340;&#20855;&#20307;&#23454;&#29616;&#12290;&#36825;&#20010;&#26041;&#27861;&#21487;&#20197;&#24456;&#23481;&#26131;&#20351;&#29992;mix-and-match&#26041;&#26696;&#20114;&#19981;&#24178;&#25200;&#22320;&#23454;&#29616;&#25968;&#25454;&#35775;&#38382;&#23618;&#65288;&#27604;&#22914;&#22312;&#19968;&#20123;&#22320;&#26041;&#29992;Hibernate&#65292;&#19968;&#20123;&#22320;&#26041;&#20351;&#29992;JDBC&#65292;&#20854;&#20182;&#22320;&#26041;&#20351;&#29992;iBatis&#65289;&#65292;mix-and-match&#26377;&#21033;&#20110;&#22788;&#29702;&#36951;&#30041;&#19979;&#26469;&#30340;&#20195;&#30721;&#20197;&#21450;&#21033;&#29992;&#21508;&#31181;&#25216;&#26415;&#65288;JDBC,Hibernate,iBatis&#65289;&#30340;&#38271;&#22788;.
        </p></li><li><p>
       <span class="emphasis"><em> &#27979;&#35797;&#31616;&#21333;</em></span>.
       Spring&#30340;IoC&#20351;&#24471;&#24456;&#23481;&#26131;&#26367;&#25442;&#25481;&#19981;&#21516;&#30340;&#23454;&#29616;&#65292;Hibernate SessionFacotory&#30340;&#20301;&#32622;&#65292;datasource, &#20107;&#21153;&#31649;&#29702;, &#26144;&#23556;&#23545;&#35937;&#30340;&#23454;&#29616;&#12290;&#36825;&#26679;&#23601;&#24456;&#23481;&#26131;&#38548;&#31163;&#27979;&#35797;&#25345;&#20037;&#21270;&#30456;&#20851;&#20195;&#30721;&#30340;&#21508;&#20010;&#37096;&#20998;&#12290;
        </p></li><li><p>
     
        <span class="emphasis"><em>&#36890;&#29992;&#30340;&#36164;&#28304;&#31649;&#29702;</em></span>&#12290;
        Spring&#30340;application context&#33021;&#22815;&#22788;&#29702;&#35832;&#22914;Hibernate &#30340;SessionFactory&#65292; JDBC&#30340;datasource&#65292;iBatis&#30340;SQLMaps&#37197;&#32622;&#23545;&#35937;&#20197;&#21450;&#20854;&#20182;&#30456;&#20851;&#36164;&#28304;&#30340;&#23450;&#20301;&#21644;&#37197;&#32622;&#12290;&#36825;&#20351;&#24471;&#36825;&#20123;&#37197;&#32622;&#30340;&#20540;&#24456;&#23481;&#26131;&#34987;&#31649;&#29702;&#21644;&#20462;&#25913;&#12290;Spring&#25552;&#20379;&#20102;&#26377;&#25928;&#65292;&#31616;&#21333;&#21644;&#23433;&#20840;&#30340;Hibernate Session&#22788;&#29702;&#12290;&#19968;&#33324;&#30340;&#20351;&#29992;Hibernate&#30340;&#20195;&#30721;&#21017;&#38656;&#35201;&#20351;&#29992;&#21516;&#19968;&#20010;Hibernate Session&#23545;&#35937;&#20197;&#30830;&#20445;&#26377;&#25928;&#21644;&#24688;&#24403;&#22320;&#20107;&#21153;&#22788;&#29702;&#12290;&#32780;Spring&#35753;&#25105;&#20204;&#21487;&#20197;&#24456;&#23481;&#26131;&#36879;&#26126;&#22320;&#21019;&#24314;&#21644;&#32465;&#23450;&#19968;&#20010;session&#21040;&#24403;&#21069;&#32447;&#31243;&#65307;&#20320;&#21487;&#20197;&#20351;&#29992;&#20197;&#19979;&#20004;&#31181;&#21150;&#27861;&#20043;&#19968;&#65306;&#22768;&#26126;&#24335;&#30340;AOP&#26041;&#27861;&#25318;&#25130;&#22120;&#65292;&#25110;&#36890;&#36807;&#20351;&#29992;&#19968;&#20010;&#22806;&#37096;&#30340;template&#21253;&#35013;&#31867;&#22312;Java&#20195;&#30721;&#23618;&#27425;&#23454;&#29616;&#12290;&#36825;&#26679;&#65292;Spring&#23601;&#35299;&#20915;&#20102;&#22312;&#24456;&#22810;Hibernate&#35770;&#22363;&#19978;&#20986;&#29616;&#30340;&#20351;&#29992;&#38382;&#39064;&#12290;
        </p></li><li><p><span class="emphasis"><em>&#24322;&#24120;&#21253;&#35013;</em></span>&#12290;
        Spring&#33021;&#22815;&#21253;&#35013;Hibernate&#24322;&#24120;&#65292;&#25226;&#23427;&#20204;&#20174;&#19987;&#26377;&#30340;&#65292;checked exception&#21464;&#20026;&#19968;&#32452;&#25277;&#35937;&#30340;runtime exception&#12290;&#36825;&#26679;&#20320;&#23601;&#21487;&#20197;&#20165;&#20165;&#22312;&#24688;&#24403;&#30340;&#23618;&#22788;&#29702;&#22823;&#37096;&#20998;&#30340;&#19981;&#21487;&#24674;&#22797;&#30340;&#24322;&#24120;&#65292;&#20351;&#20320;&#36991;&#20813;&#20102;&#24456;&#22810;&#35752;&#21388;&#30340;catch/throw&#20197;&#21450;&#24322;&#24120;&#22768;&#26126;&#12290;&#20320;&#36824;&#26159;&#21487;&#20197;&#22312;&#20320;&#38656;&#35201;&#30340;&#22320;&#26041;&#25429;&#25417;&#21644;&#22788;&#29702;&#24322;&#24120;&#12290;&#22238;&#24819;&#19968;&#19979;JDBC&#24322;&#24120;&#65288;&#21253;&#25324;&#19982;DB&#30456;&#20851;&#30340;&#26041;&#35328;&#65289;&#34987;&#36716;&#21464;&#20026;&#21516;&#26679;&#30340;&#24322;&#24120;&#20307;&#31995;&#65292;&#36825;&#23601;&#24847;&#21619;&#30528;&#20320;&#21487;&#20197;&#22312;&#19968;&#33268;&#30340;&#32534;&#31243;&#27169;&#22411;&#20013;&#22788;&#29702;JDBC&#25805;&#20316;&#12290;
        </p></li><li><p><span class="emphasis"><em>&#32508;&#21512;&#30340;&#20107;&#21153;&#31649;&#29702;</em></span> &#12290;
        Spring&#20801;&#35768;&#20320;&#21253;&#35013;&#20320;&#30340;ORM&#20195;&#30721;&#65292;&#36890;&#36807;&#20351;&#29992;&#22768;&#26126;&#24335;&#30340;AOP&#26041;&#27861;&#25318;&#25130;&#22120;&#25110;&#32773;&#22312;&#20195;&#30721;&#32423;&#21035;&#20351;&#29992;&#22806;&#37096;&#30340;template&#21253;&#35013;&#31867;&#12290;&#19981;&#31649;&#20351;&#29992;&#21738;&#19968;&#31181;&#65292;&#20107;&#21153;&#30456;&#20851;&#30340;&#35821;&#20041;&#37117;&#20250;&#20026;&#20320;&#22788;&#29702;&#65292;&#19975;&#19968;&#26377;&#24322;&#24120;&#21457;&#29983;&#20063;&#20250;&#24110;&#20320;&#20570;&#36866;&#24403;&#30340;&#20107;&#21153;&#25805;&#20316;&#65288;&#27604;&#22914;rollback&#65289;&#12290;&#23601;&#35937;&#25105;&#20204;&#19979;&#38754;&#35201;&#35752;&#35770;&#30340;&#19968;&#26679;&#65292;&#20320;&#33021;&#22815;&#20351;&#29992;&#21644;&#26367;&#25442;&#21508;&#31181;transaction managers&#65292;&#21364;&#19981;&#20250;&#20351;&#20320;&#30340;Hibernate&#30456;&#20851;&#30340;&#20195;&#30721;&#21463;&#21040;&#24433;&#21709;&#12290;&#26356;&#22909;&#30340;&#26159;&#65292;JDBC&#30456;&#20851;&#30340;&#20195;&#30721;&#21487;&#20197;&#23436;&#20840;&#21644;Hibernate&#20195;&#30721;integrate transactionaly&#12290;&#36825;&#23545;&#20110;&#22788;&#29702;&#37027;&#20123;&#27809;&#26377;&#29992;Hibernate&#25110;iBatis&#23454;&#29616;&#30340;&#21151;&#33021;&#38750;&#24120;&#26377;&#29992;&#12290;
				</p></li></ul></div></div><div class="sect1" lang="zh_cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="orm-hibernate"></a>11.2.&nbsp;Hibernate</h2></div></div><div></div></div><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="d0e5608"></a>11.2.1.&nbsp;&#36164;&#28304;&#31649;&#29702; </h3></div></div><div></div></div><p>
      &#20856;&#22411;&#30340;&#24212;&#29992;&#32463;&#24120;&#20250;&#34987;&#37325;&#22797;&#30340;&#36164;&#28304;&#31649;&#29702;&#20195;&#30721;&#25630;&#32993;&#20081;&#12290;
      &#24456;&#22810;&#39033;&#30446;&#23581;&#35797;&#21019;&#36896;&#33258;&#24049;&#30340;&#26041;&#26696;&#35299;&#20915;&#36825;&#20010;&#38382;&#39064;&#65292;&#26377;&#26102;&#20250;&#20026;&#20102;&#32534;&#31243;&#26041;&#20415;&#29306;&#29298;&#36866;&#24403;&#30340;&#25925;&#38556;&#22788;&#29702;&#12290;
      &#23545;&#20110;&#24688;&#24403;&#30340;&#36164;&#28304;&#22788;&#29702;Spring&#25552;&#20513;&#20196;&#20154;&#30633;&#30446;&#30340;&#31616;&#21333;&#30340;&#35299;&#20915;&#26041;&#26696;&#65306;&#20351;&#29992;templating&#30340;IoC&#65292;
      &#27604;&#22914;&#22522;&#30784;&#30340;class&#21644;&#22238;&#35843;&#25509;&#21475;&#65292;&#25110;&#32773;&#25552;&#20379;AOP&#25318;&#25130;&#22120;&#12290;&#22522;&#30784;&#30340;&#31867;&#36127;&#36131;&#22266;&#23450;&#30340;&#36164;&#28304;&#22788;&#29702;&#65292;
      &#20197;&#21450;&#23558;&#29305;&#23450;&#30340;&#24322;&#24120;&#36716;&#25442;&#20026;unchecked&#24322;&#24120;&#20307;&#31995;&#12290;Spring&#24341;&#36827;&#20102;DAO&#24322;&#24120;&#20307;&#31995;&#65292;&#21487;&#36866;&#29992;&#20110;&#20219;&#20309;&#25968;&#25454;&#35775;&#38382;&#31574;&#30053;&#12290;
      
      &#23545;&#20110;&#30452;&#25509;&#20351;&#29992;JDBC&#30340;&#24773;&#20917;&#65292;&#21069;&#38754;&#31456;&#33410;&#25552;&#21040;&#30340;<tt class="classname">JdbcTemplate</tt>&#31867;&#36127;&#36131;&#22788;&#29702;connection&#65292;
      &#27491;&#30830;&#22320;&#25226;<tt class="classname">SQLException</tt> &#21464;&#20026;<tt class="classname">DataAccessException</tt> &#20307;&#31995;&#65288;&#21253;&#25324;&#23558;&#19982;&#25968;&#25454;&#24211;&#30456;&#20851;&#30340;SQL&#38169;&#35823;&#20195;&#30721;&#21464;&#25104;&#26377;&#24847;&#20041;&#30340;&#24322;&#24120;&#31867;&#65289;&#12290;
      &#23427;&#21516;&#26102;&#25903;&#25345;JTA&#21644;JDBC&#20107;&#21153;&#65292;&#36890;&#36807;&#23427;&#20204;&#21508;&#33258;&#30340;Spring transaction managers&#12290; 
Spring&#21516;&#26679;&#20063;&#25552;&#20379;&#20102;&#23545;Hibernate&#21644;JDO&#30340;&#25903;&#25345;&#65306;&#19968;&#20010;<tt class="classname">HibernateTemplate</tt>/<tt class="classname">JdoTemplate</tt>&#31867;&#20284;&#20110;
<tt class="classname">JdbcTemplate</tt>&#65292;<tt class="classname">HibernateInterceptor</tt>/<tt class="classname">JdoInterceptor</tt>&#65292;&#20197;&#21450;&#19968;&#20010;Hibernate/JDO transaction manager&#12290;
&#20027;&#35201;&#30340;&#30446;&#30340;&#26159;&#65306;&#33021;&#22815;&#28165;&#26224;&#22320;&#21010;&#20998;&#24212;&#29992;&#23618;&#27425;&#32780;&#19981;&#31649;&#20351;&#29992;&#20309;&#31181;&#25968;&#25454;&#35775;&#38382;&#21644;&#20107;&#21153;&#25216;&#26415;&#65307;&#20351;&#24212;&#29992;&#23545;&#35937;&#20043;&#38388;&#30340;&#32806;&#21512;&#26494;&#25955;&#12290;
&#19994;&#21153;&#23545;&#35937;&#65288;BO&#65289;&#19981;&#20877;&#20381;&#36182;&#20110;&#25968;&#25454;&#35775;&#38382;&#21644;&#20107;&#21153;&#31574;&#30053;&#65307;&#19981;&#20877;&#26377;&#30828;&#32534;&#30721;&#30340;&#36164;&#28304;lookup&#65307;&#19981;&#20877;&#26377;&#38590;&#20110;&#26367;&#25442;&#30340;singletons
&#65307;&#19981;&#20877;&#26377;&#33258;&#23450;&#20041;&#30340;&#26381;&#21153;&#27880;&#20876;&#12290;&#19968;&#20010;&#31616;&#21333;&#19988;&#22362;&#22266;&#30340;&#26041;&#26696;&#36830;&#25509;&#20102;&#24212;&#29992;&#23545;&#35937;&#65292;&#24182;&#19988;&#20351;&#23427;&#20204;&#21487;&#37325;&#29992;&#23613;&#21487;&#33021;&#22320;&#19981;&#20381;&#36182;&#23481;&#22120;
&#12290;&#34429;&#28982;&#25152;&#26377;&#30340;&#25968;&#25454;&#35775;&#38382;&#25216;&#26415;&#37117;&#33021;&#29420;&#31435;&#20351;&#29992;&#65292;&#20294;&#26159;&#19982;Spring application context&#32467;&#21512;&#26356;&#22909;&#19968;&#20123;&#65292;
&#23427;&#25552;&#20379;&#20102;&#22522;&#20110;xml&#30340;&#37197;&#32622;&#21644;&#26222;&#36890;&#30340;&#19982;Spring &#26080;&#20851;&#30340;JavaBean&#23454;&#20363;&#12290;&#22312;&#20856;&#22411;&#30340;Spring app&#20013;&#65292;
&#24456;&#22810;&#37325;&#35201;&#30340;&#23545;&#35937;&#37117;&#26159;JavaBeans&#65306;&#25968;&#25454;&#35775;&#38382;template&#65292;&#25968;&#25454;&#35775;&#38382;&#23545;&#35937;&#65288;&#20351;&#29992;template&#65289;,transaction managers, 
&#19994;&#21153;&#23545;&#35937;&#65288;&#20351;&#29992;&#25968;&#25454;&#35775;&#38382;&#23545;&#35937;&#21644;transaction managers&#65289;&#65292;web view resolvers, web controller&#65288;&#20351;&#29992;&#19994;&#21153;&#23545;&#35937;&#65289;&#31561;&#31561;&#12290; 
      
      
     </p></div><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="d0e5637"></a>11.2.2.&nbsp;&#22312; Application Context&#20013;&#30340;Bean &#22768;&#26126;</h3></div></div><div></div></div><p>
      &#20026;&#20102;&#36991;&#20813;&#23558;&#24212;&#29992;&#23545;&#35937;&#36148;&#32039;&#30828;&#32534;&#30721;&#30340;&#36164;&#28304;lookup&#65292;
      Spring&#20801;&#35768;&#20320;&#20687;&#23450;&#20041;&#26222;&#36890;bean&#19968;&#26679;&#22312;application context&#20013;&#23450;&#20041;&#35832;&#22914;
      JDBC <tt class="classname">DataSource</tt>&#65292;Hibernate <tt class="classname">SessionFactory</tt> &#30340;&#36164;&#28304;&#12290;
      &#38656;&#35201;&#35775;&#38382;&#36825;&#20123;&#36164;&#28304;&#30340;&#24212;&#29992;&#23545;&#35937;&#21482;&#38656;&#35201;&#25345;&#26377;&#36825;&#20123;&#39044;&#23450;&#20041;&#23454;&#20363;&#30340;&#24341;&#29992;&#12290;
      &#19979;&#38754;&#30340;&#20195;&#30721;&#28436;&#31034;&#22914;&#20309;&#21019;&#24314;&#19968;&#20010;JDBC <tt class="classname">DataSource</tt>&#21644;Hibernate <tt class="classname">SessionFactory</tt> &#65306; 
      :</p><pre class="programlisting">&lt;beans&gt;

    &lt;bean id="myDataSource" class="org.springframework.jndi.JndiObjectFactoryBean"&gt;
        &lt;property name="jndiName"&gt;
            &lt;value&gt;java:comp/env/jdbc/myds&lt;/value&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

   &lt;bean id="mySessionFactory" class="org.springframework.orm.hibernate.LocalSessionFactoryBean"&gt;
       &lt;property name="mappingResources"&gt;
           &lt;list&gt;
               &lt;value&gt;product.hbm.xml&lt;/value&gt;
           &lt;/list&gt;
       &lt;/property&gt;
       &lt;property name="hibernateProperties"&gt;
           &lt;props&gt;
               &lt;prop key="hibernate.dialect"&gt;net.sf.hibernate.dialect.MySQLDialect&lt;/prop&gt;
           &lt;/props&gt;
       &lt;/property&gt;
       &lt;property name="dataSource"&gt;
           &lt;ref bean="myDataSource"/&gt;
       &lt;/property&gt;
   &lt;/bean&gt;

   ...

&lt;/beans&gt;</pre><p>
      &#20320;&#21487;&#20197;&#23558;&#19968;&#20010;JNDI&#23450;&#20301;&#30340;<tt class="classname">DataSource</tt>&#25442;&#20026;&#19968;&#20010;&#26412;&#22320;&#23450;&#20041;&#30340;&#22914;DBCP&#30340;<tt class="classname">BasicDataSource</tt>&#65292;&#22914;&#19979;&#38754;&#30340;&#20195;&#30721;&#65306;
:</p><pre class="programlisting">&lt;bean id="myDataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close"&gt;
    &lt;property name="driverClassName"&gt;
        &lt;value&gt;org.hsqldb.jdbcDriver&lt;/value&gt;
    &lt;/property&gt;
    &lt;property name="url"&gt;
        &lt;value&gt;jdbc:hsqldb:hsql://localhost:9001&lt;/value&gt;
    &lt;/property&gt;
    &lt;property name="username"&gt;
        &lt;value&gt;sa&lt;/value&gt;
    &lt;/property&gt;
    &lt;property name="password"&gt;
        &lt;value&gt;&lt;/value&gt;
    &lt;/property&gt;
&lt;/bean&gt;</pre><p>
      &#24403;&#28982;&#20320;&#20063;&#21487;&#20197;&#25226;&#26412;&#22320;&#30340;<tt class="classname">SessionFactory</tt>&#25442;&#20026;JNDI&#23450;&#20301;&#30340;&#65292;
      &#20294;&#26159;&#22914;&#26524;&#19981;&#26159;&#22312;EJB&#19978;&#19979;&#25991;&#20013;&#65292;&#36825;&#26159;&#19981;&#38656;&#35201;&#30340;&#12290;&#65288;&#26597;&#30475;&#8220;&#23481;&#22120;&#36164;&#28304; vs &#26412;&#22320;&#36164;&#28304;&#8221;&#19968;&#33410;&#65289; 
      </p></div><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="d0e5671"></a>11.2.3.&nbsp;&#21453;&#21521;&#25511;&#21046;: &#27169;&#26495;&#21644;&#22238;&#35843;&#30340;&#20351;&#29992;</h3></div></div><div></div></div><p>
      &#23545;&#20110;&#21487;&#20197;&#25104;&#20026;&#23450;&#21046;&#30340;&#25968;&#25454;&#35775;&#38382;&#23545;&#35937;&#25110;&#19994;&#21153;&#23545;&#35937;&#30340;&#26041;&#27861;&#26469;&#35828;&#65292;
      &#22522;&#26412;&#30340;&#27169;&#26495;&#32534;&#31243;&#27169;&#22411;&#30475;&#36215;&#26469;&#20687;&#19979;&#38754;&#25152;&#31034;&#30340;&#20195;&#30721;&#37027;&#26679;&#12290;
      &#23545;&#20110;&#22806;&#37096;&#23545;&#35937;&#27809;&#26377;&#20219;&#20309;&#23454;&#29616;&#29305;&#23450;&#25509;&#21475;&#30340;&#35201;&#27714;&#65292;&#23427;&#21482;&#38656;&#35201;&#25552;&#20379;&#19968;&#20010;Hibernate&#30340;<tt class="classname">SessionFactory</tt>&#12290;
      &#23427;&#21487;&#20197;&#20174;&#20219;&#20309;&#22320;&#26041;&#24471;&#21040;&#65292;&#27604;&#36739;&#36866;&#23452;&#30340;&#26041;&#27861;&#26159;&#20316;&#20026;&#20174;Spring &#30340;application context&#20013;&#24471;&#21040;&#30340;bean&#24341;&#29992;&#65306;
      &#36890;&#36807;&#31616;&#21333;&#30340;<tt class="literal">setSessionFactory</tt>&#36825;&#20010;bean&#23646;&#24615;setter&#12290;&#19979;&#38754;&#30340;&#20195;&#30721;&#26174;&#31034;&#20102;&#22312;application context&#20013;&#19968;&#20010;DAO&#30340;&#23450;&#20041;&#65292;
      &#23427;&#24341;&#29992;&#20102;&#19978;&#38754;&#23450;&#20041;&#30340;<tt class="classname">SessionFactory</tt>&#65292;&#21516;&#26102;&#23637;&#31034;&#20102;&#19968;&#20010;DAO&#26041;&#27861;&#30340;&#20855;&#20307;&#23454;&#29616;&#12290; 
      </p><pre class="programlisting">&lt;beans&gt;

    &lt;bean id="myProductDao" class="product.ProductDaoImpl"&gt;
        &lt;property name="sessionFactory"&gt;
            &lt;ref bean="mySessionFactory"/&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

    ...

&lt;/beans&gt;</pre><pre class="programlisting">public class ProductDaoImpl implements ProductDao {

    private SessionFactory sessionFactory;

    public void setSessionFactory(SessionFactory sessionFactory) {
        this.sessionFactory = sessionFactory;
    }

    public List loadProductsByCategory(final String category) {
        HibernateTemplate hibernateTemplate =
            new HibernateTemplate(this.sessionFactory);

        return (List) hibernateTemplate.execute(
            new HibernateCallback() {
                public Object doInHibernate(Session session) throws HibernateException {
                    List result = session.find(
                        "from test.Product product where product.category=?",
                        category, Hibernate.STRING);
                    // do some further stuff with the result list
                    return result;
                }
            }
        );
    }
}</pre><p>
      &#19968;&#20010;callback&#30340;&#23454;&#29616;&#33021;&#22312;&#20219;&#20309;&#30340;Hibernate&#25968;&#25454;&#35775;&#38382;&#20013;&#26377;&#25928;&#20351;&#29992;&#12290;
      <tt class="classname">HibernateTemplate</tt>&#20250;&#30830;&#20445;<tt class="classname">Session</tt>&#27491;&#30830;&#30340;&#25171;&#24320;&#21644;&#20851;&#38381;&#65292;&#24182;&#19988;&#20250;&#33258;&#21160;&#21442;&#19982;&#20107;&#21153;&#12290;
      Template&#23454;&#20363;&#26159;&#32447;&#31243;&#23433;&#20840;&#30340;&#65292;&#21487;&#37325;&#29992;&#30340;&#65292;&#22240;&#27492;&#21487;&#20197;&#20316;&#20026;&#22806;&#37096;&#31867;&#30340;&#23454;&#20363;&#21464;&#37327;&#32780;&#34987;&#20445;&#25345;&#12290;
      &#23545;&#20110;&#31616;&#21333;&#30340;&#19968;&#27493;&#25805;&#20316;&#65292;&#20363;&#22914;&#31616;&#21333;&#30340;find,load, saveOrUpdate,&#25110;&#32773;delete&#35843;&#29992;&#65292;
      <tt class="classname">HibernateTemplate</tt>&#25552;&#20379;&#20102;&#21487;&#36873;&#30340;&#31616;&#21333;&#26041;&#27861;&#21487;&#20197;&#29992;&#26469;&#26367;&#25442;&#36825;&#31181;&#19968;&#34892;&#30340;callback&#23454;&#29616;&#12290;
      &#27492;&#22806;&#65292;Spring&#25552;&#20379;&#20102;&#19968;&#20010;&#31616;&#20415;&#30340;<tt class="classname">HibernateDaoSupport</tt>&#22522;&#31867;&#65292;
      &#36825;&#20010;&#22522;&#31867;&#25552;&#20379;&#20102;<tt class="literal">setSessionFactory</tt>&#26041;&#27861;&#26469;&#25509;&#21463;&#19968;&#20010;SessionFactory&#65292;<tt class="literal">getSessionFactory</tt>
      &#20197;&#21450;<tt class="literal">getHibernateTemplate</tt>&#26041;&#27861;&#26159;&#23376;&#31867;&#20351;&#29992;&#30340;&#12290;&#36825;&#26679;&#23545;&#20110;&#20856;&#22411;&#30340;&#38656;&#27714;&#23601;&#21487;&#20197;&#26377;&#24456;&#31616;&#21333;&#30340;DAO&#23454;&#29616;&#65306;
      </p><pre class="programlisting">public class ProductDaoImpl extends HibernateDaoSupport implements ProductDao {

    public List loadProductsByCategory(String category) {
        return getHibernateTemplate().find(
            "from test.Product product where product.category=?", category,
            Hibernate.STRING);
    }
}</pre></div><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="d0e5714"></a>11.2.4.&nbsp;&#21033;&#29992;AOP&#25318;&#25130;&#22120;(Interceptor)&#21462;&#20195;Template </h3></div></div><div></div></div><p>
      Spring&#30340;AOP <tt class="classname">HibernateInterceptor</tt>&#26159;&#20316;&#20026;<tt class="classname">HibernateTemplate</tt>&#30340;&#26367;&#25442;&#65292;
      &#23427;&#22312;&#19968;&#20010;&#22996;&#25176;&#30340;try/catch&#22359;&#20013;&#30452;&#25509;&#20889;Hibernate&#20195;&#30721;&#65292;
      &#20197;&#21450;&#22312;application context&#20013;&#30340;&#19968;&#20010;interceptor&#23450;&#20041;&#65292;&#20174;&#32780;&#20195;&#26367;callback&#30340;&#23454;&#29616;&#12290;
      &#19979;&#38754;&#28436;&#31034;&#20102;&#22312;application context&#20013;DAO&#65292;interceptor&#20197;&#21450;proxy&#23450;&#20041;&#65292;&#21516;&#26102;&#36824;&#26377;&#19968;&#20010;DAO&#26041;&#27861;&#30340;&#20855;&#20307;&#23454;&#29616;&#65306;
      </p><pre class="programlisting">&lt;beans&gt;

    ...

    &lt;bean id="myHibernateInterceptor" 
        class="org.springframework.orm.hibernate.HibernateInterceptor"&gt;
        &lt;property name="sessionFactory"&gt;
            &lt;ref bean="mySessionFactory"/&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

    &lt;bean id="myProductDaoTarget" class="product.ProductDaoImpl"&gt;
        &lt;property name="sessionFactory"&gt;
            &lt;ref bean="mySessionFactory"/&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

    &lt;bean id="myProductDao" class="org.springframework.aop.framework.ProxyFactoryBean"&gt;
        &lt;property name="proxyInterfaces"&gt;
            &lt;value&gt;product.ProductDao&lt;/value&gt;
        &lt;/property&gt;
        &lt;property name="interceptorNames"&gt;
            &lt;list&gt;
                &lt;value&gt;myHibernateInterceptor&lt;/value&gt;
                &lt;value&gt;myProductDaoTarget&lt;/value&gt;
            &lt;/list&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

    ...

&lt;/beans&gt;</pre><pre class="programlisting">public class ProductDaoImpl extends HibernateDaoSupport implements ProductDao {

    public List loadProductsByCategory(final String category) throws MyException {
        Session session = SessionFactoryUtils.getSession(getSessionFactory(), false);
        try {
            List result = session.find(
                "from test.Product product where product.category=?",
                category, Hibernate.STRING);
            if (result == null) {
                throw new MyException("invalid search result");
            }
            return result;
        }
        catch (HibernateException ex) {
            throw SessionFactoryUtils.convertHibernateAccessException(ex);
        }
    }
}</pre><p>
      &#36825;&#20010;&#26041;&#27861;&#24517;&#39035;&#35201;&#26377;&#19968;&#20010;<tt class="classname">HibernateInterceptor</tt>&#25165;&#33021;&#24037;&#20316;&#12290;
      getSession&#26041;&#27861;&#20013;&#30340;&#8221;false&#8221;&#26631;&#24535;&#20026;&#20102;&#30830;&#20445;Session&#24050;&#32463;&#23384;&#22312;&#65292;
      &#21542;&#21017;<tt class="classname">SessionFactoryUtils</tt>&#20250;&#21019;&#24314;&#19968;&#20010;&#26032;&#30340;&#12290;
      &#22914;&#26524;&#32447;&#31243;&#20013;&#24050;&#32463;&#23384;&#22312;&#19968;&#20010; <tt class="classname">SessionHolder</tt>&#27604;&#22914;&#19968;&#20010;<tt class="classname">HibernateTransactionManager</tt>&#20107;&#21153;
      &#65292;&#37027;<tt class="classname">SessionFactoryUtils</tt> &#23601;&#32943;&#23450;&#20250;&#33258;&#21160;&#21442;&#19982;&#36827;&#26469;&#12290;<tt class="classname">HibernateTemplate</tt>
      &#22312;&#20869;&#37096;&#20351;&#29992;<tt class="classname">SessionFactoryUtils</tt>&#65292;
      &#20182;&#20204;&#26159;&#19968;&#26679;&#30340;&#24213;&#23618;&#32467;&#26500;&#12290; <tt class="classname">HibernateInterceptor</tt>&#26368;&#20027;&#35201;&#30340;&#20248;&#28857;&#26159;&#20801;&#35768;&#22312;&#25968;&#25454;&#35775;&#38382;&#20195;&#30721;&#20013;&#25243;&#20986;checked&#24212;&#29992;&#24322;&#24120;&#65292;
      &#32780;<tt class="classname">HibernateTemplate</tt>&#22312;&#22238;&#35843;&#20013;&#20005;&#26684;&#38480;&#21046;&#21482;&#33021;&#25243;&#20986;&#26410;&#26816;&#26597;&#24322;&#24120;&#12290;
      &#20540;&#24471;&#27880;&#24847;&#30340;&#26159;&#25105;&#20204;&#21487;&#20197;&#25226;&#21508;&#31181;check&#20197;&#21450;&#25243;&#20986;&#24212;&#29992;&#24322;&#24120;&#25512;&#36831;&#21040;&#22238;&#35843;&#20043;&#21518;&#12290;
      Interceptor&#30340;&#20027;&#35201;&#32570;&#28857;&#26159;&#23427;&#38656;&#35201;&#22312;context&#36827;&#34892;&#29305;&#27530;&#30340;&#35013;&#37197;&#12290;<tt class="classname">HibernateTemplate</tt>&#30340;&#31616;&#20415;&#26041;&#27861;&#22312;&#24456;&#22810;&#22330;&#26223;&#19979;&#26356;&#31616;&#21333;&#20123;
      
     </p></div><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="d0e5761"></a>11.2.5.&nbsp;&#32534;&#31243;&#24335;&#30340;&#20107;&#21153;&#21010;&#20998;</h3></div></div><div></div></div><p>
      &#22312;&#36825;&#20123;&#20302;&#23618;&#27425;&#30340;&#25968;&#25454;&#35775;&#38382;&#26381;&#21153;&#20043;&#19978;&#65292;&#21487;&#20197;&#22312;&#24212;&#29992;&#30340;&#39640;&#23618;&#27425;&#19978;&#21010;&#20998;&#20107;&#21153;&#65292;
      &#35753;&#20107;&#21153;&#27178;&#36328;&#22810;&#20010;&#25805;&#20316;&#12290;&#36825;&#37324;&#23545;&#20110;&#30456;&#20851;&#30340;&#19994;&#21153;&#23545;&#35937;(BO)&#21516;&#26679;&#27809;&#26377;&#23454;&#29616;&#25509;&#21475;&#30340;&#38480;&#21046;&#65292;
      &#23427;&#21482;&#38656;&#35201;&#19968;&#20010;Spring&#30340;<tt class="classname">PlatformTransactionManager</tt>&#12290;&#21516;SessionFactory&#19968;&#26679;&#65292;
      &#36825;&#20010;manager&#21487;&#20197;&#26469;&#33258;&#20219;&#20309;&#22320;&#26041;&#65292;
      &#20294;&#26159;&#26368;&#22909;&#26159;&#20316;&#20026;&#19968;&#20010;&#32463;&#30001;<tt class="methodname">setTransactionManager</tt> &#26041;&#27861;&#35774;&#32622;&#30340;bean&#24341;&#29992;&#65292;
      &#20363;&#22914;,&#29992;<tt class="methodname">setProductDao</tt>&#26041;&#27861;&#26469;&#35774;&#32622;<tt class="classname">productDAO</tt>.
      &#19979;&#38754;&#28436;&#31034;&#20102;&#22312;Srping application context&#20013;&#19968;&#20010;transaction manager&#21644;&#19968;&#20010;&#19994;&#21153;&#23545;&#35937;&#30340;&#23450;&#20041;&#65292;
      &#20197;&#21450;&#20855;&#20307;&#30340;&#19994;&#21153;&#26041;&#27861;&#26159;&#22914;&#20309;&#23454;&#29616;&#30340;&#65306; 
      </p><pre class="programlisting">&lt;beans&gt;

    ...

    &lt;bean id="myTransactionManager" 
        class="org.springframework.orm.hibernate.HibernateTransactionManager"&gt;
        &lt;property name="sessionFactory"&gt;
            &lt;ref bean="mySessionFactory"/&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

    &lt;bean id="myProductService" class="product.ProductServiceImpl"&gt;
        &lt;property name="transactionManager"&gt;
            &lt;ref bean="myTransactionManager"/&gt;
        &lt;/property&gt;
        &lt;property name="productDao"&gt;
            &lt;ref bean="myProductDao"/&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

&lt;/beans&gt;</pre><pre class="programlisting">public class ProductServiceImpl implements ProductService {

    private PlatformTransactionManager transactionManager;
    private ProductDao productDao;

    public void setTransactionManager(PlatformTransactionManager transactionManager) {
        this.transactionManager = transactionManager;
    }

    public void setProductDao(ProductDao productDao) {
        this.productDao = productDao;
    }

    public void increasePriceOfAllProductsInCategory(final String category) {
        TransactionTemplate transactionTemplate = new TransactionTemplate(this.transactionManager);
        transactionTemplate.setPropagationBehavior(TransactionDefinition.PROPAGATION_REQUIRED);
        transactionTemplate.execute(
            new TransactionCallbackWithoutResult() {
                public void doInTransactionWithoutResult(TransactionStatus status) {
                    List productsToChange = productDAO.loadProductsByCategory(category);
                    ...
                }
            }
        );
    }
}</pre><p></p></div><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="d0e5783"></a>11.2.6.&nbsp;&#22768;&#26126;&#24335;&#30340;&#20107;&#21153;&#21010;&#20998;</h3></div></div><div></div></div><p>
      &#20316;&#20026;&#21487;&#36873;&#30340;&#65292;&#25105;&#20204;&#21487;&#20197;&#20351;&#29992;Spring&#30340;AOP TransactionInterceptor&#26469;&#26367;&#25442;&#20107;&#21153;&#21010;&#20998;&#30340;&#25163;&#24037;&#20195;&#30721;&#65292;
      &#36825;&#38656;&#35201;&#22312;application context&#20013;&#23450;&#20041;interceptor&#12290;
      &#36825;&#20010;&#26041;&#26696;&#20351;&#24471;&#20320;&#21487;&#20197;&#25226;&#19994;&#21153;&#23545;&#35937;&#20174;&#27599;&#20010;&#19994;&#21153;&#26041;&#27861;&#20013;&#37325;&#22797;&#30340;&#20107;&#21153;&#21010;&#20998;&#20195;&#30721;&#20013;&#35299;&#25918;&#20986;&#26469;&#12290;
      &#27492;&#22806;&#65292;&#20687;&#20256;&#25773;&#34892;&#20026;&#21644;&#38548;&#31163;&#32423;&#21035;&#31561;&#20107;&#21153;&#27010;&#24565;&#33021;&#22815;&#22312;&#37197;&#32622;&#25991;&#20214;&#20013;&#25913;&#21464;&#65292;&#32780;&#19981;&#20250;&#24433;&#21709;&#19994;&#21153;&#23545;&#35937;&#30340;&#23454;&#29616;&#12290;
      
      </p><pre class="programlisting">&lt;beans&gt;

    ...

    &lt;bean id="myTransactionManager" 
        class="org.springframework.orm.hibernate.HibernateTransactionManager"&gt;
        &lt;property name="sessionFactory"&gt;
            &lt;ref bean="mySessionFactory"/&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

    &lt;bean id="myTransactionInterceptor" 
        class="org.springframework.transaction.interceptor.TransactionInterceptor"&gt;
        &lt;property name="transactionManager"&gt;
            &lt;ref bean="myTransactionManager"/&gt;
        &lt;/property&gt;
        &lt;property name="transactionAttributeSource"&gt;
            &lt;value&gt;
                product.ProductService.increasePrice*=PROPAGATION_REQUIRED
                product.ProductService.someOtherBusinessMethod=PROPAGATION_MANDATORY
            &lt;/value&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

    &lt;bean id="myProductServiceTarget" class="product.ProductServiceImpl"&gt;
        &lt;property name="productDao"&gt;
            &lt;ref bean="myProductDao"/&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

    &lt;bean id="myProductService" class="org.springframework.aop.framework.ProxyFactoryBean"&gt;
        &lt;property name="proxyInterfaces"&gt;
            &lt;value&gt;product.ProductService&lt;/value&gt;
        &lt;/property&gt;
        &lt;property name="interceptorNames"&gt;
            &lt;list&gt;
                &lt;value&gt;myTransactionInterceptor&lt;/value&gt;
                &lt;value&gt;myProductServiceTarget&lt;/value&gt;
            &lt;/list&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

&lt;/beans&gt;</pre><pre class="programlisting">public class ProductServiceImpl implements ProductService {

    private ProductDao productDao;

    public void setProductDao(ProductDao productDao) {
        this.productDao = productDao;
    }

    public void increasePriceOfAllProductsInCategory(final String category) {
        List productsToChange = this.productDAO.loadProductsByCategory(category);
        ...
    }

    ...

}</pre><p>
      &#21516;<tt class="classname">HibernateInterceptor</tt>&#19968;&#26679;&#65292;<tt class="classname">TransactionInterceptor</tt>
      &#20801;&#35768;&#20219;&#20309;checked&#30340;&#24212;&#29992;&#24322;&#24120;&#22312;callback&#20195;&#30721;&#20013;&#25243;&#20986;&#65292;
      &#32780;<tt class="classname">TransactionTemplate</tt> &#22312;callback&#20013;&#20005;&#26684;&#35201;&#27714;unchecked&#24322;&#24120;&#12290;
      <tt class="classname">TransactionTemplate</tt> &#20250;&#22312;&#19968;&#20010;unchecked&#24322;&#24120;&#25243;&#20986;&#26102;&#35302;&#21457;&#19968;&#20010;rollback&#65292;
      &#25110;&#32773;&#24403;&#20107;&#21153;&#34987;&#24212;&#29992;&#31243;&#24207;&#36890;&#36807;<tt class="classname">TransactionStatus</tt>&#26631;&#35760;&#20026;rollback-only&#12290;
      
      <tt class="classname">TransactionInterceptor</tt>&#40664;&#35748;&#36827;&#34892;&#21516;&#26679;&#30340;&#25805;&#20316;&#65292;&#20294;&#26159;&#23427;&#20801;&#35768;&#23545;&#27599;&#20010;&#26041;&#27861;&#37197;&#32622;rollback&#26041;&#38024;&#12290;
      &#19968;&#20010;&#31616;&#20415;&#21487;&#36873;&#30340;&#21019;&#24314;&#22768;&#26126;&#24335;&#20107;&#21153;&#30340;&#26041;&#27861;&#26159;&#65306;<tt class="classname">TransactionProxyFactoryBean</tt>&#65292;
      &#29305;&#21035;&#26159;&#22312;&#27809;&#26377;&#20854;&#20182;AOP interceptor&#29301;&#25199;&#21040;&#30340;&#24773;&#20917;&#19979;&#12290;&#23545;&#19968;&#20010;&#29305;&#23450;&#30340;&#30446;&#26631;bean&#65292;
      <tt class="classname">TransactionProxyFactoryBean</tt>&#29992;&#20107;&#21153;&#37197;&#32622;&#33258;&#24049;&#32852;&#21512;proxy&#23450;&#20041;&#12290;
      &#36825;&#26679;&#23601;&#25226;&#37197;&#32622;&#24037;&#20316;&#20943;&#23569;&#20026;&#37197;&#32622;&#19968;&#20010;&#30446;&#26631;bean&#20197;&#21450;&#19968;&#20010; proxy bean&#30340;&#23450;&#20041;&#65288;&#23569;&#20102;interceptor&#30340;&#23450;&#20041;&#65289;&#12290;
      &#27492;&#22806;&#20320;&#20063;&#19981;&#38656;&#35201;&#25351;&#23450;&#20107;&#21153;&#26041;&#27861;&#23450;&#20041;&#22312;&#21738;&#19968;&#20010;&#25509;&#21475;&#25110;&#31867;&#20013;&#12290; 
       
      
      
     </p><pre class="programlisting">&lt;beans&gt;

    ...

    &lt;bean id="myTransactionManager" 
        class="org.springframework.orm.hibernate.HibernateTransactionManager"&gt;
        &lt;property name="sessionFactory"&gt;
            &lt;ref bean="mySessionFactory"/&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

    &lt;bean id="myProductServiceTarget" class="product.ProductServiceImpl"&gt;
        &lt;property name="productDao"&gt;
            &lt;ref bean="myProductDao"/&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

    &lt;bean id="myProductService" 
        class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean"&gt;
        &lt;property name="transactionManager"&gt;
            &lt;ref bean="myTransactionManager"/&gt;
        &lt;/property&gt;
        &lt;property name="target"&gt;
            &lt;ref bean="myProductServiceTarget"/&gt;
        &lt;/property&gt;
        &lt;property name="transactionAttributes"&gt;
            &lt;props&gt;
                &lt;prop key="increasePrice*"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;
                &lt;prop key="someOtherBusinessMethod"&gt;PROPAGATION_MANDATORY&lt;/prop&gt;
            &lt;/props&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

&lt;/beans&gt;</pre></div><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="d0e5820"></a>11.2.7.&nbsp;&#20107;&#21153;&#31649;&#29702;&#31574;&#30053; </h3></div></div><div></div></div><p>
      <tt class="classname">TransactionTemplate</tt> &#21644;<tt class="classname">TransactionInterceptor</tt>
      &#37117;&#26159;&#23558;&#30495;&#27491;&#30340;&#20107;&#21153;&#22788;&#29702;&#20195;&#29702;&#32473;&#19968;&#20010;<tt class="classname">PlatformTransactionManager</tt>&#23454;&#20363;&#65292;
      &#27604;&#22914;&#22312;Hibernate&#24212;&#29992;&#20013;&#23427;&#21487;&#20197;&#26159;&#19968;&#20010;<tt class="classname">HibernateTransactionManager</tt> 
      &#65288;&#23545;&#20110;&#21333;&#29420;&#19968;&#20010;&#30340;Hibernat SessionFactory&#65292;
      &#23454;&#36136;&#19978;&#20351;&#29992;&#19968;&#20010;ThreadLocal&#30340;Session&#65289;&#25110;&#19968;&#20010;<tt class="classname">JtaTransactionManager</tt>
      &#65288;&#20195;&#29702;&#32473;&#23481;&#22120;&#30340;JTA&#23376;&#31995;&#32479;&#65289;&#12290;
      &#20320;&#29978;&#33267;&#21487;&#20197;&#20351;&#29992;&#33258;&#23450;&#20041;&#30340;<tt class="classname">PlatformTransactionManager</tt>&#30340;&#23454;&#29616;&#12290;
      &#25152;&#20197;&#21602;&#65292;&#22914;&#26524;&#20320;&#30340;&#24212;&#29992;&#38656;&#35201;&#20998;&#24067;&#24335;&#20107;&#21153;&#30340;&#26102;&#20505;&#65292;
      &#23558;&#21407;&#26469;&#30340;Hibernate&#20107;&#21153;&#31649;&#29702;&#36716;&#21464;&#20026;JTA&#20043;&#31867;&#30340;&#65292;&#21482;&#19981;&#36807;&#26159;&#25913;&#21464;&#37197;&#32622;&#25991;&#20214;&#30340;&#20107;&#24773;&#12290;
      &#31616;&#21333;&#22320;&#65292;&#23558;Hibernate transaction manager&#26367;&#25442;&#20026;Spring&#30340;JTA transaction&#23454;&#29616;&#12290;
      &#20107;&#21153;&#30340;&#21010;&#20998;&#21644;&#25968;&#25454;&#35775;&#38382;&#20195;&#30721;&#21017;&#19981;&#38656;&#35201;&#25913;&#21464;&#65292;&#22240;&#20026;&#20182;&#20204;&#20351;&#29992;&#30340;&#26159;&#36890;&#29992;&#30340;&#20107;&#21153;&#31649;&#29702;API&#12290;
      
      &#23545;&#20110;&#27178;&#36328;&#22810;&#20010;Hibernate SessionFacotry&#30340;&#20998;&#24067;&#24335;&#20107;&#21153;&#65292;
      &#21482;&#38656;&#31616;&#21333;&#22320;&#23558;<tt class="classname">JtaTransactionManager</tt> &#21516;&#22810;&#20010;<tt class="classname">LocalSessionFactoryBean</tt>
      &#23450;&#20041;&#32467;&#21512;&#36215;&#26469;&#20316;&#20026;&#19968;&#20010;&#20107;&#21153;&#31574;&#30053;&#12290;
      &#20320;&#30340;&#27599;&#19968;&#20010;DAO&#36890;&#36807;bean&#23646;&#24615;&#24471;&#21040;&#21508;&#33258;&#30340;SessionFactory&#24341;&#29992;&#12290;
      &#22914;&#26524;&#25152;&#26377;&#30340;&#24213;&#23618;JDBC datasource&#37117;&#26159;&#25903;&#25345;&#20107;&#21153;&#30340;&#23481;&#22120;&#65292;
      &#37027;&#20040;&#21482;&#35201;&#19968;&#20010;&#19994;&#21153;&#23545;&#35937;&#20351;&#29992;&#20102; <tt class="classname">JtaTransactionManager</tt>&#31574;&#30053;&#65292;
      &#23427;&#23601;&#21487;&#20197;&#27178;&#36328;&#22810;&#20010;DAO&#21644;&#22810;&#20010;session factories&#26469;&#21010;&#20998;&#20107;&#21153;&#65292;&#32780;&#19981;&#38656;&#35201;&#29305;&#27530;&#30340;&#23545;&#24453;.</p><pre class="programlisting">&lt;beans&gt;

    &lt;bean id="myDataSource1" class="org.springframework.jndi.JndiObjectFactoryBean"&gt;
        &lt;property name="jndiName"&gt;
            &lt;value&gt;java:comp/env/jdbc/myds1&lt;/value&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

    &lt;bean id="myDataSource2" class="org.springframework.jndi.JndiObjectFactoryBean"&gt;
        &lt;property name="jndiName"&gt;
            &lt;value&gt;java:comp/env/jdbc/myds2&lt;/value&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

    &lt;bean id="mySessionFactory1" class="org.springframework.orm.hibernate.LocalSessionFactoryBean"&gt;
        &lt;property name="mappingResources"&gt;
            &lt;list&gt;
                &lt;value&gt;product.hbm.xml&lt;/value&gt;
            &lt;/list&gt;
        &lt;/property&gt;
        &lt;property name="hibernateProperties"&gt;
            &lt;props&gt;
                &lt;prop key="hibernate.dialect"&gt;net.sf.hibernate.dialect.MySQLDialect&lt;/prop&gt;
            &lt;/props&gt;
        &lt;/property&gt;
        &lt;property name="dataSource"&gt;
            &lt;ref bean="myDataSource1"/&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

    &lt;bean id="mySessionFactory2" class="org.springframework.orm.hibernate.LocalSessionFactoryBean"&gt;
        &lt;property name="mappingResources"&gt;
            &lt;list&gt;
                &lt;value&gt;inventory.hbm.xml&lt;/value&gt;
            &lt;/list&gt;
        &lt;/property&gt;
        &lt;property name="hibernateProperties"&gt;
            &lt;props&gt;
                &lt;prop key="hibernate.dialect"&gt;net.sf.hibernate.dialect.OracleDialect&lt;/prop&gt;
            &lt;/props&gt;
        &lt;/property&gt;
        &lt;property name="dataSource"&gt;
            &lt;ref bean="myDataSource2"/&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

    &lt;bean id="myTransactionManager" 
        class="org.springframework.transaction.jta.JtaTransactionManager"/&gt;

    &lt;bean id="myProductDao" class="product.ProductDaoImpl"&gt;
        &lt;property name="sessionFactory"&gt;
            &lt;ref bean="mySessionFactory1"/&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

    &lt;bean id="myInventoryDao" class="product.InventoryDaoImpl"&gt;
        &lt;property name="sessionFactory"&gt;
            &lt;ref bean="mySessionFactory2"/&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

    &lt;bean id="myProductServiceTarget" class="product.ProductServiceImpl"&gt;
        &lt;property name="productDao"&gt;
            &lt;ref bean="myProductDao"/&gt;
        &lt;/property&gt;
        &lt;property name="inventoryDao"&gt;
            &lt;ref bean="myInventoryDao"/&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

    &lt;bean id="myProductService" 
        class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean"&gt;
        &lt;property name="transactionManager"&gt;
            &lt;ref bean="myTransactionManager"/&gt;
        &lt;/property&gt;
        &lt;property name="target"&gt;
            &lt;ref bean="myProductServiceTarget"/&gt;
        &lt;/property&gt;
        &lt;property name="transactionAttributes"&gt;
            &lt;props&gt;
                &lt;prop key="increasePrice*"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;
                &lt;prop key="someOtherBusinessMethod"&gt;PROPAGATION_MANDATORY&lt;/prop&gt;
            &lt;/props&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

&lt;/beans&gt;</pre><p>
      <tt class="classname">HibernateTransactionManager</tt>
      &#21644;<tt class="classname">JtaTransactionManager</tt>
      &#37117;&#20351;&#29992;&#20102;&#19982;&#23481;&#22120;&#26080;&#20851;&#30340;Hibernate&#20107;&#21153;&#31649;&#29702;&#22120;&#30340;lookup&#25110;JCA&#36830;&#25509;&#22120;&#65288;&#21482;&#35201;&#20107;&#21153;&#19981;&#26159;&#29992;EJB&#21457;&#36215;&#30340;&#65289;&#65292;
      &#20174;&#32780;&#32771;&#34385;&#21040;&#22312;&#36866;&#24403;JVM&#32423;&#21035;&#19978;&#30340;cache&#22788;&#29702;&#12290;
      &#32780;&#19988;<tt class="classname">HibernateTransactionManager</tt> &#33021;&#22815;&#20026;&#26222;&#36890;&#30340;JDBC&#35775;&#38382;&#20195;&#30721;&#36755;&#20986;JDBC Connection&#12290;
      &#36825;&#23601;&#21487;&#20197;&#20351;&#24471;&#28151;&#21512;&#30340;Hibernate/JDBC&#25968;&#25454;&#35775;&#38382;&#21487;&#20197;&#19981;&#29992;JTA&#32780;&#22312;&#39640;&#23618;&#27425;&#19978;&#36827;&#34892;&#20107;&#21153;&#21010;&#20998;&#65292;
      &#21482;&#35201;&#23427;&#20204;&#20351;&#29992;&#30340;&#26159;&#21516;&#19968;&#20010;&#25968;&#25454;&#24211;!</p><p>&#27880;&#37322;, &#23545;&#20110;&#20351;&#29992;<tt class="classname">TransactionProxyFactoryBean</tt>
       &#22768;&#26126;&#24615;&#21010;&#20998;&#20107;&#21153;&#23646;&#20110;&#21487;&#36873;&#26041;&#24335;,&#35831;&#21442;&#32771;for an alternative approach to using
       <a href="transaction.html#beannameautoproxycreator-for-transactions">&#31532;&nbsp;7.4.1&nbsp;&#33410; &#8220;BeanNameAutoProxyCreator&#65292;&#21478;&#19968;&#31181;&#22768;&#26126;&#26041;&#24335;&#8221;</a>.</p></div><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="d0e5872"></a>11.2.8.&nbsp;&#20351;&#29992;Spring&#31649;&#29702;&#30340;&#24212;&#29992;Bean</h3></div></div><div></div></div><p>
      &#19968;&#20010;Spring application context&#30340;&#23450;&#20041;&#33021;&#22815;&#34987;&#24456;&#22810;&#31181;&#19981;&#21516;&#30340;&#19978;&#19979;&#25991;&#23454;&#29616;&#25152;&#35835;&#21462;&#65292;
      &#27604;&#22914;<tt class="classname">FileSystemXmlApplicationContext</tt> &#21644;
      <tt class="classname">ClassPathXmlApplicationContext</tt>&#20197;&#21450;<tt class="classname">XmlWebApplicationContext</tt>&#12290;
      &#40664;&#35748;&#30340;&#24773;&#20917;&#19979;&#65292;&#19968;&#20010;web&#24212;&#29992;&#31243;&#24207;&#20250;&#20174;&#8221;WEB-INF/applicationContext.xml&#8221;&#20013;&#24471;&#21040;root context&#12290;
      &#22312;&#25152;&#26377;&#30340;Spring&#24212;&#29992;&#20013;&#65292;XML&#25991;&#20214;&#20013;&#23450;&#20041;&#30340;application context&#20250;&#25226;&#25152;&#26377;&#30456;&#20851;&#30340;application beans&#36830;&#25509;&#36215;&#26469;&#65292;
      &#21253;&#25324;Hibernate session factory&#20197;&#21450;&#25968;&#25454;&#35775;&#38382;&#21644;&#19994;&#21153;&#23545;&#35937;&#65288;&#23601;&#20687;&#19978;&#38754;&#23450;&#20041;&#30340;&#37027;&#20123;bean&#65289;&#12290;
      &#23427;&#20204;&#20013;&#30340;&#22823;&#37096;&#20998;&#37117;&#19981;&#20250;&#24847;&#35782;&#21040;&#34987;Spring&#23481;&#22120;&#25152;&#31649;&#29702;&#65292;&#29978;&#33267;&#22312;&#21516;&#20854;&#20182;bean&#21512;&#20316;&#30340;&#26102;&#20505;&#65292;
      &#22240;&#20026;&#23427;&#20204;&#20165;&#20165;&#36981;&#24490;JavaBeans&#30340;&#35268;&#33539;&#12290;&#19968;&#20010;bean&#23646;&#24615;&#21450;&#21487;&#20197;&#34920;&#31034;&#20540;&#21442;&#25968;&#65292;&#20063;&#21487;&#20197;&#26159;&#20854;&#20182;&#30340;&#21512;&#20316;bean&#12290;
      &#19979;&#38754;&#30340;bean&#23450;&#20041;&#33021;&#22815;&#20316;&#20026;Spring web MVC context&#30340;&#19968;&#37096;&#20998;&#65292;&#22312;&#26368;&#22522;&#30784;&#30340; application context&#20013;&#35775;&#38382;business beans&#12290; 
      
     </p><pre class="programlisting">&lt;bean id="myProductList" class="product.ProductListController"&gt;
    &lt;property name="productService"&gt;
        &lt;ref bean="myProductService"/&gt;
    &lt;/property&gt;
&lt;/bean&gt;</pre><p>
      Spring web controller&#25152;&#38656;&#35201;&#30340;&#25152;&#26377;&#19994;&#21153;&#25110;&#25968;&#25454;&#35775;&#38382;&#23545;&#35937;&#37117;&#26159;&#36890;&#36807;bean&#24341;&#29992;&#25552;&#20379;&#30340;&#65292;
      &#25152;&#20197;&#22312;&#24212;&#29992;&#24471;&#19978;&#19979;&#25991;&#20013;&#23601;&#19981;&#20877;&#38656;&#35201;&#25163;&#21160;&#30340;bean lookup&#20102;&#12290;&#20294;&#26159;&#22312;&#19982;Struts&#19968;&#36215;&#20351;&#29992;&#65292;
      &#25110;&#22312;&#19968;&#20010;EJB&#23454;&#29616;&#20013;&#29978;&#33267;&#19968;&#20010;applet&#20013;&#20351;&#29992;&#65292;&#20320;&#20173;&#28982;&#21487;&#20197;&#33258;&#24049;&#25163;&#21160;&#22320;look up&#19968;&#20010;bean
      &#65288;&#24847;&#24605;&#22823;&#27010;&#26159;Spring&#19981;&#20250;&#24433;&#21709;&#20320;&#21407;&#26469;&#30340;&#20351;&#29992;&#26041;&#24335;&#65289;&#12290;&#22240;&#27492;&#65292;Spring beans&#20107;&#23454;&#19978;&#33021;&#22815;&#22312;&#20219;&#20309;&#22320;&#26041;&#25903;&#25345;&#12290;
      &#20320;&#21482;&#38656;&#35201;&#19968;&#20010;application context&#30340;&#24341;&#29992;&#65292;&#20320;&#21487;&#20197;&#22312;&#19968;&#20010;web &#24212;&#29992;&#20013;&#36890;&#36807;&#19968;&#20010;servlet context&#30340;&#23646;&#24615;&#24471;&#21040;&#65292;
      &#25110;&#32773;&#25163;&#21160;&#22320;&#20174;&#19968;&#20010;&#25991;&#20214;&#25110;class path resource&#21019;&#24314;&#23454;&#20363;&#12290; 
      </p><pre class="programlisting">ApplicationContext context = WebApplicationContextUtils.getWebApplicationContext(servletContext);
ProductService productService = (ProductService) context.getBean("myProductService");</pre><pre class="programlisting">ApplicationContext context =
    new FileSystemXmlApplicationContext("C:/myContext.xml");
ProductService productService =
    (ProductService) context.getBean("myProductService");</pre><pre class="programlisting">ApplicationContext context =
    new ClassPathXmlApplicationContext("myContext.xml");
ProductService productService =
    (ProductService) context.getBean("myProductService");</pre><p></p></div><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="d0e5897"></a>11.2.9.&nbsp;&#23481;&#22120;&#36164;&#28304; vs &#26412;&#22320;&#36164;&#28304;</h3></div></div><div></div></div><p>
      Spring&#30340;&#36164;&#28304;&#31649;&#29702;&#32771;&#34385;&#21040;&#20102;&#22312;JNDI SessionFactory&#21644;local&#30340;SessionFactory&#20043;&#38388;&#30340;&#31616;&#21333;&#20999;&#25442;&#65292;
      &#23545;&#20110;JNDI DataSource&#20063;&#26159;&#36825;&#26679;&#30340;&#65292;&#19981;&#38656;&#35201;&#20462;&#25913;&#19968;&#34892;&#20195;&#30721;&#12290;
      &#25226;&#36164;&#28304;&#23450;&#20041;&#25918;&#22312;&#23481;&#22120;&#20013;&#36824;&#26159;&#25918;&#22312;&#24212;&#29992;&#31243;&#24207;&#26412;&#22320;&#20013;&#20027;&#35201;&#26159;&#30001;&#20351;&#29992;&#30340;&#20107;&#21153;&#31574;&#30053;&#20915;&#23450;&#30340;&#12290;
      &#21516;Spring&#23450;&#20041;&#30340;&#26412;&#22320;SessionFactory&#30456;&#27604;&#65292;&#19968;&#20010;&#25163;&#21160;&#27880;&#20876;&#30340;JNDI SessionFactory&#24182;&#19981;&#20250;&#25552;&#20379;&#20219;&#20309;&#22810;&#20313;&#30340;&#22909;&#22788;&#12290;
      &#22914;&#26524;&#36890;&#36807;Hibernate&#30340;JCA&#36830;&#25509;&#22120;&#36827;&#34892;&#27880;&#20876;&#65292;&#23545;&#20110;&#21442;&#19982;JTA&#20107;&#21153;&#26377;&#26126;&#26174;&#30340;&#22909;&#22788;&#65292;
      &#23588;&#20854;&#22312;EJB&#20013;&#12290;&#32780;Spring&#30340;transaction&#25903;&#25345;&#30340;&#19968;&#20010;&#37325;&#35201;&#22909;&#22788;&#23601;&#26159;&#19981;&#20381;&#36182;&#20110;&#20219;&#20309;&#19968;&#20010;&#23481;&#22120;&#12290;
      &#20351;&#29992;&#38750;JTA&#30340;&#31574;&#30053;&#37197;&#32622;&#65292;&#31243;&#24207;&#23558;&#20250;&#22312;&#29420;&#31435;&#30340;&#25110;&#27979;&#35797;&#30340;&#29615;&#22659;&#19979;&#21516;&#26679;&#27491;&#24120;&#24037;&#20316;&#12290;&#23588;&#20854;&#22312;&#20856;&#22411;&#30340;&#21333;&#25968;&#25454;&#24211;&#20107;&#21153;&#24773;&#20917;&#19979;&#65292;
      &#36825;&#23558;&#26159;JTA&#30340;&#36731;&#20415;&#21644;&#24378;&#22823;&#30340;&#26367;&#25442;&#26041;&#26696;&#12290;&#24403;&#20351;&#29992;&#19968;&#20010;&#26412;&#22320;&#30340;EJB SLSB&#26469;&#39537;&#21160;&#20107;&#21153;&#26102;&#65292;
      &#23613;&#31649;&#20320;&#21487;&#33021;&#21482;&#35775;&#38382;&#19968;&#20010;&#25968;&#25454;&#24211;&#32780;&#19988;&#20165;&#20165;&#36890;&#36807;CMT&#20351;&#29992;SLSBs&#30340;&#22768;&#26126;&#24615;&#20107;&#21153;&#65292;&#20320;&#20173;&#28982;&#35201;&#20381;&#36182;&#20110;EJB&#23481;&#22120;&#21644;JTA&#12290;
      &#32534;&#31243;&#24335;&#20351;&#29992;JTA&#30340;&#26367;&#25442;&#26041;&#26696;&#20381;&#28982;&#38656;&#35201;J2EE&#29615;&#22659;&#12290;JTA&#19981;&#20165;&#20165;&#22312;&#33258;&#24049;&#36825;&#19968;&#26041;&#38754;&#32780;&#19988;&#22312;JNDI DataSource&#26041;&#38754;&#65292;
      &#24341;&#20837;&#20102;&#23481;&#22120;&#20381;&#36182;&#12290;&#23545;&#20110;&#38750;Spring&#30340;&#65292;JTA&#39537;&#21160;&#30340;Hibernate&#20107;&#21153;&#65292;&#20026;&#20102;&#22312;&#36866;&#24403;&#30340;JVM&#23618;&#27425;&#19978;&#20570;caching&#65292;
      &#20320;&#24517;&#39035;&#20351;&#29992;Hibernate JCA&#36830;&#25509;&#22120;&#25110;&#32773;&#39069;&#22806;&#30340;Hibernate&#20107;&#21153;&#20195;&#30721;&#21450;&#37197;&#32622;&#22909;&#30340;JTA&#20107;&#21153;&#12290;
      Spring&#39537;&#21160;&#30340;&#20107;&#21153;&#33021;&#22815;&#24456;&#22909;&#22320;&#20351;&#29992;&#26412;&#22320;&#23450;&#20041;&#30340;Hibernate SessionFacotry&#24037;&#20316;&#65292;&#23601;&#20687;&#20351;&#29992;&#26412;&#22320;&#30340;JDBC DataSource&#24037;&#20316;&#65288;
      &#24403;&#28982;&#35775;&#38382;&#30340;&#24517;&#39035;&#26159;&#19968;&#20010;&#21333;&#29420;&#30340;&#25968;&#25454;&#24211;&#65289;&#12290;&#22240;&#27492;&#20320;&#21482;&#38656;&#35201;&#22312;&#38754;&#23545;&#20998;&#24067;&#24335;&#20107;&#21153;&#38656;&#27714;&#30340;&#26102;&#20505;&#36864;&#22238;&#21040;Spring&#30340;JTA&#20107;&#21153;&#31574;&#30053;&#12290;
      &#24517;&#39035;&#35201;&#27880;&#24847;&#65292;&#19968;&#20010;JCA&#36830;&#25509;&#22120;&#38656;&#35201;&#29305;&#23450;&#23481;&#22120;&#30340;&#37096;&#32626;&#27493;&#39588;&#65292;&#32780;&#19988;&#39318;&#20808;&#35201;&#25903;&#25345;JCA&#12290;
      &#36825;&#35201;&#27604;&#20351;&#29992;&#26412;&#22320;&#36164;&#28304;&#23450;&#20041;&#21644;Spring&#39537;&#21160;&#20107;&#21153;&#26469;&#37096;&#32626;&#19968;&#20010;&#31616;&#21333;&#30340;Web&#24212;&#29992;&#40635;&#28902;&#22810;&#20102;&#12290;
      &#32780;&#19988;&#20320;&#36890;&#24120;&#38656;&#35201;&#20225;&#19994;&#29256;&#26412;&#30340;&#23481;&#22120;&#65292;&#27604;&#22914;WebLogic&#30340;Express&#29256;&#26412;&#24182;&#19981;&#25552;&#20379;JCA&#12290;
      &#19968;&#20010;&#20165;&#20351;&#29992;&#26412;&#22320;&#36164;&#28304;&#24182;&#19988;&#20107;&#21153;&#20165;&#36328;&#36234;&#19968;&#20010;&#25968;&#25454;&#24211;&#30340;Spring&#24212;&#29992;&#23558;&#20250;&#22312;&#20219;&#20309;&#19968;&#31181;J2EE Web&#23481;&#22120;&#20013;&#24037;&#20316;
      &#65288;&#19981;&#38656;&#35201;JTA,JCA&#25110;&#32773;EJB&#65289;&#65292;&#27604;&#22914;Tomcat,Resin, &#29978;&#33267;&#26222;&#36890;&#30340;Jetty&#12290;
      &#26356;&#22810;&#30340;&#26159;&#65292;&#36825;&#26679;&#30340;&#20013;&#38388;&#23618;&#21487;&#20197;&#22312;&#26700;&#38754;&#24212;&#29992;&#25110;&#27979;&#35797;&#29992;&#20363;&#20013;&#31616;&#21333;&#22320;&#37325;&#29992;&#12290;&#32508;&#19978;&#25152;&#36848;&#65306;&#22914;&#26524;&#20320;&#19981;&#20351;&#29992;EJB&#65292;
      &#22362;&#25345;&#20351;&#29992;&#26412;&#22320;SessionFactory&#30340;&#21019;&#24314;&#21644;Spring&#30340;<tt class="classname">HibernateTransactionManager</tt>
      &#25110;<tt class="classname">JtaTransactionManager</tt>&#12290;
      &#20320;&#21487;&#24471;&#21040;&#21253;&#25324;&#36866;&#24403;&#30340;JVM&#23618;&#27425;&#19978;&#30340;caching&#20197;&#21450;&#20998;&#24067;&#24335;&#20107;&#21153;&#22312;&#20869;&#30340;&#25152;&#26377;&#22909;&#22788;&#65292;&#21364;&#19981;&#20250;&#26377;&#20219;&#20309;&#23481;&#22120;&#37096;&#32626;&#30340;&#40635;&#28902;&#12290;
      &#36890;&#36807;JCA&#36830;&#25509;&#22120;&#30340;Hibernate SessionFactory &#30340;JNDI&#27880;&#20876;&#20165;&#20165;&#22312;EJB&#20013;&#20351;&#29992;&#20250;&#24102;&#26469;&#22909;&#22788;&#12290;
      </p></div><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="d0e5908"></a>11.2.10.&nbsp;&#20030;&#20363;</h3></div></div><div></div></div><p>
      Spring&#21457;&#34892;&#21253;&#20013;&#30340;Petclinic&#36825;&#20010;&#20363;&#23376;&#25552;&#20379;&#20102;&#21487;&#36873;&#30340;DAO&#23454;&#29616;&#21644;application context&#37197;&#32622;&#25991;&#20214;
      &#65288;&#20998;&#21035;&#38024;&#23545;Hibernaet, JDBC, &#21644;Apache OJB&#65289;&#12290;&#22240;&#27492;Petclinic&#21487;&#20197;&#20316;&#20026;&#21487;&#24037;&#20316;&#30340;&#31034;&#20363;&#24212;&#29992;&#65292;
      &#38416;&#26126;&#20102;&#22312;Spring web&#24212;&#29992;&#20013;&#22914;&#20309;&#20351;&#29992;Hibernate&#12290;&#23427;&#20063;&#21033;&#29992;&#20102;&#19981;&#21516;&#20107;&#21153;&#31574;&#30053;&#19979;&#30340;&#22768;&#26126;&#24335;&#20107;&#21153;&#21010;&#20998;&#12290;
      </p></div></div><div class="sect1" lang="zh_cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e5913"></a>11.3.&nbsp;JDO</h2></div></div><div></div></div><p>ToDo</p></div><div class="sect1" lang="zh_cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e5918"></a>11.4.&nbsp;iBATIS</h2></div></div><div></div></div><p>
    Spring&#36890;&#36807;<tt class="literal">org.springframework.orm.ibatis</tt>&#21253;&#26469;&#25903;&#25345;iBATIS SqlMaps 1.3.x&#21644;2.0&#12290;
    iBATIS&#30340;&#25903;&#25345;&#38750;&#24120;&#31867;&#20284;&#20110;Hibernate&#30340;&#25903;&#25345;&#65292;&#23427;&#25903;&#25345;&#21516;&#26679;&#30340;template&#26679;&#24335;&#30340;&#32534;&#31243;&#65292;
    &#32780;&#19988;&#21516;Hibernate&#19968;&#26679;&#65292;iBatis&#30340;&#25903;&#25345;&#20063;&#26159;&#21644;Spring&#30340;&#24322;&#24120;&#20307;&#31995;&#19968;&#36215;&#24037;&#20316;&#65292;&#20182;&#20250;&#35753;&#20320;&#21916;&#27426;&#19978;Spring&#25152;&#26377;&#30340;IoC&#29305;&#24615;&#12290; 
    
    </p><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="d0e5926"></a>11.4.1.&nbsp;1.3.x&#21644;2.0&#30340;&#27010;&#35272;&#21644;&#21306;&#21035;</h3></div></div><div></div></div><p>Spring&#23545;iBATIS SqlMaps1.3&#21644;2.0&#37117;&#25552;&#20379;&#20102;&#25903;&#25345;&#12290;&#39318;&#20808;&#35753;&#25105;&#20204;&#26469;&#30475;&#19968;&#30475;&#20004;&#20010;&#20043;&#38388;&#30340;&#21306;&#21035;&#12290; 

	
	</p><div class="table"><a name="d0e5931"></a><p class="title"><b>&#34920;&nbsp;11.1.&nbsp;iBATIS SqlMaps supporting classes for 1.3 and 2.0</b></p><table summary="iBATIS SqlMaps supporting classes for 1.3 and 2.0" border="1"><colgroup><col><col><col></colgroup><thead><tr><th>Feature</th><th>1.3.x</th><th>2.0</th></tr></thead><tbody><tr><td>Creation of SqlMap</td><td><tt class="literal">SqlMapFactoryBean</tt></td><td><tt class="literal">SqlMapClientFactoryBean</tt></td></tr><tr><td>Template-style helper class</td><td><tt class="literal">SqlMapTemplate</tt></td><td><tt class="literal">SqlMapClientTemplate</tt></td></tr><tr><td>Callback to use MappedStatement</td><td><tt class="literal">SqlMapCallback</tt></td><td><tt class="literal">SqlMapClientCallback</tt></td></tr><tr><td>Super class for DAOs</td><td><tt class="literal">SqlMapDaoSupport</tt></td><td><tt class="literal">SqlMapClientDaoSupport</tt></td></tr></tbody></table></div><p>	
	</p></div><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="d0e5984"></a>11.4.2.&nbsp;&#21019;&#24314;SqlMap </h3></div></div><div></div></div><p>
			&#20351;&#29992;iBATIS SqlMaps&#28041;&#21450;&#21019;&#24314;&#21253;&#21547;&#35821;&#21477;&#21644;&#32467;&#26524;&#23545;&#24212;&#20851;&#31995;&#30340;&#37197;&#32622;&#25991;&#20214;&#12290;
			Spring&#20250;&#36127;&#36131;&#20351;&#29992;<tt class="literal">SqlMapFactoryBean</tt>&#25110;<tt class="literal">SqlMapClientFactoryBean</tt>&#26469;&#35835;&#21462;&#36825;&#20123;&#37197;&#32622;&#25991;&#20214;&#65292;
			&#20854;&#20013;&#21518;&#19968;&#20010;&#31867;&#26159;&#21516;SqlMaps2.0&#32852;&#21512;&#20351;&#29992;&#30340;&#12290;
		</p><p>
			</p><pre class="programlisting">		
public class Account {
	private String name;
	private String email;
	
	public String getName() {
		return this.name;
	}
	
	public void setName(String name) {
		this.name = name;
	}
	
	public String getEmail() {
		return this.email;
	}
	
	public void setEmail(String email) {
		this.email = email;
	}
}</pre><p>
			&#20551;&#35774;&#25105;&#20204;&#35201;&#26144;&#23556;&#36825;&#20010;&#31867;&#65292;&#25105;&#20204;&#23601;&#35201;&#21019;&#24314;&#22914;&#19979;&#30340;SqlMap&#12290;&#36890;&#36807;&#20351;&#29992;&#26597;&#35810;&#65292;&#25105;&#20204;&#31245;&#21518;&#21487;&#20197;&#29992;email addersses&#26469;&#21462;&#24471;users.
			<tt class="literal">Account.xml</tt>:
			</p><pre class="programlisting">
&lt;sql-map name="Account"&gt;
	&lt;result-map name="result" class="examples.Account"&gt;
		&lt;property name="name" column="NAME" columnIndex="1"/&gt;
		&lt;property name="email" column="EMAIL" columnIndex="2"/&gt;
	&lt;/result-map&gt;
	
	&lt;mapped-statement name="getAccountByEmail" result-map="result"&gt;
		select
			  ACCOUNT.NAME,
			  ACCOUNT.EMAIL
		from ACCOUNT
		where ACCOUNT.EMAIL = #value#
	&lt;/mapped-statement&gt;
	
	&lt;mapped-statement name="insertAccount"&gt;
		insert into ACCOUNT (NAME, EMAIL) values (#name#, #email#)
	&lt;/mapped-statement&gt;
&lt;/sql-map&gt;
</pre><p>
			&#22312;&#23450;&#20041;&#23436;SqlMap&#20043;&#21518;&#65292;&#25105;&#20204;&#24517;&#39035;&#20026;iBATIS&#21019;&#24314;&#19968;&#20010;&#37197;&#32622;&#25991;&#20214;
			
			(<tt class="literal">sqlmap-config.xml</tt>):
</p><pre class="programlisting">
&lt;sql-map-config&gt;

	&lt;sql-map resource="example/Account.xml"/&gt;

&lt;/sql-map-config&gt;
</pre><p>
			iBATIS&#20250;&#20174;classpath&#35835;&#21462;&#36164;&#28304;&#65292;&#25152;&#20197;&#35201;&#30830;&#20445;Account.xml&#25991;&#20214;&#22312;classpath&#19978;&#38754;&#12290;
		</p><p>
			&#29992;Spring&#65292;&#25105;&#20204;&#29616;&#22312;&#33021;&#22815;&#24456;&#23481;&#26131;&#22320;&#36890;&#36807;
			<tt class="literal">SqlMapFactoryBean</tt>&#21019;&#24314;SqlMap:
</p><pre class="programlisting">
&lt;bean id="sqlMap" class="org.springframework.orm.ibatis.SqlMapFactoryBean"&gt;
	&lt;property name="configLocation"&gt;&lt;value&gt;WEB-INF/sqlmap-config.xml&lt;/value&gt;&lt;/property&gt;
&lt;/bean&gt;
</pre><p>
		</p></div><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="d0e6020"></a>11.4.3.&nbsp;&#20351;&#29992; <tt class="literal">SqlMapDaoSupport</tt></h3></div></div><div></div></div><p>
		<tt class="literal">SqlMapDaoSupport</tt>&#31867;&#26159;&#31867;&#20284;&#20110;<tt class="literal">HibernateDaoSupport</tt>
		&#21644;<tt class="literal">JdbcDaoSupport</tt>&#30340;&#25903;&#25345;&#31867;&#12290;&#35753;&#25105;&#20204;&#23454;&#29616;&#19968;&#20010;DAO:
</p><pre class="programlisting">
public class SqlMapAccountDao extends SqlMapDaoSupport implements AccountDao {

	public Account getAccount(String email) throws DataAccessException {
		Account acc = new Account();
		acc.setEmail();
		return (Account)getSqlMapTemplate().executeQueryForObject("getAccountByEmail", email);
	}

	public void insertAccount(Account account) throws DataAccessException {
		getSqlMapTemplate().executeUpdate("insertAccount", account);
	}
}
</pre><p>
			&#27491;&#22914;&#20320;&#25152;&#30475;&#21040;&#30340;&#65292;&#25105;&#20204;&#20351;&#29992;SqlMapTemplate&#26469;&#25191;&#34892;&#26597;&#35810;&#12290;Spring&#20250;&#22312;&#21019;&#24314;&#22914;&#19979;&#25152;&#31034;&#30340;SqlMapAccountDao&#30340;&#26102;&#20505;&#24050;&#32463;&#20351;&#29992;SqlMapFactoryBean&#20026;&#25105;&#20204;&#21021;&#22987;&#21270;&#20102;SqlMap&#12290;&#19968;&#20999;&#37117;&#20934;&#22791;&#23601;&#32490;&#20102;:
			
</p><pre class="programlisting">
&lt;!-- for more information about using datasource, have a look at the JDBC chapter --&gt;
&lt;bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close"&gt;
	&lt;property name="driverClassName"&gt;&lt;value&gt;${jdbc.driverClassName}&lt;/value&gt;&lt;/property&gt;
	&lt;property name="url"&gt;&lt;value&gt;${jdbc.url}&lt;/value&gt;&lt;/property&gt;
	&lt;property name="username"&gt;&lt;value&gt;${jdbc.username}&lt;/value&gt;&lt;/property&gt;
	&lt;property name="password"&gt;&lt;value&gt;${jdbc.password}&lt;/value&gt;&lt;/property&gt;
&lt;/bean&gt;

&lt;bean id="accountDao" class="example.SqlMapAccountDao"&gt;
	&lt;property name="dataSource"&gt;&lt;ref local="dataSource"/&gt;&lt;/property&gt;
	&lt;property name="sqlMap"&gt;&lt;ref local="sqlMap"/&gt;&lt;/property&gt;
&lt;/bean&gt;
</pre><p>
		</p></div><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="d0e6042"></a>11.4.4.&nbsp;&#20107;&#21153;&#31649;&#29702;</h3></div></div><div></div></div><p>
			&#22312;&#20351;&#29992;iBATIS&#30340;&#24212;&#29992;&#31243;&#24207;&#20013;&#22686;&#21152;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;&#26159;&#30456;&#24403;&#30340;&#31616;&#21333;&#12290;
			&#22522;&#26412;&#19978;&#20320;&#25152;&#38656;&#35201;&#20570;&#30340;&#21807;&#19968;&#20107;&#24773;&#26159;&#65306;
			&#22312;&#20320;&#30340;application context&#20013;&#22686;&#21152;&#19968;&#20010;transaction manager&#24182;&#19988;&#20351;&#29992;&#35832;&#22914;
			<tt class="literal">TransactionProxyFactoryBean</tt>&#22768;&#26126;&#24335;&#22320;&#35774;&#23450;&#20320;&#30340;&#20107;&#21153;&#30028;&#38480;&#12290;
			&#20851;&#20110;&#36825;&#26041;&#38754;&#30340;&#26356;&#22810;&#24773;&#20917;&#21487;&#20197;&#22312;<a href="transaction.html" title="&#31532;&nbsp;7&nbsp;&#31456;&nbsp;&#20107;&#21153;&#31649;&#29702;">&#31532;&nbsp;7&nbsp;&#31456; <i>&#20107;&#21153;&#31649;&#29702;</i></a>&#20013;&#25214;&#21040;&#12290; 
			
		</p><p>
			TODO elaborate!
		</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="jdbc.html">&#19978;&#19968;&#39029;</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="index.html">&#19978;&#19968;&#32423;</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="mvc.html">&#19979;&#19968;&#39029;</a></td></tr><tr><td width="40%" align="left" valign="top">&#31532;&nbsp;10&nbsp;&#31456;&nbsp;&#20351;&#29992;JDBC&#36827;&#34892;&#25968;&#25454;&#35775;&#38382;&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">&#36215;&#22987;&#39029;</a></td><td width="40%" align="right" valign="top">&nbsp;&#31532;&nbsp;12&nbsp;&#31456;&nbsp;Web&#26694;&#26550;</td></tr></table></div></body></html>