<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>&#31532;&nbsp;6&nbsp;&#31456;&nbsp;&#38598;&#25104;AspectJ </title><link rel="stylesheet" href="../styles/html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.65.1"><link rel="home" href="index.html" title="Spring - Java/J2EE Application Framework"><link rel="up" href="index.html" title="Spring - Java/J2EE Application Framework"><link rel="previous" href="aop.html" title="&#31532;&nbsp;5&nbsp;&#31456;&nbsp;Spring AOP: Spring&#20043;&#38754;&#21521;&#26041;&#38754;&#32534;&#31243;"><link rel="next" href="transaction.html" title="&#31532;&nbsp;7&nbsp;&#31456;&nbsp;&#20107;&#21153;&#31649;&#29702;"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">&#31532;&nbsp;6&nbsp;&#31456;&nbsp;&#38598;&#25104;AspectJ </th></tr><tr><td width="20%" align="left"><a accesskey="p" href="aop.html">&#19978;&#19968;&#39029;</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="transaction.html">&#19979;&#19968;&#39029;</a></td></tr></table><hr></div><div class="chapter" lang="zh_cn"><div class="titlepage"><div><div><h2 class="title"><a name="aspectj"></a>&#31532;&nbsp;6&nbsp;&#31456;&nbsp;&#38598;&#25104;AspectJ </h2></div></div><div></div></div><div class="sect1" lang="zh_cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e3868"></a>6.1.&nbsp;&#27010;&#36848;</h2></div></div><div></div></div><p> Spring&#22522;&#20110;&#20195;&#29702;&#30340;AOP&#26694;&#26550;&#24456;&#36866;&#21512;&#22788;&#29702;&#19968;&#33324;&#30340;&#20013;&#38388;&#20214;&#21644;&#29305;&#23450;&#24212;&#29992;&#30340;&#38382;&#39064;&#12290; 
      &#28982;&#32780;&#65292;&#26377;&#26102;&#65292;&#26356;&#24378;&#22823;&#30340;AOP&#26041;&#26696;&#20063;&#26159;&#38656;&#35201;&#30340;&#65292;&#20363;&#22914;&#65292;&#22914;&#26524;&#25105;&#20204;&#38656;&#35201;&#32473;&#19968;&#20010;&#31867;&#22686;&#21152;
      &#39069;&#22806;&#30340;&#23383;&#27573;&#65292; &#25110;&#32773;&#36890;&#30693;&#65288;Advise&#65289;&#19968;&#20010;&#19981;&#26159;&#30001;Spring IoC&#23481;&#22120;&#21019;&#24314;&#30340;&#32454;&#31890;&#24230;&#30340;&#23545;&#35937;&#12290;
    </p><p>We recommend the use of AspectJ in such cases. Accordingly, as of 
      version 1.1, Spring provides a powerful integration with AspectJ.</p><p>&#22240;&#20026;Spring&#24456;&#22909;&#30340;&#25972;&#21512;&#20102;AspectJ&#65292;&#25152;&#20197;&#36825;&#31181;&#24773;&#20917;&#19979;&#25105;&#20204;&#25512;&#33616;&#20351;&#29992;AspectJ&#12290;</p></div><div class="sect1" lang="zh_cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e3877"></a>6.2.&nbsp;&#20351;&#29992;Spring IoC&#37197;&#32622;AspectJ</h2></div></div><div></div></div><p> Spring/AspectJ&#38598;&#25104;&#26368;&#37325;&#35201;&#30340;&#37096;&#20998;&#26159;&#20801;&#35768;Spring&#30340;&#20381;&#36182;&#27880;&#23556;&#26469;&#37197;&#32622;AspectJ&#30340;aspect&#12290; 
      &#36825;&#32473;&#26041;&#38754;(aspect)&#21644;&#23545;&#35937;(object)&#24102;&#26469;&#20102;&#31867;&#20284;&#30340;&#22909;&#22788;&#12290;&#20363;&#22914;: </p><div class="itemizedlist"><ul type="disc"><li><p>Aspect&#19981;&#38656;&#35201;&#20351;&#29992;&#29305;&#23450;&#30340;&#37197;&#32622;&#26426;&#21046;&#65307;&#23427;&#20204;&#21487;&#20197;&#20351;&#29992;&#21644;&#25972;&#20010;&#24212;&#29992;&#30456;&#21516;&#30340;&#12289;&#19968;&#33268;&#30340;&#26041;&#27861;&#26469;&#37197;&#32622;&#12290; </p></li><li><p>&#8226;Aspect&#21487;&#20197;&#20381;&#36182;&#24212;&#29992;&#23545;&#35937;&#12290;&#20363;&#22914;&#65292;&#19968;&#20010;&#26435;&#38480;aspect&#21487;&#20197;&#20381;&#36182;&#19968;&#20010;&#26435;&#38480;&#31649;&#29702;&#23545;&#35937;&#65292;&#31245;&#21518;&#25105;&#20204;&#21487;&#20197;&#30475;&#21040;&#20363;&#23376;&#12290;</p></li><li><p>&#21487;&#20197;&#36890;&#36807;&#30456;&#20851;&#30340;Spring&#19978;&#19979;&#25991;&#65288;Context&#65289;&#33719;&#24471;&#19968;&#20010;aspect&#30340;&#24341;&#29992;&#65288;reference&#65289;&#65292;&#36825;&#21487;&#20197;&#20801;&#35768;&#21160;&#24577;&#30340;aspect&#37197;&#32622;&#12290;</p></li></ul></div><p> AspectJ &#30340;&#26041;&#24335;&#21487;&#20197;&#36890;&#36807;&#35774;&#20540;&#26041;&#24335;(setter)&#30340;&#27880;&#20837;Java 
      Bean&#30340;&#23646;&#24615;&#65292;&#20063;&#21487;&#20197;&#36890;&#36807;&#23454;&#29616;Spring&#30340;&#29983;&#21629;&#21608;&#26399;&#25509;&#21475;&#26469;&#23454;&#29616;&#65292;&#20363;&#22914;&#23454;&#29616; 
      <tt class="literal">BeanFactoryAware</tt>&#12290; 
    </p><i><span class="remark"> &#20540;&#24471;&#27880;&#24847;&#30340;&#26159;&#65292;AspectJ&#19981;&#33021;&#20351;&#29992;&#26500;&#36896;&#22120;&#27880;&#20837;&#26041;&#24335;&#21644;&#26041;&#27861;&#27880;&#20837;&#26041;&#24335;&#65292;
      &#36825;&#26159;&#30001;&#20110;aspect&#27809;&#26377;&#31867;&#20284;&#23545;&#35937;&#30340;&#26500;&#36896;&#22120;&#37027;&#26679;&#21487;&#20197;&#35843;&#29992;&#26041;&#27861;&#30340;&#21407;&#22240;&#12290; 
    </span></i><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="d0e3899"></a>6.2.1.&nbsp;&#8220;&#21333;&#20363;&#8221;aspect</h3></div></div><div></div></div><p>&#22823;&#22810;&#25968;&#24773;&#20917;&#19979;&#65292;AspectJ&#30340;aspect&#26159;&#21333;&#20363;&#30340;&#65292;&#27599;&#20010;&#31867;&#35013;&#36733;&#22120;&#19968;&#20010;&#23454;&#20363;&#65292;
        &#36825;&#20010;&#21333;&#19968;&#30340;&#23454;&#20363;&#36127;&#36131;&#36890;&#30693;&#65288;advising&#65289;&#22810;&#20010;&#23545;&#35937;&#23454;&#20363;&#12290;</p><p>Spring IoC&#23481;&#22120;&#19981;&#33021;&#23454;&#20363;&#21270;aspect&#65292;&#22240;&#20026;&#65292;aspect&#27809;&#26377;&#21487;&#35843;&#29992;&#30340;&#26500;&#36896;&#22120;&#12290;
        &#20294;&#26159;&#65292;&#23427;&#21487;&#20197;&#20351;&#29992;AspectJ&#20026;&#25152;&#26377;aspect&#23450;&#20041;&#30340;&#38745;&#24577;&#26041;&#27861;aspectOf()&#33719;&#24471;&#19968;&#20010;
        aspect&#30340;&#24341;&#29992;&#65292;&#24182;&#19988;&#65292;&#33021;&#22815;&#25226;&#20381;&#36182;&#27880;&#20837;aspect&#12290;</p><div class="sect3" lang="zh_cn"><div class="titlepage"><div><div><h4 class="title"><a name="d0e3906"></a>6.2.1.1.&nbsp;&#20030;&#20363;</h4></div></div><div></div></div><p>&#32771;&#34385;&#19968;&#20010;&#20851;&#20110;&#23433;&#20840;&#30340;aspect&#65292;&#23427;&#20381;&#36182;&#20110;&#19968;&#20010;&#23433;&#20840;&#31649;&#29702;&#23545;&#35937;&#12290;&#36825;&#20010;aspect&#24212;&#29992;&#20110;
          Account&#31867;&#20013;&#23454;&#20363;&#21464;&#37327;balance&#30340;&#25152;&#26377;&#30340;&#20540;&#21464;&#21270;&#12290;&#65288;&#25105;&#20204;&#19981;&#33021;&#22815;&#20197;&#21516;&#26679;&#26041;&#27861;&#20351;
          &#29992;Spring AOP&#20570;&#21040;&#36825;&#28857;&#12290;&#65289;</p><p>AspectJ&#20013;aspect&#30340;&#20195;&#30721;&#65288;Spring/AspectJ&#30340;&#19968;&#20010;&#20363;&#23376;&#65289;&#65292;&#26174;&#31034;&#22914;&#19979;&#12290;&#27880;&#24847;&#65292;
          &#23545;SecurityManager&#25509;&#21475;&#30340;&#20381;&#36182;&#22312;Java Bean&#30340;&#23646;&#24615;&#20013;&#35828;&#26126;&#12290;</p><p>
          </p><pre class="programlisting">public aspect BalanceChangeSecurityAspect { private 
            SecurityManager securityManager; public void 
            setSecurityManager(SecurityManager securityManager) { 
            this.securityManager = securityManager; } private pointcut 
            balanceChanged() : set(int Account.balance); before() : 
            balanceChanged() { this.securityManager.checkAuthorizedToModify(); 
            } }</pre><p>
        </p><p>&#25105;&#20204;&#37197;&#32622;&#36825;&#20010;aspect&#30340;&#26041;&#24335;&#21644;&#26222;&#36890;&#31867;&#26159;&#19968;&#26679;&#30340;&#12290;&#27880;&#24847;&#65292;&#25105;&#20204;&#35774;&#32622;&#23646;&#24615;&#24341;&#29992;
          &#30340;&#26041;&#24335;&#26159;&#23436;&#20840;&#30456;&#21516;&#30340;&#12290;&#27880;&#24847;&#65292;&#25105;&#20204;&#24517;&#39035;&#20351;&#29992;factory-method&#23646;&#24615;&#26469;&#25351;&#23450;&#20351;&#29992;
          aspectOf()&#38745;&#24577;&#26041;&#27861;&#8221;&#21019;&#24314;&#8221;&#36825;&#20010;aspect&#12290;&#23454;&#38469;&#19978;&#65292;&#26159;&#23450;&#20301;&#65288;locating&#65289;&#65292;
          &#32780;&#38750;&#21019;&#24314;&#65288;creating&#65289;&#36825;&#20010;aspect&#65292;&#20294;Spring&#23481;&#22120;&#19981;&#20851;&#24515;&#36825;&#20123;&#12290;</p><p>
          </p><pre class="programlisting">&lt;bean id="securityAspect" 
            class="org.springframework.samples.aspectj.bank.BalanceChangeSecurityAspect" 
            factory-method="aspectOf" &gt; &lt;property 
            name="securityManager"&gt; &lt;ref 
            local="securityManager"/&gt; &lt;/property&gt; 
            &lt;/bean&gt;</pre><p>
        </p><p>&#25105;&#20204;&#19981;&#38656;&#35201;&#22312;Spring&#37197;&#32622;&#20013;&#20570;&#20219;&#20309;&#20107;&#24773;&#21435;&#23450;&#20301;&#65288;target&#65289;&#36825;&#20010;aspect&#12290;
          &#22312;&#36825;&#20010;aspect&#30340;&#25511;&#21046;&#36866;&#29992;&#22320;&#26041;&#30340;AspectJ&#20195;&#30721;&#37324;&#65292;&#21253;&#21547;&#20102;&#20999;&#20837;&#28857;&#65288;pointcut&#65289;
          &#30340;&#20449;&#24687;&#12290;&#36825;&#26679;&#23427;&#29978;&#33267;&#33021;&#22815;&#36866;&#29992;&#20110;&#19981;&#34987;Spring IoC&#23481;&#22120;&#31649;&#29702;&#30340;&#23545;&#35937;&#12290;</p></div><div class="sect3" lang="zh_cn"><div class="titlepage"><div><div><h4 class="title"><a name="d0e3927"></a>6.2.1.2.&nbsp;&#25490;&#24207;&#38382;&#39064;</h4></div></div><div></div></div><p>&#24453;&#23436;&#25104;</p></div></div><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="d0e3932"></a>6.2.2.&nbsp;&#38750;&#21333;&#20363;aspect</h3></div></div><div></div></div><p>** &#25353;&#27599;&#20010;&#30446;&#26631;&#23436;&#25104;&#36164;&#26009;&#65292;&#31561;&#31561;&#12290;&#65288;Complete material on per target etc&#65289;</p></div><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="d0e3937"></a>6.2.3.&nbsp;3.4	&#36716;&#21521;&#65288;Gotchas&#65289;</h3></div></div><div></div></div><p>&#24453;&#23436;&#25104;</p><p>- &#21333;&#20363;&#38382;&#39064;</p></div></div><div class="sect1" lang="zh_cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e3944"></a>6.3.&nbsp;&#20351;&#29992;AspectJ&#20999;&#28857;&#23450;&#20301;Spring&#30340;&#24314;&#35758;</h2></div></div><div></div></div><p>&#22312;Spring&#23558;&#26469;&#30340;&#29256;&#26412;&#20013;&#65292;&#25105;&#20204;&#35745;&#21010;&#25903;&#25345;&#22312;Spring XML&#25110;&#32773;&#20854;&#23427;&#30340;Bean&#23450;&#20041;
    &#25991;&#20214;&#20013;&#20351;&#29992;AspectJ&#30340;&#20999;&#20837;&#28857;&#34920;&#36798;&#24335;&#26469;&#23450;&#20301;Spring&#36890;&#30693;&#65288;advice&#65289;&#12290;&#36825;&#23558;&#20801;&#35768;
    AspectJ&#20999;&#20837;&#28857;&#27169;&#22411;&#30340;&#26576;&#20123;&#33021;&#21147;&#34987;&#24212;&#29992;&#22312;Spring&#22522;&#20110;&#20195;&#29702;&#30340;AOP&#26694;&#26550;&#12290;&#36825;&#23558;&#21487;&#20197;&#22312;
    &#32431;Java&#20013;&#24037;&#20316;&#65292;&#24182;&#19988;&#19981;&#38656;&#35201;AspectJ&#32534;&#35793;&#22120;&#12290;&#20165;&#20165;AspectJ&#20999;&#20837;&#28857;&#30456;&#20851;&#30340;&#26041;&#27861;&#35843;&#29992;&#30340;
    &#23376;&#38598;&#26159;&#21487;&#29992;&#30340;&#12290;
    </p><p>&#36825;&#20010;&#29305;&#24615;&#35745;&#21010;&#22312;Spring 1.2&#29256;&#26412;&#20013;&#25552;&#20379;&#65292;&#23427;&#26377;&#36182;&#20110;AspectJ&#30340;&#22686;&#24378;&#12290;</p><p>&#36825;&#20010;&#29305;&#24615;&#26367;&#20195;&#20102;&#25105;&#20204;&#20808;&#21069;&#20026;Spring&#21019;&#24314;&#19968;&#20010;&#20999;&#20837;&#28857;&#34920;&#36798;&#24335;&#35821;&#35328;&#30340;&#35745;&#21010;&#12290;</p></div><div class="sect1" lang="zh_cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e3953"></a>6.4.&nbsp;Spring&#25552;&#20379;&#32473;AspectJ&#30340;aspect</h2></div></div><div></div></div><p>&#22312;&#23558;&#26469;&#30340;Spring&#29256;&#26412;&#20013;&#65288;&#21487;&#33021;&#26159;1.2&#65289;&#65292;&#25105;&#20204;&#23558;&#21152;&#20837;&#19968;&#20123;Spring&#30340;&#26381;&#21153;&#20316;&#20026;
      AspectJ&#30340;aspect&#65292;&#20687;&#22768;&#26126;&#24615;&#20107;&#21153;&#26381;&#21153;&#12290;&#36825;&#23558;&#20801;&#35768;AspectJ&#30340;&#29992;&#25143;&#20351;&#29992;&#36825;&#20123;&#26381;&#21153;&#65292;
      &#32780;&#26080;&#38656;&#28508;&#22312;&#22320;&#20381;&#36182;&#20110;Spring&#30340;AOP&#26694;&#26550;&#65292;&#29978;&#33267;&#65292;&#19981;&#24517;&#20381;&#36182;Spring IoC&#23481;&#22120;&#12290;</p><p>AspectJ&#30340;&#29992;&#25143;&#21487;&#33021;&#27604;Spring&#29992;&#25143;&#23545;&#36825;&#20010;&#29305;&#24615;&#26356;&#24863;&#20852;&#36259;&#12290;</p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="aop.html">&#19978;&#19968;&#39029;</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="index.html">&#19978;&#19968;&#32423;</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="transaction.html">&#19979;&#19968;&#39029;</a></td></tr><tr><td width="40%" align="left" valign="top">&#31532;&nbsp;5&nbsp;&#31456;&nbsp;Spring AOP: Spring&#20043;&#38754;&#21521;&#26041;&#38754;&#32534;&#31243;&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">&#36215;&#22987;&#39029;</a></td><td width="40%" align="right" valign="top">&nbsp;&#31532;&nbsp;7&nbsp;&#31456;&nbsp;&#20107;&#21153;&#31649;&#29702;</td></tr></table></div></body></html>