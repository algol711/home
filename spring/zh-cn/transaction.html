<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>&#31532;&nbsp;7&nbsp;&#31456;&nbsp;&#20107;&#21153;&#31649;&#29702;</title><link rel="stylesheet" href="../styles/html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.65.1"><link rel="home" href="index.html" title="Spring - Java/J2EE Application Framework"><link rel="up" href="index.html" title="Spring - Java/J2EE Application Framework"><link rel="previous" href="aspectj.html" title="&#31532;&nbsp;6&nbsp;&#31456;&nbsp;&#38598;&#25104;AspectJ "><link rel="next" href="metadata.html" title="&#31532;&nbsp;8&nbsp;&#31456;&nbsp;&#28304;&#20195;&#30721;&#32423;&#30340;&#20803;&#25968;&#25454;&#25903;&#25345;"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">&#31532;&nbsp;7&nbsp;&#31456;&nbsp;&#20107;&#21153;&#31649;&#29702;</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="aspectj.html">&#19978;&#19968;&#39029;</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="metadata.html">&#19979;&#19968;&#39029;</a></td></tr></table><hr></div><div class="chapter" lang="zh_cn"><div class="titlepage"><div><div><h2 class="title"><a name="transaction"></a>&#31532;&nbsp;7&nbsp;&#31456;&nbsp;&#20107;&#21153;&#31649;&#29702;</h2></div></div><div></div></div><div class="sect1" lang="zh_cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e3963"></a>7.1.&nbsp;Spring&#20107;&#21153;&#25277;&#35937;</h2></div></div><div></div></div><p>Spring&#25552;&#20379;&#20102;&#19968;&#33268;&#30340;&#20107;&#21153;&#31649;&#29702;&#25277;&#35937;&#12290;&#36825;&#20010;&#25277;&#35937;&#26159;Spring&#26368;&#37325;&#35201;&#30340;&#25277;&#35937;&#20043;&#19968;&#65292;
        &#23427;&#26377;&#22914;&#19979;&#30340;&#20248;&#28857;&#65306;</p><div class="itemizedlist"><ul type="disc"><li><p>&#20026;&#19981;&#21516;&#30340;&#20107;&#21153;API&#25552;&#20379;&#19968;&#33268;&#30340;&#32534;&#31243;&#27169;&#22411;&#65292;&#22914;JTA&#12289;JDBC&#12289;Hibernate&#12289;iBATIS&#25968;&#25454;&#24211;&#23618;
          &#21644;JDO</p></li><li><p>&#25552;&#20379;&#27604;&#22823;&#22810;&#25968;&#20107;&#21153;API&#26356;&#31616;&#21333;&#30340;&#65292;&#26131;&#20110;&#20351;&#29992;&#30340;&#32534;&#31243;&#24335;&#20107;&#21153;&#31649;&#29702;API</p></li><li><p>&#25972;&#21512;Spring&#25968;&#25454;&#35775;&#38382;&#25277;&#35937;</p></li><li><p>&#25903;&#25345;Spring&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;</p></li></ul></div><p>&#20256;&#32479;&#19978;&#65292;J2EE&#24320;&#21457;&#32773;&#26377;&#20004;&#20010;&#20107;&#21153;&#31649;&#29702;&#30340;&#36873;&#25321;: <span class="emphasis"><em>&#20840;&#23616;</em></span>&#20107;&#21153;&#25110;
        <span class="emphasis"><em>&#23616;&#37096;</em></span>&#20107;&#21153;&#12290;&#20840;&#23616;&#20107;&#21153;&#30001;&#24212;&#29992;&#26381;&#21153;&#22120;&#31649;&#29702;&#65292;&#20351;&#29992;JTA&#12290;&#23616;&#37096;
        &#20107;&#21153;&#26159;&#21644;&#36164;&#28304;&#30456;&#20851;&#30340;&#65306;&#20363;&#22914;&#65292;&#19968;&#20010;&#21644;JDBC&#36830;&#25509;&#20851;&#32852;&#30340;&#20107;&#21153;&#12290;&#36825;&#20010;&#36873;&#25321;&#26377;&#28145;&#21051;&#30340;&#21547;&#20041;&#12290;
        &#20840;&#23616;&#20107;&#21153;&#21487;&#20197;&#29992;&#20110;&#22810;&#20010;&#20107;&#21153;&#24615;&#30340;&#36164;&#28304;&#65288;&#38656;&#35201;&#25351;&#20986;&#30340;&#26159;&#22810;&#25968;&#24212;&#29992;&#20351;&#29992;&#21333;&#19968;&#20107;&#21153;&#24615;
        &#30340;&#36164;&#28304;&#65289;&#12290;&#20351;&#29992;&#23616;&#37096;&#20107;&#21153;&#65292;&#24212;&#29992;&#26381;&#21153;&#22120;&#19981;&#38656;&#35201;&#21442;&#19982;&#20107;&#21153;&#31649;&#29702;&#65292;&#24182;&#19988;&#19981;&#33021;&#24110;&#21161;&#30830;&#20445;
        &#36328;&#36234;&#22810;&#20010;&#36164;&#28304;&#30340;&#20107;&#21153;&#30340;&#27491;&#30830;&#24615;&#12290;</p><p>&#20840;&#23616;&#20107;&#21153;&#26377;&#19968;&#20010;&#26174;&#33879;&#30340;&#19981;&#21033;&#26041;&#38754;&#65292;&#20195;&#30721;&#38656;&#35201;&#20351;&#29992;JTA&#65306;&#19968;&#20010;&#31528;&#37325;&#30340;API&#65288;&#37096;&#20998;&#26159;
        &#22240;&#20026;&#23427;&#30340;&#24322;&#24120;&#27169;&#22411;&#65289;&#12290;&#27492;&#22806;&#65292;JTA&#30340;<tt class="literal">UserTransaction</tt>&#36890;&#24120;&#38656;
        &#35201;&#20174;JNDI&#33719;&#24471;&#65292;&#36825;&#24847;&#21619;&#30528;&#25105;&#20026;&#20102;JTA&#38656;&#35201;<span class="emphasis"><em>&#21516;&#26102;</em></span>&#20351;&#29992;JNDI&#21644;JTA&#12290;
        &#26174;&#28982;&#20840;&#37096;&#20351;&#29992;&#20840;&#23616;&#20107;&#21153;&#38480;&#21046;&#20102;&#24212;&#29992;&#20195;&#30721;&#30340;&#37325;&#29992;&#24615;&#65292;&#22240;&#20026;JTA&#36890;&#24120;&#21482;&#22312;&#24212;&#29992;&#26381;
        &#21153;&#22120;&#30340;&#29615;&#22659;&#20013;&#25165;&#33021;&#20351;&#29992;&#12290;</p><p>&#20351;&#29992;&#20840;&#23616;&#20107;&#21153;&#30340;&#27604;&#36739;&#22909;&#30340;&#26041;&#27861;&#26159;&#36890;&#36807;EJB&#30340;<span class="emphasis"><em>CMT</em></span> 
        &#65288;<span class="emphasis"><em>&#23481;&#22120;&#31649;&#29702;&#30340;&#20107;&#21153;</em></span>&#65289;&#65306;<span class="bold"><b>
        &#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;</b></span>&#30340;&#19968;&#31181;&#24418;&#24335;&#65288;&#21306;&#21035;&#20110;<span class="bold"><b>&#32534;&#31243;&#24335;&#20107;&#21153;&#31649;&#29702;
        </b></span>&#65289;&#12290;EJB&#30340;CMT&#19981;&#38656;&#35201;&#20219;&#20309;&#21644;&#20107;&#21153;&#30456;&#20851;&#30340;JNDI&#26597;&#25214;&#65292;&#34429;&#28982;&#20351;&#29992;EJB&#26412;&#36523;
        &#32943;&#23450;&#38656;&#35201;&#20351;&#29992;JNDI&#12290;&#23427;&#28040;&#38500;&#22823;&#22810;&#25968;&#8212;&#8212;&#19981;&#26159;&#20840;&#37096;&#8212;&#8212;&#20070;&#20889;Java&#20195;&#30721;&#25511;&#21046;&#20107;&#21153;&#30340;&#38656;&#27714;&#12290;
        &#26174;&#33879;&#30340;&#32570;&#28857;&#26159;CMT&#32465;&#23450;&#22312;JTA&#21644;&#24212;&#29992;&#26381;&#21153;&#22120;&#29615;&#22659;&#19978;&#65292;&#24182;&#19988;&#21482;&#26377;&#25105;&#20204;&#36873;&#25321;
        &#20351;&#29992;EJB&#23454;&#29616;&#19994;&#21153;&#36923;&#36753;&#65292;&#25110;&#32773;&#33267;&#23569;&#22788;&#20110;&#19968;&#20010;&#20107;&#21153;&#21270;EJB&#30340;&#22806;&#35266;&#65288;Facade&#65289;&#21518;
        &#25165;&#33021;&#20351;&#29992;&#23427;&#12290;EJB&#26377;&#22914;&#27492;&#22810;&#30340;&#35807;&#30149;&#65292;&#24403;&#23384;&#22312;&#20854;&#23427;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;&#26102;&#65292;
        EJB&#19981;&#26159;&#19968;&#20010;&#21560;&#24341;&#20154;&#30340;&#24314;&#35758;&#12290;</p><p>&#23616;&#37096;&#20107;&#21153;&#23481;&#26131;&#20351;&#29992;&#65292;&#20294;&#20063;&#26377;&#26126;&#26174;&#30340;&#32570;&#28857;&#65306;&#23427;&#20204;&#19981;&#33021;&#29992;&#20110;&#22810;&#20010;&#20107;&#21153;&#24615;&#36164;
        &#28304;&#65292;&#24182;&#19988;&#36235;&#21521;&#20405;&#20837;&#30340;&#32534;&#31243;&#27169;&#22411;&#12290;&#20363;&#22914;&#65292;&#20351;&#29992;JDBC&#36830;&#25509;&#20107;&#21153;&#31649;&#29702;&#30340;&#20195;&#30721;&#19981;&#33021;&#29992;&#20110;
        &#20840;&#23616;&#30340;JTA&#20107;&#21153;&#20013;&#12290;</p><p>Spring&#35299;&#20915;&#20102;&#36825;&#20123;&#38382;&#39064;&#12290;&#23427;&#20351;&#24212;&#29992;&#24320;&#21457;&#32773;&#33021;&#22815;&#20351;&#29992;&#22312;<span class="emphasis"><em>&#20219;&#20309;&#29615;&#22659;</em></span>
        &#19979;&#20351;&#29992;&#19968;&#33268;&#30340;&#32534;&#31243;&#27169;&#22411;&#12290;&#20320;&#21487;&#20197;&#21482;&#20889;&#19968;&#27425;&#20320;&#30340;&#20195;&#30721;&#65292;&#36825;&#22312;&#19981;&#21516;&#29615;&#22659;
        &#19979;&#30340;&#19981;&#21516;&#20107;&#21153;&#31649;&#29702;&#31574;&#30053;&#20013;&#24456;&#26377;&#30410;&#22788;&#12290;Spring&#21516;&#26102;&#25552;&#20379;&#22768;&#26126;&#24335;&#21644;&#32534;&#31243;&#24335;&#20107;&#21153;&#31649;&#29702;&#12290;</p><p>&#20351;&#29992;&#32534;&#31243;&#24335;&#20107;&#21153;&#31649;&#29702;&#65292;&#24320;&#21457;&#32773;&#30452;&#25509;&#20351;&#29992;Spring&#20107;&#21153;&#25277;&#35937;&#65292;&#36825;&#20010;&#25277;&#35937;&#21487;&#20197;&#20351;&#29992;&#22312;&#20219;&#20309;
        &#24213;&#23618;&#20107;&#21153;&#22522;&#30784;&#20043;&#19978;&#12290;&#20351;&#29992;&#39318;&#36873;&#30340;&#22768;&#26126;&#24335;&#27169;&#22411;&#65292;&#24320;&#21457;&#32773;&#36890;&#24120;&#20070;&#20889;&#24456;&#23569;&#30340;&#20107;&#21153;&#30456;&#20851;&#20195;
        &#30721;&#65292;&#22240;&#27492;&#19981;&#20381;&#36182;Spring&#25110;&#20219;&#20309;&#20854;&#20182;&#20107;&#21153;API&#12290;</p></div><div class="sect1" lang="zh_cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e4020"></a>7.2.&nbsp;&#20107;&#21153;&#31574;&#30053;</h2></div></div><div></div></div><p>Spring&#20107;&#21153;&#25277;&#35937;&#30340;&#20851;&#38190;&#26159;<span class="emphasis"><em>&#20107;&#21153;&#31574;&#30053;</em></span>&#30340;&#27010;&#24565;&#12290;</p><p>&#36825;&#20010;&#27010;&#24565;&#30001;
        <tt class="literal">org.springframework.transaction.PlatformTransactionManager</tt>
        &#25509;&#21475;&#20307;&#29616;&#65292;&#22914;&#19979;&#65306;
    </p><pre class="programlisting">public interface PlatformTransactionManager {

    TransactionStatus getTransaction(TransactionDefinition definition)
        throws TransactionException;

    void commit(TransactionStatus status) throws TransactionException;

    void rollback(TransactionStatus status) throws TransactionException;
}</pre><p>&#36825;&#39318;&#20808;&#26159;&#19968;&#20010;SPI&#25509;&#21475;&#65292;&#34429;&#28982;&#23427;&#20063;&#21487;&#20197;&#22312;&#32534;&#30721;&#20013;&#20351;&#29992;&#12290;&#27880;&#24847;&#25353;&#29031;Spring&#30340;&#21746;&#23398;&#65292;
        &#36825;&#26159;&#19968;&#20010;<span class="emphasis"><em>&#25509;&#21475;</em></span>&#12290;&#22240;&#32780;&#22914;&#26524;&#38656;&#35201;&#23427;&#21487;&#20197;&#24456;&#23481;&#26131;&#22320;&#34987;&#27169;&#25311;&#21644;
        &#26729;&#21270;&#12290;&#23427;&#20063;&#27809;&#26377;&#21644;&#19968;&#20010;&#26597;&#25214;&#31574;&#30053;&#22914;JNDI&#25414;&#32465;&#22312;&#19968;&#36215;&#65306;PlatformTransactionManager
        &#30340;&#23454;&#29616;&#23450;&#20041;&#21644;&#20854;&#20182;Spring IoC&#23481;&#22120;&#20013;&#30340;&#23545;&#35937;&#19968;&#26679;&#12290;&#36825;&#20010;&#22909;&#22788;&#20351;&#24471;&#21363;&#20351;&#20351;&#29992;JTA&#65292;&#20063;
        &#26159;&#19968;&#20010;&#24456;&#26377;&#20215;&#20540;&#30340;&#25277;&#35937;&#65306;&#20107;&#21153;&#20195;&#30721;&#21487;&#20197;&#27604;&#30452;&#25509;&#20351;&#29992;JTA&#26356;&#21152;&#23481;&#26131;&#27979;&#35797;&#12290;</p><p>&#32487;&#32493;Spring&#21746;&#23398;&#65292;<tt class="literal">TransactionException</tt>&#26159;unchecked&#30340;&#12290;
        &#20302;&#23618;&#30340;&#20107;&#21153;&#22833;&#36133;&#20960;&#20046;&#37117;&#26159;&#33268;&#21629;&#12290;&#24456;&#23569;&#24773;&#20917;&#19979;&#24212;&#29992;&#31243;&#24207;&#20195;&#30721;&#21487;&#20197;&#20174;&#23427;&#20204;
        &#20013;&#24674;&#22797;&#65292;&#19981;&#36807;&#24212;&#29992;&#24320;&#21457;&#32773;&#20381;&#28982;&#21487;&#20197;&#25429;&#33719;&#24182;&#22788;&#29702;
        <tt class="literal">TransactionException</tt>&#12290;</p><p><tt class="literal">getTransaction()</tt>&#26681;&#25454;&#19968;&#20010;&#31867;&#22411;&#20026;
        <tt class="literal">TransactionDefinition</tt>&#30340;&#21442;&#25968;&#36820;&#22238;&#19968;&#20010;
        <tt class="literal">TransactionStatus</tt>&#23545;&#35937;&#12290;&#36820;&#22238;&#30340;
        <tt class="literal">TransactionStatus</tt>&#23545;&#35937;&#21487;&#33021;&#20195;&#34920;&#19968;&#20010;&#26032;&#30340;&#25110;&#24050;&#32463;&#23384;&#22312;&#30340;&#20107;
        &#21153;&#65288;&#22914;&#26524;&#22312;&#24403;&#21069;&#35843;&#29992;&#22534;&#26632;&#26377;&#19968;&#20010;&#31526;&#21512;&#26465;&#20214;&#30340;&#20107;&#21153;&#65289;&#12290;</p><p>&#22914;&#21516;J2EE&#20107;&#21153;&#19978;&#19979;&#25991;&#19968;&#26679;&#65292;&#19968;&#20010;<tt class="literal">TransactionStatus</tt>&#20063;&#26159;&#21644;&#25191;
        &#34892;&#30340;<span class="bold"><b>&#32447;&#31243;</b></span>&#20851;&#32852;&#30340;&#12290;</p><p><tt class="literal">TransactionDefinition</tt>&#25509;&#21475;&#25351;&#23450;&#65306;</p><div class="itemizedlist"><ul type="disc"><li><p><span class="bold"><b>&#20107;&#21153;&#38548;&#31163;</b></span>&#65306;&#24403;&#21069;&#20107;&#21153;&#21644;&#20854;&#23427;&#20107;&#21153;&#30340;&#38548;&#31163;&#30340;&#31243;&#24230;&#12290;
        &#20363;&#22914;&#65292;&#36825;&#20010;&#20107;&#21153;&#33021;&#21542;&#30475;&#21040;&#20854;&#20182;&#20107;&#21153;&#26410;&#25552;&#20132;&#30340;&#20889;&#25968;&#25454;&#65311;</p></li><li><p><span class="bold"><b>&#20107;&#21153;&#20256;&#25773;</b></span>&#65306;&#36890;&#24120;&#22312;&#19968;&#20010;&#20107;&#21153;&#20013;&#25191;&#34892;&#30340;
            &#25152;&#26377;&#20195;&#30721;&#37117;&#20250;&#22312;&#36825;&#20010;&#20107;&#21153;&#20013;&#36816;&#34892;&#12290;&#20294;&#26159;&#65292;&#22914;&#26524;&#19968;&#20010;&#20107;&#21153;&#19978;&#19979;&#25991;&#24050;&#32463;&#23384;&#22312;&#65292;
            &#26377;&#20960;&#20010;&#36873;&#39033;&#21487;&#20197;&#25351;&#23450;&#19968;&#20010;&#20107;&#21153;&#24615;&#26041;&#27861;&#30340;&#25191;&#34892;&#34892;&#20026;&#65306;&#20363;&#22914;&#65292;&#31616;&#21333;&#22320;&#22312;&#29616;&#26377;&#30340;
            &#20107;&#21153;&#20013;&#36816;&#34892;&#65288;&#22823;&#22810;&#25968;&#24773;&#20917;&#65289;&#65307;&#25110;&#32773;&#25346;&#36215;&#29616;&#26377;&#20107;&#21153;&#65292;&#21019;&#24314;&#19968;&#20010;&#26032;&#30340;&#20107;&#21153;&#12290;
            Spring&#25552;&#20379;EJB CMT&#20013;&#29087;&#24713;&#30340;&#20107;&#21153;&#20256;&#25773;&#36873;&#39033;&#12290;</p></li><li><p><span class="bold"><b>&#20107;&#21153;&#36229;&#26102;</b></span>: &#20107;&#21153;&#22312;&#36229;&#26102;&#21069;&#33021;&#36816;&#34892;&#22810;
            &#20037;&#65288;&#33258;&#21160;&#34987;&#24213;&#23618;&#30340;&#20107;&#21153;&#22522;&#30784;&#35774;&#26045;&#22238;&#28378;&#65289;&#12290;</p></li><li><p><span class="bold"><b>&#21482;&#35835;&#29366;&#24577;</b></span>: &#21482;&#35835;&#20107;&#21153;&#19981;&#20462;&#25913;&#20219;&#20309;&#25968;
            &#25454;&#12290;&#21482;&#35835;&#20107;&#21153;&#22312;&#26576;&#20123;&#24773;&#20917;&#19979;&#65288;&#20363;&#22914;&#24403;&#20351;&#29992;Hibernate&#26102;&#65289;&#21487;&#21487;&#26159;&#19968;&#31181;&#38750;&#24120;&#26377;&#29992;&#30340;&#20248;&#21270;&#12290;
            </p></li></ul></div><p>&#36825;&#20123;&#35774;&#32622;&#21453;&#26144;&#20102;&#26631;&#20934;&#27010;&#24565;&#12290;&#22914;&#26524;&#38656;&#35201;&#65292;&#35831;&#26597;&#38405;&#35752;&#35770;&#20107;&#21153;&#38548;&#31163;&#23618;&#27425;&#21644;&#20854;&#20182;&#26680;&#24515;&#20107;
        &#21153;&#27010;&#24565;&#30340;&#36164;&#28304;&#65306;&#29702;&#35299;&#36825;&#20123;&#27010;&#24565;&#22312;&#20351;&#29992;Spring&#21644;&#20854;&#20182;&#20107;&#21153;&#31649;&#29702;&#35299;&#20915;&#26041;&#26696;&#26102;&#26159;&#38750;&#24120;&#20851;&#38190;&#30340;&#12290;
        </p><p><tt class="literal">TransactionStatus</tt>&#25509;&#21475;&#20026;&#22788;&#29702;&#20107;&#21153;&#30340;&#20195;&#30721;&#25552;&#20379;&#19968;&#20010;&#31616;&#21333;
        &#30340;&#25511;&#21046;&#20107;&#21153;&#25191;&#34892;&#21644;&#26597;&#35810;&#20107;&#21153;&#29366;&#24577;&#30340;&#26041;&#27861;&#12290;&#36825;&#20010;&#27010;&#24565;&#24212;&#35813;&#26159;&#29087;&#24713;&#30340;&#65292;&#22240;&#20026;&#23427;&#20204;&#22312;&#25152;
        &#26377;&#30340;&#20107;&#21153;API&#20013;&#26159;&#30456;&#21516;&#30340;:</p><pre class="programlisting">public interface TransactionStatus {

    boolean isNewTransaction();

    void setRollbackOnly();

    boolean isRollbackOnly();
}</pre><p>&#20294;&#26159;&#20351;&#29992;Spring&#20107;&#21153;&#31649;&#29702;&#26102;&#65292;&#23450;&#20041;
    <tt class="literal">PlatformTransactionManager</tt>&#30340;&#23454;&#29616;&#26159;&#22522;&#26412;&#26041;&#24335;&#12290;&#22312;&#22909;&#30340;Spring
    &#39118;&#26684;&#20013;&#65292;&#36825;&#20010;&#37325;&#35201;&#23450;&#20041;&#20351;&#29992;IoC&#23454;&#29616;&#12290;</p><p><tt class="literal">PlatformTransactionManager</tt>&#23454;&#29616;&#36890;&#24120;&#38656;&#35201;&#20102;&#35299;&#23427;&#20204;&#24037;&#20316;
        &#30340;&#29615;&#22659;&#65306;JDBC&#12289;JTA&#12289;Hibernate&#31561;&#31561;&#12290;</p><p>&#19979;&#38754;&#26469;&#33258;Spring&#33539;&#20363;<span class="bold"><b>jPetstore</b></span>&#20013;&#30340;
        <tt class="literal">dataAccessContext-local.xml</tt>&#65292;&#23427;&#23637;&#31034;&#20102;&#19968;&#20010;&#23616;&#37096;
        PlatformTransactionManager&#23454;&#29616;&#26159;&#22914;&#20309;&#23450;&#20041;&#30340;&#12290;&#23427;&#23558;&#21644;JDBC&#19968;&#36215;&#24037;&#20316;&#12290;</p><p>&#25105;&#20204;&#24517;&#39035;&#23450;&#20041;JDBC&#25968;&#25454;&#28304;&#65292;&#28982;&#21518;&#20351;&#29992;DataSourceTransactionManager&#65292;&#25552;&#20379;&#32473;
        &#23427;&#30340;&#19968;&#20010;&#25968;&#25454;&#28304;&#24341;&#29992;&#12290;</p><pre class="programlisting">&lt;bean id="dataSource" 
    class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close"&gt;
    &lt;property name="driverClassName"&gt;&lt;value&gt;${jdbc.driverClassName}&lt;/value&gt;&lt;/property&gt;
    &lt;property name="url"&gt;&lt;value&gt;${jdbc.url}&lt;/value&gt;&lt;/property&gt;
    &lt;property name="username"&gt;&lt;value&gt;${jdbc.username}&lt;/value&gt;&lt;/property&gt;
    &lt;property name="password"&gt;&lt;value&gt;${jdbc.password}&lt;/value&gt;&lt;/property&gt;
&lt;/bean&gt;</pre><p>PlatformTransactionManager&#23450;&#20041;&#22914;&#19979;&#65306;</p><pre class="programlisting">&lt;bean id="transactionManager" 
    class="org.springframework.jdbc.datasource.DataSourceTransactionManager"&gt;
    &lt;property name="dataSource"&gt;&lt;ref local="dataSource"/&gt;&lt;/property&gt;
&lt;/bean&gt;</pre><p>&#22914;&#26524;&#25105;&#20204;&#20351;&#29992;JTA&#65292;&#22914;&#21516;&#33539;&#20363;&#20013;<tt class="literal">dataAccessContext-jta.xml</tt>&#65292;
        &#25105;&#20204;&#38656;&#35201;&#20351;&#29992;&#36890;&#36807;JNDI&#33719;&#24471;&#30340;&#23481;&#22120;&#25968;&#25454;&#28304;&#65292;&#21644;&#19968;&#20010;JtaTransactionManager&#23454;
        &#29616;&#12290;JtaTransactionManager&#19981;&#38656;&#35201;&#30693;&#36947;&#25968;&#25454;&#28304;&#65292;&#25110;&#20219;&#20309;&#20854;&#20182;&#29305;&#23450;&#36164;&#28304;&#65292;&#22240;&#20026;&#23427;&#23558;
        &#20351;&#29992;&#23481;&#22120;&#30340;&#20840;&#23616;&#20107;&#21153;&#31649;&#29702;&#12290;</p><pre class="programlisting">&lt;bean id="dataSource" class="org.springframework.jndi.JndiObjectFactoryBean"&gt;
    &lt;property name="jndiName"&gt;&lt;value&gt;jdbc/jpetstore&lt;/value&gt;&lt;/property&gt;
&lt;/bean&gt;

&lt;bean id="transactionManager" 
    class="org.springframework.transaction.jta.JtaTransactionManager"/&gt;</pre><p>
    &#25105;&#20204;&#21487;&#20197;&#24456;&#23481;&#26131;&#22320;&#20351;&#29992;Hibernate&#23616;&#37096;&#20107;&#21153;&#65292;&#22914;&#21516;&#19979;&#38754;Spring&#30340;<span class="bold"><b>PetClinic</b></span>
    &#31034;&#20363;&#24212;&#29992;&#20013;&#30340;&#20363;&#23376;&#30340;&#19968;&#26679;&#12290;</p><p>&#22312;&#36825;&#31181;&#24773;&#20917;&#19979;&#65292;&#25105;&#20204;&#38656;&#35201;&#23450;&#20041;&#19968;&#20010;Hibernate&#30340;LocalSessionFactory&#65292;&#24212;&#29992;&#31243;
        &#24207;&#23558;&#20351;&#29992;&#23427;&#33719;&#24471;Hibernate&#30340;&#20250;&#35805;&#12290;</p><p>&#25968;&#25454;&#28304;bean&#23450;&#20041;&#21644;&#19978;&#38754;&#20363;&#23376;&#31867;&#20284;&#65292;&#36825;&#37324;&#19981;&#20877;&#32599;&#21015;&#65288;&#22914;&#26524;&#36825;&#26159;&#23481;&#22120;&#25968;&#25454;&#28304;&#65292;&#23427;&#24212;&#35813;&#26159;&#38750;&#20107;&#21153;&#30340;&#65292;&#22240;&#20026;Spring&#20250;&#31649;&#29702;&#20107;&#21153;&#65292;
    &#32780;&#19981;&#26159;&#23481;&#22120;&#65289;&#12290;</p><p>&#36825;&#31181;&#24773;&#20917;&#19979;&#65292;&#8220;transactionManager&#8221; bean&#30340;&#31867;&#22411;&#26159;HibernateTransactionManager&#12290;
        &#21644;DataSourceTransactionManager&#25317;&#26377;&#19968;&#20010;&#25968;&#25454;&#28304;&#30340;&#24341;&#29992;&#19968;&#26679;&#65292;
        HibernateTransactionManager&#38656;&#35201;&#19968;&#20010;SessionFactory&#30340;&#24341;&#29992;&#12290;</p><pre class="programlisting">&lt;bean id="sessionFactory" class="org.springframework.orm.hibernate.LocalSessionFactoryBean"&gt;
    &lt;property name="dataSource"&gt;&lt;ref local="dataSource"/&gt;&lt;/property&gt;
    &lt;property name="mappingResources"&gt;
        &lt;value&gt;org/springframework/samples/petclinic/hibernate/petclinic.hbm.xml&lt;/value&gt;
    &lt;/property&gt;
    &lt;property name="hibernateProperties"&gt;
        &lt;props&gt;
            &lt;prop key="hibernate.dialect"&gt;${hibernate.dialect}&lt;/prop&gt;
        &lt;/props&gt;
    &lt;/property&gt;
&lt;/bean&gt;

&lt;bean id="transactionManager" 
    class="org.springframework.orm.hibernate.HibernateTransactionManager"&gt;
    &lt;property name="sessionFactory"&gt;&lt;ref local="sessionFactory"/&gt;&lt;/property&gt;
&lt;/bean&gt;</pre><p>&#20351;&#29992;Hibernate&#21644;JTA&#20107;&#21153;&#65292;&#25105;&#20204;&#21487;&#20197;&#31616;&#21333;&#22320;&#20351;&#29992;JtaTransactionManager&#65292;
        &#23601;&#35937;JDBC&#25110;&#20219;&#20309;&#20854;&#20182;&#36164;&#28304;&#31574;&#30053;&#19968;&#26679;&#12290;</p><pre class="programlisting">&lt;bean id="transactionManager" 
    class="org.springframework.transaction.jta.JtaTransactionManager"/&gt;</pre><p>&#27880;&#24847;&#20219;&#20309;&#36164;&#28304;&#30340;JTA&#37197;&#32622;&#37117;&#26159;&#36825;&#26679;&#30340;&#65292;&#22240;&#20026;&#23427;&#20204;&#37117;&#26159;&#20840;&#23616;&#20107;&#21153;&#12290;</p><i><span class="remark">&#22312;&#25152;&#26377;&#36825;&#20123;&#24773;&#20917;&#19979;&#65292;&#24212;&#29992;&#31243;&#24207;&#20195;&#30721;&#19981;&#38656;&#35201;&#20219;&#20309;&#26356;&#25913;&#12290;&#25105;&#20204;&#21487;&#20197;&#20165;&#20165;&#26356;&#25913;&#37197;&#32622;
        &#26469;&#26356;&#25913;&#31649;&#29702;&#20107;&#21153;&#30340;&#26041;&#24335;&#65292;&#21363;&#20351;&#36825;&#20123;&#26356;&#25913;&#24847;&#21619;&#36825;&#20174;&#23616;&#37096;&#20107;&#21153;&#36716;&#25442;&#21040;&#20840;&#23616;&#20107;&#21153;&#25110;&#32773;&#30456;&#21453;
        &#30340;&#36716;&#25442;&#12290;</span></i><p>&#22914;&#26524;&#19981;&#20351;&#29992;&#20840;&#23616;&#20107;&#21153;&#65292;&#20320;&#38656;&#35201;&#37319;&#29992;&#19968;&#20010;&#29305;&#23450;&#30340;&#32534;&#30721;&#35268;&#33539;&#12290;&#24184;&#36816;&#30340;&#26159;&#23427;&#38750;&#24120;&#31616;&#21333;
        &#12290;&#20320;&#38656;&#35201;&#20197;&#19968;&#20010;&#29305;&#27530;&#30340;&#26041;&#24335;&#33719;&#24471;&#36830;&#25509;&#36164;&#28304;&#25110;&#32773;&#20250;&#35805;&#36164;&#28304;&#65292;&#20801;&#35768;&#30456;&#20851;&#30340;
        PlatformTransactionManager&#23454;&#29616;&#36319;&#36394;&#36830;&#25509;&#30340;&#20351;&#29992;&#65292;&#24182;&#19988;&#24403;&#38656;&#35201;&#26102;&#24212;&#29992;&#20107;&#21153;&#31649;&#29702;&#12290;</p><p>&#20363;&#22914;&#65292;&#22914;&#26524;&#20351;&#29992;JDBC&#65292;&#20320;&#19981;&#24212;&#35813;&#35843;&#29992;&#19968;&#20010;&#25968;&#25454;&#28304;&#30340;
        <tt class="literal">getConnection()</tt>&#26041;&#27861;&#65292;&#32780;&#24517;&#39035;&#20351;&#29992;Spring&#30340;
        <tt class="literal">org.springframework.jdbc.datasource.DataSourceUtils</tt>&#31867;&#65292;&#22914;&#19979;:</p><pre class="programlisting">Connection conn = DataSourceUtils.getConnection(dataSource);</pre><p>&#36825;&#23558;&#25552;&#20379;&#39069;&#22806;&#30340;&#22909;&#22788;&#65292;&#20219;&#20309;<tt class="literal">SQLException</tt>&#37117;&#34987;Spring&#30340;
        <tt class="literal">CannotGetJdbcConnectionException</tt>&#23553;&#35013;&#36215;&#26469;&#65292;&#23427;&#23646;&#20110;Spring&#30340;unchecked
        &#30340;<tt class="literal">DataAccessException</tt>&#30340;&#31867;&#23618;&#27425;&#12290;&#36825;&#32473;&#20320;&#27604;
        &#31616;&#21333;&#22320;&#20174;<tt class="literal">SQLException</tt>&#33719;&#24471;&#26356;&#22810;&#30340;&#20449;&#24687;&#65292;&#24182;&#19988;&#30830;&#20445;&#36328;&#25968;&#25454;
        &#24211;&#65292;&#29978;&#33267;&#36328;&#36234;&#19981;&#21516;&#25345;&#20037;&#21270;&#25216;&#26415;&#30340;&#21487;&#31227;&#26893;&#24615;&#12290;</p><p>&#27809;&#26377;Spring&#20107;&#21153;&#31649;&#29702;&#30340;&#24773;&#20917;&#19979;&#65292;&#36825;&#20063;&#33021;&#24456;&#22909;&#22320;&#24037;&#20316;&#65292;&#22240;&#27492;&#26080;&#35770;&#20351;&#29992;
        Spring&#20107;&#21153;&#31649;&#29702;&#19982;&#21542;&#65292;&#20320;&#37117;&#21487;&#20197;&#20351;&#29992;&#23427;&#12290;</p><p>&#24403;&#28982;&#65292;&#19968;&#26086;&#20320;&#20351;&#29992;Spring&#30340;JDBC&#25903;&#25345;&#25110;Hibernate&#25903;&#25345;&#65292;&#20320;&#23558;&#19981;&#24819;&#20351;&#29992;
        <tt class="literal">DataSourceUtils</tt>&#25110;&#20854;&#20182;&#24110;&#21161;&#31867;&#65292;&#22240;&#20026;&#19982;&#30452;&#25509;&#20351;&#29992;&#30456;&#20851;API&#30456;&#27604;&#65292;&#20320;&#23558;&#26356;&#20048;&#24847;&#20351;&#29992;Spring&#30340;&#25277;&#35937;&#12290;
        &#20363;&#22914;&#65292;&#22914;&#26524;&#20320;&#20351;&#29992;Spring&#30340;JdbcTemplate&#25110;jdbc.object&#21253;&#26469;&#31616;&#21270;&#20351;&#29992;JDBC&#65292;
        &#27491;&#30830;&#30340;&#25968;&#25454;&#24211;&#36830;&#25509;&#23558;&#33258;&#21160;&#21462;&#24471;&#65292;&#20320;&#19981;&#38656;&#35201;&#20070;&#20889;&#20219;&#20309;&#29305;&#27530;&#20195;&#30721;&#12290;</p></div><div class="sect1" lang="zh_cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e4193"></a>7.3.&nbsp;&#32534;&#31243;&#24335;&#20107;&#21153;&#31649;&#29702;</h2></div></div><div></div></div><p>Spring&#25552;&#20379;&#20004;&#31181;&#26041;&#24335;&#30340;&#32534;&#31243;&#24335;&#20107;&#21153;&#31649;&#29702;</p><div class="itemizedlist"><ul type="disc"><li><p>&#20351;&#29992;<tt class="literal">TransactionTemplate</tt></p></li><li><p>&#30452;&#25509;&#20351;&#29992;&#19968;&#20010;<tt class="literal">PlatformTransactionManager</tt>&#23454;&#29616;</p></li></ul></div><p>&#25105;&#20204;&#36890;&#24120;&#25512;&#33616;&#20351;&#29992;&#31532;&#19968;&#31181;&#26041;&#24335;&#12290;</p><p>&#31532;&#20108;&#31181;&#26041;&#24335;&#31867;&#20284;&#20351;&#29992;JTA <tt class="literal">UserTransaction</tt> API
        &#65288;&#34429;&#28982;&#24322;&#24120;&#22788;&#29702;&#23569;&#19968;&#28857;&#40635;&#28902;&#65289;&#12290;</p><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="d0e4217"></a>7.3.1.&nbsp;&#20351;&#29992;<tt class="literal">TransactionTemplate</tt></h3></div></div><div></div></div><p><tt class="literal">TransactionTemplate</tt>&#37319;&#29992;&#21644;&#20854;&#20182;Spring<span class="emphasis"><em>&#27169;&#26495;
        </em></span>&#65292;&#22914;<tt class="literal">JdbcTemplate</tt>&#21644;
        <tt class="literal">HibernateTemplate</tt>&#65292;&#19968;&#26679;&#30340;&#26041;&#27861;&#12290;&#23427;&#20351;&#29992;&#22238;&#35843;&#26041;&#27861;&#65292;&#25226;&#24212;&#29992;
        &#31243;&#24207;&#20195;&#30721;&#20174;&#22788;&#29702;&#21462;&#24471;&#21644;&#37322;&#25918;&#36164;&#28304;&#20013;&#35299;&#33073;&#20986;&#26469;&#65288;&#19981;&#20877;&#26377;try/catch/finally&#65289;&#12290;&#22914;&#21516;
        &#20854;&#20182;&#27169;&#26495;&#65292;<tt class="literal">TransactionTemplate</tt>&#26159;&#32447;&#31243;&#23433;&#20840;&#30340;&#12290;</p><p>&#24517;&#39035;&#22312;&#20107;&#21153;&#19978;&#19979;&#25991;&#20013;&#25191;&#34892;&#30340;&#24212;&#29992;&#20195;&#30721;&#30475;&#36215;&#26469;&#20687;&#36825;&#26679;&#65292;&#27880;&#24847;&#20351;&#29992;
        <tt class="literal">TransactionCallback</tt>&#21487;&#20197;&#36820;&#22238;&#19968;&#20010;&#20540;&#65306;</p><pre class="programlisting">Object result = tt.execute(new TransactionCallback() {
    public Object doInTransaction(TransactionStatus status) {
        updateOperation1();
        return resultOfUpdateOperation2();
    }
});</pre><p>&#22914;&#26524;&#27809;&#26377;&#36820;&#22238;&#20540;&#65292;&#20351;&#29992;<tt class="literal">TransactionCallbackWithoutResult</tt>&#65292;
        &#22914;&#19979;&#65306;</p><pre class="programlisting">tt.execute(new TransactionCallbackWithoutResult() {
    protected void doInTransactionWithoutResult(TransactionStatus status) {
        updateOperation1();
        updateOperation2();
    }
});</pre><p>&#22238;&#35843;&#20013;&#30340;&#20195;&#30721;&#21487;&#20197;&#35843;&#29992;<tt class="literal">TransactionStatus</tt>&#23545;&#35937;&#30340;
        <tt class="literal">setRollbackOnly()</tt>&#26041;&#27861;&#26469;&#22238;&#28378;&#20107;&#21153;&#12290;</p><p>&#24819;&#35201;&#20351;&#29992;<tt class="literal">TransactionTemplate</tt>&#30340;&#24212;&#29992;&#31867;&#24517;&#39035;&#33021;&#35775;&#38382;&#19968;
        &#20010;<tt class="literal">PlatformTransactionManager</tt>&#65306;&#36890;&#24120;&#36890;&#36807;&#19968;&#20010;JavaBean&#23646;
            &#24615;&#25110;&#26500;&#36896;&#20989;&#25968;&#21442;&#25968;&#26292;&#38706;&#20986;&#26469;&#12290;</p><p>&#20351;&#29992;&#27169;&#25311;&#25110;&#26729;&#21270;&#30340;<tt class="literal">PlatformTransactionManager</tt>&#65292;&#21333;&#20803;&#27979;&#35797;
        &#36825;&#20123;&#31867;&#24456;&#31616;&#21333;&#12290;&#27809;&#26377;JNDI&#26597;&#25214;&#21644;&#38745;&#24577;&#39764;&#26415;&#20195;&#30721;&#65306;&#23427;&#21482;&#26159;&#19968;&#20010;&#31616;&#21333;&#30340;&#25509;&#21475;&#12290;&#21644;&#24179;&#24120;&#19968;&#26679;&#65292;
        &#20320;&#21487;&#20197;&#20351;&#29992;Spring&#31616;&#21270;&#21333;&#20803;&#27979;&#35797;&#12290;</p></div><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="d0e4275"></a>7.3.2.&nbsp;&#20351;&#29992;<tt class="literal">PlatformTransactionManager</tt></h3></div></div><div></div></div><p>&#20320;&#20063;&#21487;&#20197;&#20351;&#29992;
  	    <tt class="literal">org.springframework.transaction.PlatformTransactionManager</tt>
  	    &#30452;&#25509;&#31649;&#29702;&#20107;&#21153;&#12290;&#31616;&#21333;&#22320;&#36890;&#36807;&#19968;&#20010;bean&#24341;&#29992;&#32473;&#20320;&#30340;bean&#20256;&#36882;&#19968;&#20010;&#20320;&#20351;&#29992;&#30340;
  	    <tt class="literal">PlatformTransactionManager</tt>&#23454;&#29616;&#12290;&#28982;&#21518;&#65292;
  	    &#20351;&#29992;<tt class="literal">TransactionDefinition</tt>&#21644;
  	    <tt class="literal">TransactionStatus</tt>&#23545;&#35937;&#23601;&#21487;&#20197;&#21457;&#36215;&#20107;&#21153;&#65292;&#22238;&#28378;&#21644;&#25552;&#20132;&#12290;
  	</p><pre class="programlisting">DefaultTransactionDefinition def = new DefaultTransactionDefinition()
def.setPropagationBehavior(TransactionDefinition.PROPAGATION_REQUIRED);

TransactionStatus status = transactionManager.getTransactionDefinition(def);

try {
    // execute your business logic here
} catch (MyException ex) {
    transactionManager.rollback(status);
    throw ex;
}
transactionManager.commit(status);</pre></div></div><div class="sect1" lang="zh_cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e4297"></a>7.4.&nbsp;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;</h2></div></div><div></div></div><p>Spring&#20063;&#25552;&#20379;&#20102;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;&#12290;&#36825;&#26159;&#36890;&#36807;Spring AOP&#23454;&#29616;&#30340;&#12290;</p><i><span class="remark">&#22823;&#22810;&#25968;Spring&#29992;&#25143;&#36873;&#25321;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;&#12290;&#36825;&#26159;&#26368;&#23569;&#24433;&#21709;&#24212;&#29992;&#20195;&#30721;&#30340;&#36873;&#25321;&#65292;
        &#22240;&#32780;&#36825;&#26159;&#21644;<span class="emphasis"><em>&#38750;&#20405;&#20837;&#24615;</em></span>&#30340;&#36731;&#37327;&#32423;&#23481;&#22120;&#30340;&#35266;&#24565;&#26159;&#19968;&#33268;&#30340;&#12290;
    </span></i><p>&#20174;&#32771;&#34385;EJB CMT&#21644;Spring&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;&#30340;&#30456;&#20284;&#20197;&#21450;&#19981;&#21516;&#20043;&#22788;&#20986;&#21457;&#26159;&#24456;&#26377;&#30410;&#30340;&#12290;
        &#23427;&#20204;&#30340;&#22522;&#26412;&#26041;&#27861;&#26159;&#30456;&#20284;&#30340;&#65306;&#37117;&#21487;&#20197;&#25351;&#23450;&#20107;&#21153;&#31649;&#29702;&#21040;&#21333;&#29420;&#30340;&#26041;&#27861;&#65307;&#22914;&#26524;&#38656;&#35201;&#21487;&#20197;&#22312;&#20107;&#21153;&#19978;
        &#19979;&#25991;&#35843;&#29992;<tt class="literal">setRollbackOnly()</tt>&#26041;&#27861;&#12290;&#19981;&#21516;&#20043;&#22788;&#22914;&#19979;&#65306;</p><div class="itemizedlist"><ul type="disc"><li><p>&#19981;&#35937;EJB CMT&#32465;&#23450;&#22312;JTA&#19978;&#65292;Spring&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;&#21487;&#20197;&#22312;&#20219;&#20309;&#29615;&#22659;&#19979;&#20351;&#29992;&#12290;
        &#21482;&#38656;&#26356;&#25913;&#37197;&#32622;&#25991;&#20214;&#65292;&#23427;&#23601;&#21487;&#20197;&#21644;JDBC&#12289;JDO&#12289;Hibernate&#25110;&#20854;&#20182;&#30340;&#20107;&#21153;&#26426;&#21046;&#19968;&#36215;&#24037;&#20316;
        </p></li><li><p>Spring&#21487;&#20197;&#20351;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;&#24212;&#29992;&#21040;&#26222;&#36890;Java&#23545;&#35937;&#65292;&#19981;&#20165;&#20165;&#26159;&#29305;&#27530;&#30340;&#31867;&#65292;&#22914;EJB</p></li><li><p>Spring&#25552;&#20379;&#22768;&#26126;&#24335;<span class="emphasis"><em>&#22238;&#28378;&#35268;&#21017;</em></span>&#65306;EJB&#27809;&#26377;&#23545;&#24212;&#30340;&#29305;&#24615;&#65292;
        &#25105;&#20204;&#23558;&#22312;&#19979;&#38754;&#35752;&#35770;&#36825;&#20010;&#29305;&#24615;&#12290;&#22238;&#28378;&#21487;&#20197;&#22768;&#26126;&#24335;&#25511;&#21046;&#65292;&#19981;&#20165;&#20165;&#26159;&#32534;&#31243;&#24335;&#30340;
        </p></li><li><p>Spring&#20801;&#35768;&#20320;&#36890;&#36807;AOP&#23450;&#21046;&#20107;&#21153;&#34892;&#20026;&#12290;&#20363;&#22914;&#65292;&#22914;&#26524;&#38656;&#35201;&#65292;&#20320;&#21487;&#20197;&#22312;&#20107;&#21153;
        &#22238;&#28378;&#20013;&#25554;&#20837;&#23450;&#21046;&#30340;&#34892;&#20026;&#12290;&#20320;&#20063;&#21487;&#20197;&#22686;&#21152;&#20219;&#24847;&#30340;&#36890;&#30693;&#65292;&#23601;&#35937;&#20107;&#21153;&#36890;&#30693;&#19968;&#26679;&#12290;&#20351;&#29992;
        EJB CMT&#65292;&#38500;&#20102;&#20351;&#29992;<tt class="literal">setRollbackOnly()</tt>&#65292;&#20320;&#27809;&#26377;&#21150;&#27861;&#33021;
        &#22815;&#24433;&#21709;&#23481;&#22120;&#30340;&#20107;&#21153;&#31649;&#29702;</p></li><li><p>Spring&#19981;&#25552;&#20379;&#39640;&#31471;&#24212;&#29992;&#26381;&#21153;&#22120;&#25552;&#20379;&#30340;&#36328;&#36234;&#36828;&#31243;&#35843;&#29992;&#30340;&#20107;&#21153;&#19978;&#19979;&#25991;&#20256;&#25773;&#12290;&#22914;
        &#26524;&#20320;&#38656;&#35201;&#36825;&#20123;&#29305;&#24615;&#65292;&#25105;&#20204;&#25512;&#33616;&#20320;&#20351;&#29992;EJB&#12290;&#28982;&#32780;&#65292;&#19981;&#35201;&#36731;&#26131;&#20351;&#29992;&#36825;&#20123;&#29305;&#24615;&#12290;&#36890;&#24120;&#25105;
        &#20204;&#24182;&#19981;&#24076;&#26395;&#20107;&#21153;&#36328;&#36234;&#36828;&#31243;&#35843;&#29992;</p></li></ul></div><p>&#22238;&#28378;&#35268;&#21017;&#30340;&#27010;&#24565;&#26159;&#24456;&#37325;&#35201;&#30340;&#65306;&#23427;&#20204;&#20351;&#24471;&#25105;&#20204;&#21487;&#20197;&#25351;&#23450;&#21738;&#20123;&#24322;&#24120;&#24212;&#35813;&#21457;&#36215;&#33258;
        &#21160;&#22238;&#28378;&#12290;&#25105;&#20204;&#22312;&#37197;&#32622;&#25991;&#20214;&#20013;&#65292;&#32780;&#19981;&#26159;Java&#20195;&#30721;&#20013;&#65292;&#20197;&#22768;&#26126;&#30340;&#26041;&#24335;&#25351;&#23450;&#12290;&#22240;&#27492;&#65292;&#34429;&#28982;&#25105;&#20204;&#20173;
        &#28982;&#21487;&#20197;&#32534;&#31243;&#35843;&#29992;<tt class="literal">TransactionStatus</tt>&#23545;&#35937;&#30340;
        <tt class="literal">setRollbackOnly()</tt>&#26041;&#27861;&#26469;&#22238;&#28378;&#24403;&#21069;&#20107;&#21153;&#65292;&#22810;&#25968;&#26102;&#20505;&#25105;&#20204;&#21487;&#20197;
        &#25351;&#23450;&#35268;&#21017;&#65292;&#22914;<tt class="literal">MyApplicationException</tt>&#24212;&#35813;&#23548;&#33268;&#22238;&#28378;&#12290;
        &#36825;&#26377;&#26174;&#33879;&#30340;&#20248;&#28857;&#65292;&#19994;&#21153;&#23545;&#35937;&#19981;&#38656;&#35201;&#20381;&#36182;&#20107;&#21153;&#22522;&#30784;&#35774;&#26045;&#12290;&#20363;&#22914;&#65292;&#23427;&#20204;&#36890;&#24120;&#19981;&#38656;&#35201;&#24341;
        &#20837;&#20219;&#20309;Spring API&#65292;&#20107;&#21153;&#25110;&#20854;&#20182;&#20219;&#20309;&#19996;&#35199;&#12290;</p><p>EJB&#30340;&#40664;&#35748;&#34892;&#20026;&#26159;&#36935;&#21040;<span class="emphasis"><em>&#31995;&#32479;&#24322;&#24120;</em></span>&#65288;&#36890;&#24120;&#26159;&#36816;&#34892;&#26102;&#24322;&#24120;&#65289;&#65292;
        EJB&#23481;&#22120;&#33258;&#21160;&#22238;&#28378;&#20107;&#21153;&#12290;EJB CMT&#36935;&#21040;<span class="emphasis"><em>&#24212;&#29992;&#31243;&#24207;&#24322;&#24120;</em></span>
        &#65288;&#38500;&#20102;<span class="emphasis"><em>java.rmi.RemoteException</em></span>&#22806;&#30340;checked&#24322;&#24120;&#65289;&#26102;&#19981;
        &#20250;&#33258;&#21160;&#22238;&#28378;&#20107;&#21153;&#12290;&#34429;&#28982;Spring&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;&#27839;&#29992;EJB&#30340;&#32422;&#23450;&#65288;&#36935;&#21040;unchecked
        &#24322;&#24120;&#33258;&#21160;&#22238;&#28378;&#20107;&#21153;&#65289;&#65292;&#20294;&#26159;&#36825;&#26159;&#21487;&#20197;&#23450;&#21046;&#30340;&#12290;</p><p>&#25353;&#29031;&#25105;&#20204;&#30340;&#27979;&#35797;&#65292;Spring&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;&#30340;&#24615;&#33021;&#35201;&#32988;&#36807;EJB CMT&#12290;</p><p>&#36890;&#24120;&#36890;&#36807;TransactionProxyFactoryBean&#35774;&#32622;Spring&#20107;&#21153;&#20195;&#29702;&#12290;&#25105;&#20204;&#38656;
        &#35201;&#19968;&#20010;&#30446;&#26631;&#23545;&#35937;&#21253;&#35013;&#22312;&#20107;&#21153;&#20195;&#29702;&#20013;&#12290;&#36825;&#20010;&#30446;&#26631;&#23545;&#35937;&#19968;&#33324;&#26159;&#19968;&#20010;&#26222;&#36890;Java&#23545;&#35937;&#30340;bean&#12290;&#24403;&#25105;
        &#20204;&#23450;&#20041;TransactionProxyFactoryBean&#26102;&#65292;&#24517;&#39035;&#25552;&#20379;&#19968;&#20010;&#30456;&#20851;&#30340;
        PlatformTransactionManager&#30340;&#24341;&#29992;&#21644;<span class="bold"><b>&#20107;&#21153;&#23646;&#24615;</b></span>&#12290;
        <span class="bold"><b>&#20107;&#21153;&#23646;&#24615;</b></span>&#21547;&#26377;&#19978;&#38754;&#25551;&#36848;&#30340;&#20107;&#21153;&#23450;&#20041;&#12290;</p><pre class="programlisting">&lt;bean id="petStore" 
    class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean"&gt;
    &lt;property name="transactionManager"&gt;&lt;ref bean="transactionManager"/&gt;&lt;/property&gt;
    &lt;property name="target"&gt;&lt;ref bean="petStoreTarget"/&gt;&lt;/property&gt;
    &lt;property name="transactionAttributes"&gt;
        &lt;props&gt;
            &lt;prop key="insert*"&gt;PROPAGATION_REQUIRED,-MyCheckedException&lt;/prop&gt;
            &lt;prop key="update*"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;
            &lt;prop key="*"&gt;PROPAGATION_REQUIRED,readOnly&lt;/prop&gt;
        &lt;/props&gt;
    &lt;/property&gt;
&lt;/bean&gt;</pre><p>&#20107;&#21153;&#20195;&#29702;&#20250;&#23454;&#29616;&#30446;&#26631;&#23545;&#35937;&#30340;&#25509;&#21475;&#65306;&#36825;&#37324;&#26159;id&#20026;petStoreTarget&#30340;bean&#12290;&#65288;&#20351;&#29992;
        CGLIB&#20063;&#21487;&#20197;&#23454;&#29616;&#20855;&#20307;&#31867;&#30340;&#20195;&#29702;&#12290;&#21482;&#35201;&#35774;&#32622;proxyTargetClass&#23646;&#24615;&#20026;true&#23601;&#21487;&#20197;&#12290;
        &#22914;&#26524;&#30446;&#26631;&#23545;&#35937;&#27809;&#26377;&#23454;&#29616;&#20219;&#20309;&#25509;&#21475;&#65292;&#36825;&#23558;&#33258;&#21160;&#35774;&#32622;&#35813;&#23646;&#24615;&#20026;true&#12290;&#36890;&#24120;&#65292;&#25105;&#20204;&#24076;&#26395;&#38754;&#21521;&#25509;&#21475;&#32780;&#19981;&#26159;
        &#31867;&#32534;&#31243;&#12290;&#65289;&#20351;&#29992;proxyInterfaces&#23646;&#24615;&#26469;&#38480;&#23450;&#20107;&#21153;&#20195;&#29702;&#26469;&#20195;
        &#29702;&#25351;&#23450;&#25509;&#21475;&#20063;&#26159;&#21487;&#20197;&#30340;&#65288;&#19968;&#33324;&#26469;&#35828;&#26159;&#20010;&#22909;&#24819;&#27861;&#65289;&#12290;&#20063;&#21487;&#20197;&#36890;&#36807;&#20174;
        <tt class="literal">org.springframework.aop.framework.ProxyConfig</tt>&#32487;&#25215;&#25110;&#25152;&#26377;AOP&#20195;&#29702;&#24037;&#21378;&#20849;&#20139;
        &#30340;&#23646;&#24615;&#26469;&#23450;&#21046;TransactionProxyFactoryBean&#30340;&#34892;&#20026;&#12290;
    </p><p>&#36825;&#37324;&#30340;transactionAttributes&#23646;&#24615;&#23450;&#20041;&#22312;
        <tt class="literal">org.springframework.transaction.interceptor.NameMatchTransactionAttributeSource</tt>
        &#20013;&#30340;&#23646;&#24615;&#26684;&#24335;&#26469;&#35774;&#32622;&#12290;&#36825;&#20010;&#21253;&#25324;&#36890;&#37197;&#31526;&#30340;&#26041;&#27861;&#21517;&#31216;&#26144;&#23556;&#26159;&#24456;&#30452;&#35266;&#30340;&#12290;&#27880;&#24847;
        insert*&#30340;&#26144;&#23556;&#30340;&#20540;&#21253;&#25324;&#22238;&#28378;&#35268;&#21017;&#12290;&#28155;&#21152;&#30340;<tt class="literal">-MyCheckedException</tt>
        &#25351;&#23450;&#22914;&#26524;&#26041;&#27861;&#25243;&#20986;<tt class="literal">MyCheckedException</tt>&#25110;&#23427;&#30340;&#23376;&#31867;&#65292;&#20107;&#21153;&#23558;
        &#20250;&#33258;&#21160;&#22238;&#28378;&#12290;&#21487;&#20197;&#29992;&#36887;&#21495;&#20998;&#38548;&#23450;&#20041;&#22810;&#20010;&#22238;&#28378;&#35268;&#21017;&#12290;-&#21069;&#32512;&#24378;&#21046;&#22238;&#28378;&#65292;+&#21069;&#32512;&#25351;&#23450;&#25552;
        &#20132;&#65288;&#36825;&#20801;&#35768;&#21363;&#20351;&#25243;&#20986;unchecked&#24322;&#24120;&#26102;&#20063;&#21487;&#20197;&#25552;&#20132;&#20107;&#21153;&#65292;&#24403;&#28982;&#20320;&#33258;&#24049;&#35201;&#26126;&#30333;&#33258;&#24049;
        &#22312;&#20570;&#20160;&#20040;&#65289;&#12290;</p><p><tt class="literal">TransactionProxyFactoryBean</tt>&#20801;&#35768;&#20320;&#36890;&#36807;
        &#8220;preInterceptors&#8221;&#21644;&#8220;postInterceptors&#8221;&#23646;&#24615;&#35774;&#32622;&#8220;&#21069;&#8221;&#25110;&#8220;&#21518;&#8221;&#36890;&#30693;&#26469;&#25552;&#20379;&#39069;&#22806;&#30340;
        &#25318;&#25130;&#34892;&#20026;&#12290;&#21487;&#20197;&#35774;&#32622;&#20219;&#24847;&#25968;&#37327;&#30340;&#8220;&#21069;&#8221;&#21644;&#8220;&#21518;&#8221;&#36890;&#30693;&#65292;&#23427;&#20204;&#30340;&#31867;&#22411;&#21487;&#20197;&#26159;
        <tt class="literal">Advisor</tt>&#65288;&#21487;&#20197;&#21253;&#21547;&#19968;&#20010;&#20999;&#20837;&#28857;&#65289;&#65292;
        <tt class="literal">MethodInterceptor</tt>&#25110;&#34987;&#24403;&#21069;Spring&#37197;&#32622;&#25903;&#25345;&#30340;&#36890;&#30693;&#31867;&#22411;
        &#65288;&#20363;&#22914;<tt class="literal">ThrowAdvice</tt>&#65292;
        <tt class="literal">AfterReturningtAdvice</tt>&#25110;<tt class="literal">BeforeAdvice</tt>&#65292;
        &#36825;&#20123;&#37117;&#26159;&#40664;&#35748;&#25903;&#25345;&#30340;&#65289;&#12290;&#36825;&#20123;&#36890;&#30693;&#24517;&#39035;&#25903;&#25345;&#23454;&#20363;&#20849;&#20139;&#27169;&#24335;&#12290;&#22914;&#26524;&#20320;&#38656;&#35201;&#39640;&#32423;AOP&#29305;
        &#24615;&#26469;&#20351;&#29992;&#20107;&#21153;&#65292;&#22914;&#26377;&#29366;&#24577;&#30340;maxin&#65292;&#37027;&#26368;&#22909;&#20351;&#29992;&#36890;&#29992;&#30340;
        <tt class="literal">org.springframework.aop.framework.ProxyFactoryBean</tt>&#65292;
        &#32780;&#19981;&#26159;<tt class="literal">TransactionProxyFactoryBean</tt>&#23454;&#29992;&#20195;&#29702;&#21019;&#24314;&#32773;&#12290;</p><p>&#20063;&#21487;&#20197;&#35774;&#32622;&#33258;&#21160;&#20195;&#29702;&#65306;&#37197;&#32622;AOP&#26694;&#26550;&#65292;&#19981;&#38656;&#35201;&#21333;&#29420;&#30340;&#20195;&#29702;&#23450;&#20041;&#31867;&#23601;&#21487;&#20197;&#29983;&#25104;&#31867;&#30340;
        &#20195;&#29702;&#12290;</p><p>&#26356;&#22810;&#20449;&#24687;&#21644;&#23454;&#20363;&#35831;&#21442;&#38405;AOP&#31456;&#33410;&#12290;</p><i><span class="remark">&#26080;&#35770;&#20320;&#26159;&#26159;&#21542;&#26159;AOP&#19987;&#23478;&#65292;&#37117;&#21487;&#20197;&#26356;&#26377;&#25928;&#22320;&#20351;&#29992;Spring&#30340;
        &#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;&#12290;&#20294;&#26159;&#65292;&#22914;&#26524;&#20320;&#24819;&#25104;&#20026;Spring AOP&#30340;&#39640;&#32423;&#29992;&#25143;&#65292;&#20320;&#20250;&#21457;&#29616;&#25972;&#21512;&#22768;&#26126;
        &#24335;&#20107;&#21153;&#31649;&#29702;&#21644;&#24378;&#22823;&#30340;AOP&#24615;&#33021;&#26159;&#38750;&#24120;&#23481;&#26131;&#30340;&#12290;</span></i><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="d0e4416"></a>7.4.1.&nbsp;BeanNameAutoProxyCreator&#65292;&#21478;&#19968;&#31181;&#22768;&#26126;&#26041;&#24335;</h3></div></div><div></div></div><p><tt class="classname">TransactionProxyFactoryBean</tt>&#38750;&#24120;&#26377;&#29992;&#65292;&#24403;&#20107;
          &#21153;&#20195;&#29702;&#21253;&#35013;&#23545;&#35937;&#26102;&#65292;&#23427;&#20351;&#20320;&#21487;&#20197;&#23436;&#20840;&#25511;&#21046;&#20195;&#29702;&#12290;&#22914;&#26524;&#20320;&#38656;&#35201;&#29992;&#19968;&#33268;&#30340;&#26041;&#24335;&#65288;&#20363;&#22914;&#65292;&#19968;&#20010;
          &#26679;&#26495;&#25991;&#20214;&#65292;&#8220;&#20351;&#25152;&#26377;&#30340;&#26041;&#27861;&#20107;&#21153;&#21270;&#8221;&#65289;&#21253;&#35013;&#22823;&#37327;&#30340;bean&#65292;&#20351;&#29992;&#19968;&#20010;
          <tt class="classname">BeanFactoryPostProcessor</tt>&#30340;&#19968;&#20010;&#23454;&#29616;&#65292;
          <tt class="classname">BeanNameAutoProxyCreator</tt>&#65292;&#21487;&#20197;&#25552;&#20379;&#21478;&#22806;&#19968;&#31181;&#26041;&#27861;&#65292;
          &#36825;&#20010;&#26041;&#27861;&#22312;&#36825;&#31181;&#31616;&#21333;&#30340;&#24773;&#20917;&#19979;&#26356;&#21152;&#31616;&#21333;&#12290;</p><p>&#37325;&#36848;&#19968;&#19979;&#65292;&#19968;&#26086;ApplicationContext&#35835;&#23436;&#23427;&#30340;&#21021;&#22987;&#21270;&#20449;&#24687;&#65292;&#23427;&#23558;&#21021;&#22987;&#21270;&#25152;&#26377;&#23454;
          &#29616;<tt class="classname">BeanPostProcessor</tt>&#25509;&#21475;&#30340;bean&#65292;&#24182;&#19988;&#35753;&#23427;&#20204;&#21518;&#22788;&#29702;
          ApplicationContext&#20013;&#25152;&#26377;&#20854;&#20182;&#30340;bean&#12290;&#25152;&#20197;&#20351;&#29992;&#36825;&#31181;&#26426;&#21046;&#65292;&#19968;&#20010;&#27491;
          &#30830;&#37197;&#32622;&#30340;<tt class="classname">BeanNameAutoProxyCreator</tt>&#21487;&#20197;&#29992;&#26469;&#21518;&#22788;
          &#29702;&#25152;&#26377;ApplicationContext&#20013;&#25152;&#26377;&#20854;&#20182;&#30340;bean&#65288;&#36890;&#36807;&#21517;&#31216;&#26469;&#35782;&#21035;&#65289;&#65292;&#24182;&#19988;&#25226;&#23427;
          &#20204;&#29992;&#20107;&#21153;&#20195;&#29702;&#21253;&#35013;&#36215;&#26469;&#12290;&#30495;&#27491;&#29983;&#25104;&#30340;&#20107;&#21153;&#20195;&#29702;&#21644;&#20351;&#29992;
          <tt class="classname">TransactionProxyFactoryBean</tt>&#29983;&#25104;&#30340;&#22522;&#26412;&#19968;&#33268;&#65292;&#36825;&#37324;&#19981;&#20877;
          &#35752;&#35770;&#12290;</p><p>&#35753;&#25105;&#20204;&#30475;&#19979;&#38754;&#30340;&#37197;&#32622;&#31034;&#20363;&#65306;</p><pre class="programlisting">  &lt;!-- Transaction Interceptor set up to do PROPOGATION_REQUIRED on all methods --&gt;
  &lt;bean id="matchAllWithPropReq" 
      class="org.springframework.transaction.interceptor.MatchAlwaysTransactionAttributeSource"&gt;
    &lt;property name="transactionAttribute"&gt;&lt;value&gt;PROPAGATION_REQUIRED&lt;/value&gt;&lt;/property&gt;
  &lt;/bean&gt;
  &lt;bean id="matchAllTxInterceptor" 
      class="org.springframework.transaction.interceptor.TransactionInterceptor"&gt;
    &lt;property name="transactionManager"&gt;&lt;ref bean="transactionManager"/&gt;&lt;/property&gt;
    &lt;property name="transactionAttributeSource"&gt;&lt;ref bean="matchAllWithPropReq"/&gt;&lt;/property&gt;
  &lt;/bean&gt;

  &lt;!-- One BeanNameAutoProxyCreator handles all beans where we want all methods to use 
       PROPOGATION_REQUIRED --&gt;
  &lt;bean id="autoProxyCreator" 
      class="org.springframework.aop.framework.autoproxy.BeanNameAutoProxyCreator"&gt;
    &lt;property name="interceptorNames"&gt;
      &lt;list&gt;
        &lt;idref local="matchAllTxInterceptor"/&gt;
        &lt;idref bean="hibInterceptor"/&gt;
      &lt;/list&gt;
    &lt;/property&gt;
    &lt;property name="beanNames"&gt;
      &lt;list&gt;
        &lt;idref local="core-services-applicationControllerSevice"/&gt;
        &lt;idref local="core-services-deviceService"/&gt;
        &lt;idref local="core-services-authenticationService"/&gt;
        &lt;idref local="core-services-packagingMessageHandler"/&gt;
        &lt;idref local="core-services-sendEmail"/&gt;
        &lt;idref local="core-services-userService"/&gt;
      &lt;/list&gt;
    &lt;/property&gt;
  &lt;/bean&gt;</pre><p>&#20551;&#35774;&#25105;&#20204;&#22312;ApplicationContext&#20013;&#24050;&#32463;&#26377;&#19968;&#20010;<tt class="classname">TransactionManager</tt>&#30340;&#23454;&#20363;
          &#65292;&#25105;&#20204;&#39318;&#20808;&#35201;&#20570;&#30340;&#20351;&#21019;&#24314;&#19968;&#20010;
          <tt class="classname">TransactionInterceptor</tt>&#23454;&#20363;&#12290;
          &#26681;&#25454;&#36890;&#36807;&#23646;&#24615;&#20256;&#36882;&#30340;<tt class="classname">TransactionAttributeSource</tt>&#25509;&#21475;&#30340;&#19968;&#20010;&#23454;&#29616;&#65292;
          <tt class="classname">ransactionInterceptor</tt>&#20915;&#23450;&#21738;&#20010;
          &#26041;&#27861;&#34987;&#25318;&#25130;&#12290;&#36825;&#20010;&#20363;&#23376;&#20013;&#65292;&#25105;&#20204;&#24076;&#26395;&#22788;&#29702;&#21305;&#37197;
          &#25152;&#26377;&#26041;&#27861;&#36825;&#31181;&#26368;&#31616;&#21333;&#30340;&#24773;&#20917;&#12290;&#36825;&#20010;&#19981;&#26159;&#26368;&#26377;&#25928;&#30340;&#26041;&#24335;&#65292;&#20294;&#35774;&#32622;&#38750;&#24120;&#36805;&#36895;&#65292;&#22240;&#20026;
          &#25105;&#21487;&#20197;&#20351;&#29992;&#39044;&#20808;&#23450;&#20041;&#30340;&#21305;&#37197;&#25152;&#26377;&#26041;&#27861;&#30340;
          <tt class="classname">MatchAlwaysTransactionAttributeSource</tt>&#31867;&#12290;&#22914;&#26524;&#25105;
          &#20204;&#38656;&#35201;&#29305;&#23450;&#30340;&#26041;&#24335;&#65292;&#21487;&#20197;&#20351;&#29992;
          <tt class="classname">MethodMapTransactionAttributeSource</tt>&#65292;
          <tt class="classname">NameMatchTransactionAttributeSource</tt>&#25110;
          <tt class="classname">AttributesTransactionAttributeSource</tt>&#12290;</p><p>&#29616;&#22312;&#25105;&#20204;&#24050;&#32463;&#26377;&#20102;&#20107;&#21153;&#25318;&#25130;&#22120;&#65292;&#25105;&#20204;&#21482;&#38656;&#25226;&#23427;&#20132;&#32473;&#25105;&#20204;&#23450;&#20041;&#30340;
          <tt class="classname">BeanNameAutoProxyCreator</tt>&#23454;&#20363;&#20013;&#65292;&#36825;&#26679;AppliactonContext&#20013;
          &#23450;&#20041;&#30340;6&#20010;bean&#20197;&#21516;&#26679;&#30340;&#26041;&#24335;&#34987;&#23553;&#35013;&#12290;&#20320;&#21487;&#20197;&#30475;&#21040;&#65292;&#36825;
          &#27604;&#29992;TransactionProxyFactoryBean&#20197;&#19968;&#31181;&#26041;&#24335;&#21333;&#29420;&#23553;&#35013;6&#20010;bean&#31616;&#27905;&#24456;
          &#22810;&#12290;&#23553;&#35013;&#31532;7&#20010;bean&#21482;&#38656;&#28155;&#21152;&#19968;&#34892;&#37197;&#32622;&#12290;</p><p>&#20320;&#20063;&#35768;&#27880;&#24847;&#21040;&#21487;&#20197;&#24212;&#29992;&#22810;&#20010;&#25318;&#25130;&#22120;&#12290;&#22312;&#36825;&#20010;&#20363;&#23376;&#20013;&#65292;&#25105;&#20204;&#36824;&#24212;&#29992;&#20102;&#19968;&#20010;
          &#21069;&#38754;&#23450;&#20041;&#30340;<tt class="classname">HibernateInterceptor</tt>
          &#65288;bean id=<span class="emphasis"><em>hibInterceptor</em></span>&#65289;&#65292;&#23427;&#20026;&#25105;&#20204;&#31649;&#29702;
          Hibernare&#30340;&#20250;&#35805;&#12290;</p><p>&#26377;&#19968;&#20214;&#20107;&#20540;&#24471;&#27880;&#24847;&#65292;&#23601;&#26159;&#22312;<tt class="classname">TransactionProxyFactoryBean</tt>,
          &#21644;<tt class="classname">BeanNameAutoProxyCreator</tt>&#20999;&#25442;&#26102;bean&#30340;&#21629;&#21517;&#12290;
          &#31532;&#19968;&#31181;&#24773;&#20917;&#65292;&#20320;&#21482;&#38656;&#32473;&#20320;&#24819;&#35201;&#21253;&#35013;&#30340;bean&#19968;&#20010;&#31867;&#20284;<span class="emphasis"><em>myServiceTarget</em></span>&#30340;id&#65292;
          &#32473;&#20195;&#29702;&#23545;&#35937;&#19968;&#20010;&#31867;&#20284;<span class="emphasis"><em>myService</em></span>&#30340;id&#65292;&#28982;&#21518;&#25152;&#26377;&#20195;&#29702;&#23545;&#35937;&#30340;&#29992;&#25143;&#21482;&#38656;&#24341;&#29992;&#20195;&#29702;&#23545;&#35937;&#65292;
          &#22914;<span class="emphasis"><em>myService</em></span>&#65288;&#36825;&#20123;&#26159;&#36890;&#29992;&#21629;&#21517;&#35268;&#33539;&#65292;
          &#35201;&#28857;&#26159;&#30446;&#26631;&#23545;&#35937;&#35201;&#26377;&#21644;&#20195;&#29702;&#23545;&#35937;&#19981;&#21516;&#30340;&#21517;&#31216;&#65292;&#24182;&#19988;&#23427;&#20204;&#37117;&#35201;&#22312;ApplicationContext&#20013;&#21487;&#29992;&#65289;&#12290;&#28982;&#32780;&#65292;
          &#20351;&#29992;<tt class="classname">BeanNameAutoProxyCreator</tt>&#26102;&#65292;
          &#20320;&#24471;&#21629;&#21517;&#30446;&#26631;&#23545;&#35937;&#20026;<span class="emphasis"><em>myService</em></span>&#12290;
          &#28982;&#21518;&#24403;<tt class="classname">BeanNameAutoProxyCreator</tt>&#21518;&#22788;&#29702;&#30446;&#26631;&#23545;&#35937;
          &#24182;&#29983;&#25104;&#20195;&#29702;&#26102;&#65292;&#23427;&#20351;&#24471;&#20195;&#29702;&#20197;&#21644;&#21407;&#22987;&#23545;&#35937;&#30340;&#21517;&#31216;&#34987;&#25554;&#20837;&#21040;
          ApplicationContext&#20013;&#12290;&#20174;&#36825;&#19968;&#28857;&#30475;&#65292;&#21482;&#26377;&#20195;&#29702;&#65288;&#21547;&#26377;&#34987;&#21253;&#35013;&#30340;&#23545;&#35937;&#65289;&#22312;ApplicationContext&#20013;&#21487;&#29992;&#12290;</p></div></div><div class="sect1" lang="zh_cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e4510"></a>7.5.&nbsp;&#32534;&#31243;&#24335;&#36824;&#26159;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;</h2></div></div><div></div></div><p>&#22914;&#26524;&#20320;&#21482;&#26377;&#24456;&#23569;&#30340;&#20107;&#21153;&#25805;&#20316;&#65292;&#20351;&#29992;&#32534;&#31243;&#24335;&#20107;&#21153;&#31649;&#29702;&#25165;&#26159;&#20010;&#22909;&#20027;&#24847;&#12290;&#20363;&#22914;&#65292;
        &#22914;&#26524;&#20320;&#26377;&#19968;&#20010;WEB&#24212;&#29992;&#38656;&#35201;&#20026;&#26576;&#20123;&#26356;&#26032;&#25805;&#20316;&#25552;&#20379;&#20107;&#21153;&#65292;&#20320;&#21487;&#33021;&#19981;&#24819;&#29992;Spring&#25110;&#20854;
        &#20182;&#25216;&#26415;&#35774;&#32622;&#19968;&#20010;&#20107;&#21153;&#20195;&#29702;&#12290;&#20351;&#29992;
        <tt class="classname">TransactionTemplate</tt>&#21487;&#33021;&#26159;&#20010;&#24456;&#22909;&#30340;&#26041;&#27861;&#12290;</p><p>&#21478;&#19968;&#26041;&#38754;&#65292;&#22914;&#26524;&#20320;&#30340;&#24212;&#29992;&#26377;&#22823;&#37327;&#30340;&#20107;&#21153;&#25805;&#20316;&#65292;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;&#23601;&#24456;&#26377;&#20215;&#20540;&#12290;&#23427;&#20351;&#24471;&#20107;&#21153;&#31649;&#29702;&#20174;&#19994;&#21153;&#36923;&#36753;&#20998;&#31163;&#65292;
        &#24182;&#19988;Spring&#20013;&#37197;&#32622;&#20063;&#19981;&#22256;&#38590;&#12290;&#20351;&#29992;Spring&#65292;&#32780;&#19981;&#26159;EJB CMT&#65292;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;&#37197;&#32622;&#30340;&#25104;&#26412;&#26497;&#22823;&#22320;&#38477;&#20302;&#12290;</p></div><div class="sect1" lang="zh_cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e4520"></a>7.6.&nbsp;&#20320;&#38656;&#35201;&#24212;&#29992;&#26381;&#21153;&#22120;&#31649;&#29702;&#20107;&#21153;&#21527;?</h2></div></div><div></div></div><p>Spring&#30340;&#20107;&#21153;&#31649;&#29702;&#33021;&#21147;&#65293;&#65293;&#23588;&#20854;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;&#65293;&#65293;&#26497;&#22823;&#22320;&#25913;&#21464;&#20102;J2EE&#24212;&#29992;&#31243;&#24207;&#38656;&#35201;
        &#24212;&#29992;&#26381;&#21153;&#22120;&#30340;&#20256;&#32479;&#24819;&#27861;&#12290;</p><p>&#23588;&#20854;&#65292;&#20320;&#19981;&#38656;&#35201;&#24212;&#29992;&#26381;&#21153;&#22120;&#20165;&#20165;&#20026;&#20102;&#36890;&#36807;EJB&#22768;&#26126;&#20107;&#21153;&#12290;&#20107;&#23454;&#19978;&#65292;&#21363;&#20351;&#20320;&#25317;
        &#26377;&#24378;&#22823;JTA&#25903;&#25345;&#30340;&#24212;&#29992;&#26381;&#21153;&#22120;&#65292;&#20320;&#20063;&#21487;&#20197;&#20915;&#23450;&#20351;&#29992;Spring&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;&#25552;&#20379;&#27604;
        EJB CMT&#26356;&#24378;&#22823;&#26356;&#39640;&#25928;&#30340;&#32534;&#31243;&#27169;&#22411;&#12290;</p><p>&#21482;&#26377;&#38656;&#35201;&#25903;&#25345;&#22810;&#20010;&#20107;&#21153;&#36164;&#28304;&#26102;&#65292;&#20320;&#25165;&#38656;&#35201;&#24212;&#29992;&#26381;&#21153;&#22120;&#30340;JTA&#25903;&#25345;&#12290;&#35768;&#22810;&#24212;&#29992;&#27809;&#26377;
        &#36825;&#20010;&#38656;&#27714;&#12290;&#20363;&#22914;&#35768;&#22810;&#39640;&#31471;&#24212;&#29992;&#20351;&#29992;&#21333;&#19968;&#30340;&#65292;&#20855;&#26377;&#39640;&#24230;&#25193;&#23637;&#24615;&#30340;&#25968;&#25454;&#24211;&#65292;&#22914;Oracle 9i RAC&#12290;</p><p>&#24403;&#28982;&#20063;&#35768;&#20320;&#38656;&#35201;&#24212;&#29992;&#26381;&#21153;&#22120;&#30340;&#20854;&#23427;&#21151;&#33021;&#65292;&#22914;JMS&#21644;JCA&#12290;&#20294;&#26159;&#22914;&#26524;&#20320;&#21482;&#38656;&#20351;&#29992;
        JTA&#65292;&#20320;&#21487;&#20197;&#32771;&#34385;&#24320;&#28304;&#30340;JTA&#23454;&#29616;&#65292;&#22914;JOTM&#65288;Spring&#25972;&#21512;&#20102;JOTM&#65289;&#12290;&#20294;&#26159;&#65292;
        2004&#24180;&#26089;&#26399;&#65292;&#39640;&#31471;&#30340;&#24212;&#29992;&#26381;&#21153;&#22120;&#25552;&#20379;&#26356;&#20581;&#22766;&#30340;XA&#36164;&#28304;&#25903;&#25345;&#12290;</p><p>&#26368;&#37325;&#35201;&#19968;&#28857;&#65292;&#20351;&#29992;Spring&#65292;<span class="emphasis"><em>&#20320;&#21487;&#20197;&#36873;&#25321;&#20309;&#26102;&#23558;&#20320;&#30340;&#24212;&#29992;&#36801;&#31227;&#21040;&#23436;&#25972;
        &#24212;&#29992;&#26381;&#21153;&#22120;</em></span>&#12290;&#20351;&#29992;EJB CMT&#25110;JTA&#37117;&#24517;&#39035;&#20070;&#20889;&#20195;&#30721;&#20351;&#29992;&#23616;&#37096;&#20107;&#21153;&#65292;
        &#20363;&#22914;JDBC&#36830;&#25509;&#30340;&#20107;&#21153;&#65292;&#22914;&#26524;&#20197;&#21069;&#38656;&#35201;&#20840;&#23616;&#30340;&#23481;&#22120;&#31649;&#29702;&#30340;&#20107;&#21153;&#65292;&#36824;&#35201;&#38754;&#20020;&#30528;&#32321;&#37325;
        &#30340;&#25913;&#20889;&#20195;&#30721;&#30340;&#36807;&#31243;&#65292;&#36825;&#20123;&#26085;&#23376;&#19968;&#21435;&#19981;&#22797;&#36820;&#20102;&#12290;&#20351;&#29992;Spring&#21482;&#26377;&#37197;&#32622;&#38656;&#35201;&#25913;&#21464;&#65292;&#20320;&#30340;&#20195;&#30721;
        &#19981;&#38656;&#35201;&#20462;&#25913;&#12290;
        </p></div><div class="sect1" lang="zh_cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e4536"></a>7.7.&nbsp;&#20844;&#20849;&#38382;&#39064;</h2></div></div><div></div></div><p>&#24320;&#21457;&#30528;&#38656;&#35201;&#25353;&#29031;&#38656;&#27714;&#20180;&#32454;&#30340;&#20351;&#29992;&#27491;&#30830;&#30340;
        <span class="emphasis"><em><tt class="literal">PlatformTransactionManager</tt></em></span>&#23454;&#29616;&#12290;
        </p><p>&#29702;&#35299;Spring&#20107;&#21153;&#25277;&#35937;&#26102;&#22914;&#20309;&#21644;JTA&#20840;&#23616;&#20107;&#21153;&#19968;&#36215;&#24037;&#20316;&#26159;&#38750;&#24120;&#37325;&#35201;&#30340;&#12290;&#20351;&#29992;&#24471;&#24403;&#65292;
        &#23601;&#19981;&#20250;&#26377;&#20219;&#20309;&#20914;&#31361;&#65306;Spring&#20165;&#20165;&#25552;&#20379;&#19968;&#20010;&#31616;&#21333;&#30340;&#65292;&#21487;&#20197;&#31227;&#26893;&#30340;&#25277;&#35937;&#23618;&#12290;</p><p>&#22914;&#26524;&#20320;&#20351;&#29992;&#20840;&#23616;&#20107;&#21153;&#65292;&#20320;<span class="emphasis"><em>&#24517;&#39035;</em></span>&#20026;&#20320;&#30340;&#25152;&#26377;&#20107;&#21153;&#25805;&#20316;&#20351;&#29992;Spring&#30340;
        <tt class="literal">org.springframework.transaction.jta.JtaTransactionManager</tt>&#12290;
        &#21542;&#21017;Spring&#23558;&#35797;&#22270;&#22312;&#35937;&#23481;&#22120;&#25968;&#25454;&#28304;&#36825;&#26679;&#30340;&#36164;&#28304;&#19978;&#25191;&#34892;&#23616;&#37096;&#20107;&#21153;&#12290;&#36825;&#26679;&#30340;&#23616;&#37096;&#20107;&#21153;&#27809;&#26377;&#20219;&#20309;
        &#24847;&#20041;&#65292;&#22909;&#30340;&#24212;&#29992;&#26381;&#21153;&#22120;&#20250;&#25226;&#36825;&#20316;&#20026;&#19968;&#20010;&#38169;&#35823;&#12290;<tt class="literal"></tt></p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="aspectj.html">&#19978;&#19968;&#39029;</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="index.html">&#19978;&#19968;&#32423;</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="metadata.html">&#19979;&#19968;&#39029;</a></td></tr><tr><td width="40%" align="left" valign="top">&#31532;&nbsp;6&nbsp;&#31456;&nbsp;&#38598;&#25104;AspectJ &nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">&#36215;&#22987;&#39029;</a></td><td width="40%" align="right" valign="top">&nbsp;&#31532;&nbsp;8&nbsp;&#31456;&nbsp;&#28304;&#20195;&#30721;&#32423;&#30340;&#20803;&#25968;&#25454;&#25903;&#25345;</td></tr></table></div></body></html>