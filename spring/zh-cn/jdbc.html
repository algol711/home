<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>&#31532;&nbsp;10&nbsp;&#31456;&nbsp;&#20351;&#29992;JDBC&#36827;&#34892;&#25968;&#25454;&#35775;&#38382;</title><link rel="stylesheet" href="../styles/html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.65.1"><link rel="home" href="index.html" title="Spring - Java/J2EE Application Framework"><link rel="up" href="index.html" title="Spring - Java/J2EE Application Framework"><link rel="previous" href="dao.html" title="&#31532;&nbsp;9&nbsp;&#31456;&nbsp;DAO&#25903;&#25345;"><link rel="next" href="orm.html" title="&#31532;&nbsp;11&nbsp;&#31456;&nbsp;&#20351;&#29992;ORM&#24037;&#20855;&#36827;&#34892;&#25968;&#25454;&#35775;&#38382; "></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">&#31532;&nbsp;10&nbsp;&#31456;&nbsp;&#20351;&#29992;JDBC&#36827;&#34892;&#25968;&#25454;&#35775;&#38382;</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="dao.html">&#19978;&#19968;&#39029;</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="orm.html">&#19979;&#19968;&#39029;</a></td></tr></table><hr></div><div class="chapter" lang="zh_cn"><div class="titlepage"><div><div><h2 class="title"><a name="jdbc"></a>&#31532;&nbsp;10&nbsp;&#31456;&nbsp;&#20351;&#29992;JDBC&#36827;&#34892;&#25968;&#25454;&#35775;&#38382;</h2></div></div><div></div></div><div class="sect1" lang="zh_cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jdbc-introduction"></a>10.1.&nbsp;&#31616;&#20171;</h2></div></div><div></div></div><p>Spring&#25552;&#20379;&#30340;JDBC&#25277;&#35937;&#26694;&#26550;&#30001;<tt class="literal">core</tt>&#65292;
    <tt class="literal"><tt class="literal">datasource</tt></tt>&#65292;<tt class="literal">object&#21644;
    <tt class="literal">support</tt></tt>&#22235;&#20010;&#19981;&#21516;&#30340;&#21253;&#32452;&#25104;&#12290;</p><p>&#23601;&#21644;&#23427;&#21517;&#23383;&#30340;&#26263;&#31034;&#19968;&#26679;&#65292;<tt class="literal">org.springframework.jdbc.core</tt>&#21253;&#37324;&#23450;&#20041;&#20102;&#25552;&#20379;&#26680;&#24515;&#21151;&#33021;&#30340;&#31867;&#12290;
    &#20854;&#20013;&#26377;&#21508;&#31181;SQLExceptionTranslator&#21644;DataFieldMaxValueIncrementer&#30340;&#23454;&#29616;&#20197;&#21450;&#19968;&#20010;&#29992;&#20110;JdbcTemplate&#30340;DAO&#22522;&#30784;&#31867;&#12290;</p><p><tt class="literal">org.springframework.jdbc.datasource</tt>&#21253;&#37324;&#26377;&#19968;&#20010;&#29992;&#20197;&#31616;&#21270;&#25968;&#25454;&#28304;&#35775;&#38382;&#30340;&#24037;&#20855;&#31867;&#65292;
    &#20197;&#21450;&#21508;&#31181;&#25968;&#25454;&#28304;&#30340;&#31616;&#21333;&#23454;&#29616;&#65292;&#20197;&#34987;&#29992;&#26469;&#22312;J2EE&#23481;&#22120;&#20043;&#22806;&#19981;&#32463;&#20462;&#25913;&#22320;&#27979;&#35797;JDBC&#20195;&#30721;&#12290;
    &#36825;&#20010;&#24037;&#20855;&#31867;&#25552;&#20379;&#20102;&#20174;JNDI&#33719;&#24471;&#36830;&#25509;&#21644;&#21487;&#33021;&#29992;&#21040;&#30340;&#20851;&#38381;&#36830;&#25509;&#30340;&#38745;&#24577;&#26041;&#27861;&#12290;
    &#23427;&#25903;&#25345;&#32465;&#23450;&#32447;&#31243;&#30340;&#36830;&#25509;&#65292;&#27604;&#22914;&#34987;&#29992;&#20110;DataSourceTransactionManager&#12290;</p><p>&#25509;&#30528;&#65292;<tt class="literal">org.springframework.jdbc.object</tt>&#21253;&#37324;&#26159;&#25226;&#20851;&#31995;&#25968;&#25454;&#24211;&#30340;&#26597;&#35810;&#65292;
    &#26356;&#26032;&#21644;&#23384;&#20648;&#36807;&#31243;&#23553;&#35013;&#20026;&#32447;&#31243;&#23433;&#20840;&#24182;&#21487;&#37325;&#29992;&#23545;&#35937;&#30340;&#31867;&#12290;
    &#36825;&#20013;&#26041;&#24335;&#27169;&#25311;&#20102;JDO&#65292;&#23613;&#31649;&#26597;&#35810;&#36820;&#22238;&#30340;&#23545;&#35937;&#29702;&#25152;&#24403;&#28982;&#30340;&#8220;<span class="quote">&#33073;&#31163;</span>&#8221;&#20102;&#25968;&#25454;&#24211;&#36830;&#25509;&#12290;
    &#36825;&#20010;JDBC&#30340;&#39640;&#23618;&#25277;&#35937;&#20381;&#36182;&#20110;<tt class="literal">org.springframework.jdbc.core</tt>&#21253;&#20013;&#25152;&#23454;&#29616;&#30340;&#24213;&#23618;&#25277;&#35937;&#12290;</p><p>&#26368;&#21518;&#22312;<tt class="literal">org.springframework.jdbc.support</tt>&#21253;&#20013;&#20320;&#21487;&#20197;&#25214;&#21040;
    <tt class="literal">SQLException</tt>&#30340;&#36716;&#25442;&#21151;&#33021;&#21644;&#19968;&#20123;&#24037;&#20855;&#31867;&#12290;</p><p>&#22312;JDBC&#35843;&#29992;&#20013;&#34987;&#25243;&#20986;&#30340;&#24322;&#24120;&#20250;&#34987;&#36716;&#25442;&#25104;&#22312;&#23450;&#20041;<tt class="literal">org.springframework.dao</tt>&#21253;&#20013;&#30340;&#24322;&#24120;&#12290;
    &#36825;&#24847;&#21619;&#30528;&#20351;&#29992;Spring JDBC&#25277;&#35937;&#23618;&#30340;&#20195;&#30721;&#19981;&#38656;&#35201;&#23454;&#29616;JDBC&#25110;&#32773;RDBMS&#29305;&#23450;&#30340;&#38169;&#35823;&#22788;&#29702;&#12290;
    &#25152;&#26377;&#30340;&#36716;&#25442;&#21518;&#30340;&#24322;&#24120;&#37117;&#26159;unchecked&#65292;&#23427;&#20801;&#35768;&#20320;&#25429;&#25417;&#37027;&#20123;&#20320;&#21487;&#20197;&#24674;&#22797;&#30340;&#24322;&#24120;&#65292;
    &#24182;&#23558;&#20854;&#20313;&#30340;&#24322;&#24120;&#20256;&#36882;&#32473;&#35843;&#29992;&#32773;&#12290;</p></div><div class="sect1" lang="zh_cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jdbc-core"></a>10.2.&nbsp;&#20351;&#29992;JDBC&#26680;&#24515;&#31867;&#25511;&#21046;&#22522;&#26412;&#30340;JDBC&#22788;&#29702;&#21644;&#38169;&#35823;&#22788;&#29702;</h2></div></div><div></div></div><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-JdbcTemplate"></a>10.2.1.&nbsp;JdbcTemplate</h3></div></div><div></div></div><p>&#36825;&#26159;&#22312;JDBC&#26680;&#24515;&#21253;&#20013;&#26368;&#37325;&#35201;&#30340;&#31867;&#12290;&#23427;&#31616;&#21270;&#20102;JDBC&#30340;&#20351;&#29992;&#65292;
      &#22240;&#20026;&#23427;&#22788;&#29702;&#20102;&#36164;&#28304;&#30340;&#24314;&#31435;&#21644;&#37322;&#25918;&#12290;
      &#23427;&#24110;&#21161;&#20320;&#36991;&#20813;&#19968;&#20123;&#24120;&#35265;&#30340;&#38169;&#35823;&#65292;&#27604;&#22914;&#24536;&#20102;&#24635;&#35201;&#20851;&#38381;&#36830;&#25509;&#12290;&#23427;&#36816;&#34892;&#26680;&#24515;&#30340;JDBC&#24037;&#20316;&#27969;&#65292;
      &#22914;Statement&#30340;&#24314;&#31435;&#21644;&#25191;&#34892;&#65292;&#32780;&#21482;&#38656;&#35201;&#24212;&#29992;&#31243;&#24207;&#20195;&#30721;&#25552;&#20379;SQL&#21644;&#25552;&#21462;&#32467;&#26524;&#12290;&#36825;&#20010;&#31867;&#25191;&#34892;SQL&#26597;&#35810;&#65292;
      &#26356;&#26032;&#25110;&#32773;&#35843;&#29992;&#23384;&#20648;&#36807;&#31243;&#65292;&#27169;&#25311;&#32467;&#26524;&#38598;&#30340;&#36845;&#20195;&#20197;&#21450;&#25552;&#21462;&#36820;&#22238;&#21442;&#25968;&#20540;&#12290;&#23427;&#36824;&#25429;&#25417;JDBC&#30340;&#24322;&#24120;&#24182;&#23558;&#23427;&#20204;&#36716;&#25442;&#25104;
      <tt class="literal">org.springframework.dao</tt>&#21253;&#20013;&#23450;&#20041;&#30340;&#36890;&#29992;&#30340;&#65292;&#33021;&#22815;&#25552;&#20379;&#26356;&#22810;&#20449;&#24687;&#30340;&#24322;&#24120;&#20307;&#31995;&#12290;</p><p>&#20351;&#29992;&#36825;&#20010;&#31867;&#30340;&#20195;&#30721;&#21482;&#38656;&#35201;&#26681;&#25454;&#26126;&#30830;&#23450;&#20041;&#30340;&#19968;&#32452;&#22865;&#32422;&#26469;&#23454;&#29616;&#22238;&#35843;&#25509;&#21475;&#12290;
      <tt class="literal">PreparedStatementCreator</tt>&#22238;&#35843;&#25509;&#21475;&#21019;&#24314;&#19968;&#20010;&#30001;&#35813;&#31867;&#25552;&#20379;&#30340;&#36830;&#25509;&#25152;&#24314;&#31435;&#30340;PreparedStatement&#65292;
      &#24182;&#25552;&#20379;SQL&#21644;&#20219;&#20309;&#24517;&#35201;&#30340;&#21442;&#25968;&#12290;<tt class="literal">CallableStatementCreateor</tt>&#23454;&#29616;&#21516;&#26679;&#30340;&#22788;&#29702;&#65292;
      &#21482;&#26159;&#23427;&#21019;&#24314;&#20102;CallableStatement&#12290;<tt class="literal">RowCallbackHandler</tt>&#25509;&#21475;&#20174;&#25968;&#25454;&#38598;&#30340;&#27599;&#19968;&#34892;&#20013;&#25552;&#21462;&#20540;&#12290;</p><p>&#36825;&#20010;&#31867;&#21487;&#20197;&#30452;&#25509;&#36890;&#36807;&#25968;&#25454;&#28304;&#30340;&#24341;&#29992;&#23454;&#20363;&#21270;&#65292;&#28982;&#21518;&#22312;&#26381;&#21153;&#20013;&#20351;&#29992;&#65292;
      &#20063;&#21487;&#20197;&#22312;ApplicationContext&#20013;&#20135;&#29983;&#24182;&#20316;&#20026;bean&#30340;&#24341;&#29992;&#32473;&#26381;&#21153;&#20351;&#29992;&#12290;
      &#27880;&#24847;&#65306;&#25968;&#25454;&#28304;&#24212;&#24403;&#24635;&#26159;&#20316;&#20026;&#19968;&#20010;bean&#22312;ApplicationContext&#20013;&#37197;&#32622;&#65292;
      &#31532;&#19968;&#31181;&#24773;&#20917;&#23427;&#34987;&#30452;&#25509;&#20256;&#36882;&#32473;&#26381;&#21153;&#65292;&#31532;&#20108;&#31181;&#24773;&#20917;&#32473;JdbcTemplate&#12290;
      &#22240;&#20026;&#36825;&#20010;&#31867;&#25226;&#22238;&#35843;&#25509;&#21475;&#21644;SQLExceptionTranslator&#25509;&#21475;&#20316;&#20026;&#21442;&#25968;&#34920;&#31034;&#65292;&#25152;&#20197;&#27809;&#26377;&#24517;&#35201;&#20026;&#23427;&#23450;&#20041;&#23376;&#31867;&#12290;
      &#36825;&#20010;&#31867;&#25191;&#34892;&#30340;&#25152;&#26377;SQL&#37117;&#20250;&#34987;&#35760;&#20837;&#26085;&#24535;&#12290;</p></div><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="d0e5126"></a>10.2.2.&nbsp;&#25968;&#25454;&#28304;</h3></div></div><div></div></div><p>&#20026;&#20102;&#20174;&#25968;&#25454;&#24211;&#33719;&#24471;&#25968;&#25454;&#65292;&#25105;&#20204;&#38656;&#35201;&#24471;&#21040;&#25968;&#25454;&#24211;&#30340;&#36830;&#25509;&#12290;
      Spring&#37319;&#29992;&#30340;&#26041;&#27861;&#26159;&#36890;&#36807;&#19968;&#20010;<tt class="literal">&#25968;&#25454;&#28304;</tt>&#12290;
      <tt class="literal">&#25968;&#25454;&#28304;</tt>&#26159;JDBC&#35268;&#33539;&#30340;&#19968;&#37096;&#20998;&#65292;&#23427;&#21487;&#20197;&#34987;&#35748;&#20026;&#26159;&#19968;&#20010;&#36890;&#29992;&#30340;&#36830;&#25509;&#24037;&#21378;&#12290;
      &#23427;&#20801;&#35768;&#23481;&#22120;&#25110;&#32773;&#26694;&#26550;&#23558;&#22312;&#24212;&#29992;&#31243;&#24207;&#20195;&#30721;&#20013;&#38544;&#34255;&#36830;&#25509;&#27744;&#21644;&#20107;&#21153;&#30340;&#31649;&#29702;&#25805;&#20316;&#12290;
      &#24320;&#21457;&#32773;&#23558;&#19981;&#38656;&#35201;&#30693;&#36947;&#36830;&#25509;&#25968;&#25454;&#24211;&#30340;&#20219;&#20309;&#32454;&#33410;&#65292;&#37027;&#26159;&#35774;&#32622;&#25968;&#25454;&#28304;&#30340;&#31649;&#29702;&#21592;&#30340;&#36131;&#20219;&#12290;
      &#34429;&#28982;&#20320;&#24456;&#21487;&#33021;&#22312;&#24320;&#21457;&#25110;&#32773;&#27979;&#35797;&#30340;&#26102;&#20505;&#38656;&#35201;&#20860;&#20219;&#20004;&#31181;&#35282;&#33394;&#65292;&#20294;&#26159;&#20320;&#24182;&#19981;&#38656;&#35201;&#30693;&#36947;&#23454;&#38469;&#20135;&#21697;&#20013;&#30340;&#25968;&#25454;&#28304;&#26159;&#22914;&#20309;&#37197;&#32622;&#30340;&#12290;</p><p>&#20351;&#29992;Spring&#30340;JDBC&#23618;&#65292;&#20320;&#21487;&#20197;&#20174;JNDI&#24471;&#21040;&#19968;&#20010;&#25968;&#25454;&#28304;&#65292;&#20063;&#21487;&#20197;&#36890;&#36807;&#20351;&#29992;Spring&#21457;&#34892;&#29256;&#25552;&#20379;&#30340;&#23454;&#29616;&#33258;&#24049;&#37197;&#32622;&#23427;&#12290;
      &#21518;&#32773;&#23545;&#20110;&#33073;&#31163;Web&#23481;&#22120;&#30340;&#21333;&#20803;&#27979;&#35797;&#26159;&#21313;&#20998;&#20415;&#21033;&#30340;&#12290;
      &#25105;&#20204;&#23558;&#22312;&#26412;&#33410;&#20013;&#20351;&#29992;<tt class="literal">DriverManagerDataSource</tt>&#23454;&#29616;&#65292;&#24403;&#28982;&#20197;&#21518;&#36824;&#20250;&#25552;&#21040;&#20854;&#20182;&#30340;&#19968;&#20123;&#30340;&#23454;&#29616;&#12290;
      <tt class="literal">DriverManagerDataSource</tt>&#21644;&#20256;&#32479;&#30340;&#26041;&#24335;&#19968;&#26679;&#33719;&#21462;JDBC&#36830;&#25509;&#12290;
      &#20026;&#20102;&#35753;<tt class="literal">DriverManager</tt>&#21487;&#20197;&#35013;&#36733;&#39537;&#21160;&#31867;&#65292;&#20320;&#24517;&#39035;&#25351;&#23450;JDBC&#39537;&#21160;&#23436;&#25972;&#30340;&#31867;&#21517;&#12290;
      &#28982;&#21518;&#20320;&#24517;&#39035;&#25552;&#20379;&#30456;&#23545;&#20110;&#21508;&#31181;JDBC&#39537;&#21160;&#30340;&#19981;&#21516;&#30340;URL&#12290;&#20320;&#24517;&#39035;&#21442;&#32771;&#20320;&#25152;&#29992;&#30340;&#39537;&#21160;&#30340;&#25991;&#26723;&#65292;&#20197;&#33719;&#24471;&#38656;&#35201;&#20351;&#29992;&#30340;&#27491;&#30830;&#21442;&#25968;&#12290;
      &#26368;&#21518;&#65292;&#20320;&#36824;&#24517;&#39035;&#25552;&#20379;&#29992;&#26469;&#36830;&#25509;&#25968;&#25454;&#24211;&#30340;&#29992;&#25143;&#21517;&#21644;&#23494;&#30721;
      &#19979;&#38754;&#36825;&#20010;&#20363;&#23376;&#35828;&#26126;&#22914;&#20309;&#37197;&#32622;<tt class="literal">DriverManagerDataSource:</tt></p><pre class="programlisting">DriverManagerDataSource dataSource = new DriverManagerDataSource();
dataSource.setDriverClassName( "org.hsqldb.jdbcDriver");
dataSource.setUrl( "jdbc:hsqldb:hsql://localhost:");
dataSource.setUsername( "sa");
dataSource.setPassword( ""); </pre></div><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-SQLExceptionTranslator"></a>10.2.3.&nbsp;SQLExceptionTranslator</h3></div></div><div></div></div><p><tt class="literal">SQLExceptionTranslator</tt>&#26159;&#19968;&#20010;&#38656;&#35201;&#23454;&#29616;&#30340;&#25509;&#21475;&#65292;
      &#23427;&#34987;&#29992;&#26469;&#22788;&#29702;SQLException&#21644;&#25105;&#20204;&#30340;&#25968;&#25454;&#35775;&#38382;&#24322;&#24120;<tt class="literal">org.springframework.dao.DataAccessException</tt>&#20043;&#38388;&#30340;&#36716;&#25442;&#12290;</p><p>&#23454;&#29616;&#21487;&#20197;&#26159;&#36890;&#29992;&#30340;(&#27604;&#22914;&#20351;&#29992;JDBC&#30340;SQLState&#20540;)&#65292;&#20063;&#21487;&#20197;&#20026;&#20102;&#26356;&#39640;&#30340;&#31934;&#30830;&#24230;&#29305;&#27530;&#21270;
      (&#27604;&#22914;&#20351;&#29992;Oracle&#30340;ErrorCode)&#12290;</p><p><tt class="literal">SQLErrorCodeSQLExceptionTranslator</tt>
      &#26159;SQLExceptionTranslator&#30340;&#23454;&#29616;&#65292;&#23427;&#34987;&#40664;&#35748;&#20351;&#29992;&#12290;&#27604;&#20379;&#24212;&#21830;&#25351;&#23450;&#30340;<tt class="literal">SQLState</tt>&#26356;&#20026;&#31934;&#30830;&#12290;
      ErrorCode&#30340;&#36716;&#25442;&#26159;&#22522;&#20110;&#34987;&#20445;&#23384;&#22312;<tt class="literal">SQLErrorCodes</tt>&#22411;&#30340;JavaBean&#20013;&#30340;&#20540;&#12290;
      &#36825;&#20010;&#31867;&#26159;&#30001;<tt class="literal">SQLErrorCodesFactory</tt>&#24314;&#31435;&#24182;&#22635;&#20805;&#30340;&#65292;&#23601;&#20687;&#23427;&#30340;&#21517;&#23383;&#35828;&#26126;&#30340;&#65292;
      <tt class="literal">SQLErrorCodesFactory</tt>&#26159;&#19968;&#20010;&#22522;&#20110;&#19968;&#20010;&#21517;&#20026;"sql-error-codes.xml"&#30340;&#37197;&#32622;&#25991;&#20214;&#30340;&#20869;&#23481;&#24314;&#31435;<tt class="literal">SQLErrorCodes</tt>&#30340;&#24037;&#21378;&#12290;
      &#36825;&#20010;&#25991;&#20214;&#24102;&#26377;&#20379;&#24212;&#21830;&#30340;&#30721;&#19968;&#36215;&#21457;&#24067;&#65292;&#24182;&#19988;&#26159;&#22522;&#20110;DatabaseMetaData&#20449;&#24687;&#20013;&#30340;DatabaseProductName&#65292;&#36866;&#21512;&#24403;&#21069;&#25968;&#25454;&#24211;&#30340;&#30721;&#20250;&#34987;&#20351;&#29992;&#12290;</p><p><tt class="literal">SQLErrorCodeSQLExceptionTranslator</tt>&#20351;&#29992;&#20197;&#19979;&#30340;&#21305;&#37197;&#35268;&#21017;&#65306;</p><div class="itemizedlist"><ul type="disc" compact><li><p>&#20351;&#29992;&#23376;&#31867;&#23454;&#29616;&#30340;&#33258;&#23450;&#20041;&#36716;&#25442;&#12290;&#35201;&#27880;&#24847;&#30340;&#26159;&#36825;&#20010;&#31867;&#26412;&#36523;&#23601;&#26159;&#19968;&#20010;&#20855;&#20307;&#31867;&#65292;&#24182;&#21487;&#20197;&#30452;&#25509;&#20351;&#29992;&#65292;
            &#22312;&#36825;&#31181;&#24773;&#20917;&#19979;&#65292;&#23558;&#19981;&#20351;&#29992;&#36825;&#26465;&#35268;&#21017;&#12290;</p></li><li><p>&#20351;&#29992;ErrorCode&#30340;&#21305;&#37197;&#12290;&#22312;&#40664;&#35748;&#24773;&#20917;&#19979;&#65292;ErrorCode&#26159;&#20174;SQLErrorCodesFactory&#24471;&#21040;&#30340;&#12290;
            &#23427;&#20174;classpath&#20013;&#23547;&#25214;ErrorCode&#65292;&#24182;&#25226;&#20174;&#25968;&#25454;&#24211;metadata&#20013;&#24471;&#21040;&#30340;&#25968;&#25454;&#24211;&#21517;&#23383;&#23884;&#20837;&#23427;&#20204;&#12290;</p></li><li><p>&#22914;&#26524;&#20197;&#19978;&#35268;&#21017;&#37117;&#26080;&#27861;&#21305;&#37197;&#65292;&#37027;&#20040;&#26159;&#29992;SQLStateSQLExceptionTranslator&#20316;&#20026;&#40664;&#35748;&#36716;&#25442;&#22120;&#12290;</p></li></ul></div><p><tt class="literal">SQLErrorCodeSQLExceptionTranslator</tt>&#21487;&#20197;&#20351;&#29992;&#20197;&#19979;&#30340;&#26041;&#24335;&#32487;&#25215;&#65306;
      </p><pre class="programlisting">public class MySQLErrorCodesTransalator extends SQLErrorCodeSQLExceptionTranslator {
    protected DataAccessException customTranslate(String task, String sql, SQLException sqlex) {
        if (sqlex.getErrorCode() == -12345)
            return new DeadlockLoserDataAccessException(task, sqlex);
        return null;
    }
}</pre><p>&#22312;&#36825;&#20010;&#20363;&#23376;&#20013;&#65292;&#21482;&#26377;&#29305;&#23450;&#30340;ErrorCode'-12345'&#34987;&#36716;&#25442;&#20102;&#65292;&#20854;&#20182;&#30340;&#38169;&#35823;&#34987;&#31616;&#21333;&#30340;&#36820;&#22238;&#65292;
&#30001;&#40664;&#35748;&#30340;&#36716;&#25442;&#23454;&#29616;&#26469;&#22788;&#29702;&#12290;&#35201;&#20351;&#29992;&#33258;&#23450;&#20041;&#36716;&#25442;&#22120;&#26102;&#65292;&#38656;&#35201;&#36890;&#36807;<tt class="literal">setExceptionTranslator</tt>
&#26041;&#27861;&#23558;&#23427;&#20256;&#36882;&#32473;<tt class="literal">JdbcTemplate</tt>&#65292;&#24182;&#19988;&#22312;&#25152;&#26377;&#38656;&#35201;&#20351;&#29992;&#33258;&#23450;&#20041;&#36716;&#25442;&#22120;&#30340;&#25968;&#25454;&#35775;&#38382;&#22788;&#29702;&#20013;&#20351;&#29992;&#36825;&#20010;<tt class="literal">JdbcTemplate</tt>
&#19979;&#38754;&#26159;&#19968;&#20010;&#22914;&#20309;&#20351;&#29992;&#33258;&#23450;&#20041;&#36716;&#25442;&#22120;&#30340;&#20363;&#23376;&#65306;
</p><pre class="programlisting">// create a JdbcTemplate and set data source 
JdbcTemplate jt = new JdbcTemplate(); 
jt.setDataSource(dataSource); 
// create a custom translator and set the datasource for the default translation lookup 
MySQLErrorCodesTransalator tr = new MySQLErrorCodesTransalator(); 
tr.setDataSource(dataSource); 
jt.setExceptionTranslator(tr); 
// use the JdbcTemplate for this SqlUpdate 
SqlUpdate su = new SqlUpdate(); 
su.setJdbcTemplate(jt); 
su.setSql("update orders set shipping_charge = shipping_charge * 1.05"); 
su.compile(); 
su.update();</pre><p>&#36825;&#20010;&#33258;&#23450;&#20041;&#30340;&#36716;&#25442;&#22120;&#24471;&#21040;&#20102;&#19968;&#20010;&#25968;&#25454;&#28304;&#65292;
&#22240;&#20026;&#25105;&#20204;&#20173;&#28982;&#38656;&#35201;&#40664;&#35748;&#30340;&#36716;&#25442;&#22120;&#22312;<tt class="literal">sql-error-codes.xml</tt>&#20013;&#26597;&#25214;ErrorCode&#12290;</p></div><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="d0e5219"></a>10.2.4.&nbsp;&#25191;&#34892;Statement</h3></div></div><div></div></div><p>&#35201;&#25191;&#34892;&#19968;&#20010;SQL&#65292;&#20960;&#20046;&#19981;&#38656;&#35201;&#20195;&#30721;&#12290;&#20320;&#25152;&#38656;&#35201;&#30340;&#20840;&#37096;&#20165;&#20165;&#26159;&#19968;&#20010;<tt class="literal">&#25968;&#25454;&#28304;</tt>&#21644;&#19968;&#20010;<tt class="literal">JdbcTemplate</tt>&#12290;
      &#19968;&#26086;&#20320;&#24471;&#21040;&#20102;&#23427;&#20204;&#65292;&#20320;&#23558;&#21487;&#20197;&#20351;&#29992;<tt class="literal">JdbcTemplate</tt>&#25552;&#20379;&#30340;&#22823;&#37327;&#26041;&#20415;&#30340;&#26041;&#27861;&#12290;
      &#19979;&#38754;&#26159;&#19968;&#20010;&#20363;&#23376;&#65292;&#23427;&#26174;&#31034;&#20102;&#24314;&#31435;&#19968;&#24352;&#34920;&#30340;&#26368;&#23567;&#30340;&#20294;&#26377;&#23436;&#25972;&#21151;&#33021;&#30340;&#31867;&#12290;
      </p><pre class="programlisting">import javax.sql.DataSource;
import org.springframework.jdbc.core.JdbcTemplate;

public class ExecuteAStatement {
    private JdbcTemplate jt;
    private DataSource dataSource;

    public void doExecute() {
        jt = new JdbcTemplate(dataSource);
        jt.execute("create table mytable (id integer, name varchar(100))"); 
    }

    public void setDataSource(DataSource dataSource) {
        this.dataSource = dataSource;
    }
}</pre></div><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="d0e5235"></a>10.2.5.&nbsp;&#25191;&#34892;&#26597;&#35810;</h3></div></div><div></div></div><p>&#38500;&#20102;execute&#26041;&#27861;&#65292;&#36824;&#26377;&#22823;&#37327;&#30340;&#26597;&#35810;&#26041;&#27861;&#12290;&#20854;&#20013;&#30340;&#19968;&#20123;&#34987;&#29992;&#26469;&#25191;&#34892;&#37027;&#20123;&#21482;&#36820;&#22238;&#21333;&#20010;&#20540;&#30340;&#26597;&#35810;&#12290;
      &#20063;&#35768;&#20320;&#38656;&#35201;&#24471;&#21040;&#21512;&#35745;&#25110;&#32773;&#26576;&#19968;&#34892;&#20013;&#30340;&#19968;&#20010;&#29305;&#23450;&#30340;&#20540;&#12290;&#22914;&#26524;&#26159;&#36825;&#31181;&#24773;&#20917;&#65292;&#20320;&#21487;&#20197;&#20351;&#29992;<tt class="literal">queryForInt</tt>&#65292;
      <tt class="literal">queryForLong</tt>&#25110;&#32773;<tt class="literal">queryForObject</tt>&#12290;
      &#21518;&#32773;&#23558;&#20250;&#25226;&#36820;&#22238;&#30340;JDBC&#31867;&#22411;&#36716;&#25442;&#25104;&#21442;&#25968;&#20013;&#25351;&#23450;&#30340;Java&#31867;&#12290;&#22914;&#26524;&#31867;&#22411;&#36716;&#25442;&#26080;&#25928;&#65292;&#37027;&#20040;&#23558;&#20250;&#25243;&#20986;&#19968;&#20010;<tt class="literal">InvalidDataAccessApiUsageException</tt>&#12290;
      &#19979;&#38754;&#30340;&#20363;&#23376;&#26377;&#20004;&#20010;&#26597;&#35810;&#26041;&#27861;&#65292;&#19968;&#20010;&#26597;&#35810;&#24471;&#21040;<tt class="literal">int</tt>&#65292;&#21478;&#19968;&#20010;&#26597;&#35810;&#24471;&#21040;<tt class="literal">String</tt>&#12290;</p><pre class="programlisting">import javax.sql.DataSource;
import org.springframework.jdbc.core.JdbcTemplate;

public class RunAQuery {
    private JdbcTemplate jt;
    private DataSource dataSource;
  
    public int getCount() {
        jt = new JdbcTemplate(dataSource);
        int count = jt.queryForInt("select count(*) from mytable");
        return count;
    }

    public String getName() {
        jt = new JdbcTemplate(dataSource);
        String name = (String) jt.queryForObject("select name from mytable", java.lang.String.class);
        return name;
    }

    public void setDataSource(DataSource dataSource) {
        this.dataSource = dataSource;
    }
}</pre><p>&#38500;&#20102;&#24471;&#21040;&#21333;&#19968;&#32467;&#26524;&#30340;&#26597;&#35810;&#26041;&#27861;&#20043;&#22806;&#65292;&#36824;&#26377;&#19968;&#20123;&#26041;&#27861;&#65292;&#21487;&#20197;&#24471;&#21040;&#19968;&#20010;&#21253;&#21547;&#26597;&#35810;&#36820;&#22238;&#30340;&#25968;&#25454;&#30340;List&#12290;
      &#20854;&#20013;&#26368;&#36890;&#29992;&#30340;&#19968;&#20010;&#26041;&#27861;&#26159;<tt class="literal">queryForList</tt>&#65292;&#23427;&#36820;&#22238;&#19968;&#20010;<tt class="literal">List</tt>&#65292;
      &#20854;&#20013;&#27599;&#19968;&#39033;&#37117;&#26159;&#19968;&#20010;&#34920;&#31034;&#23383;&#27573;&#20540;&#30340;<tt class="literal">Map</tt>&#12290;
      &#20320;&#29992;&#19979;&#38754;&#30340;&#20195;&#30721;&#22312;&#19978;&#38754;&#30340;&#20363;&#23376;&#20013;&#22686;&#21152;&#19968;&#20010;&#26041;&#27861;&#26469;&#24471;&#21040;&#19968;&#20010;&#25152;&#26377;&#35760;&#24405;&#34892;&#30340;List&#65306;</p><pre class="programlisting">    public List getList() {
        jt = new JdbcTemplate(dataSource);
        List rows = jt.queryForList("select * from mytable");
        return rows;
    }</pre><p>&#36820;&#22238;&#30340;List&#20250;&#20197;&#19979;&#38754;&#30340;&#24418;&#24335;&#65306;
      <tt class="literal">[{name=Bob, id=1}, {name=Mary, id=2}].</tt></p></div><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="d0e5277"></a>10.2.6.&nbsp;&#26356;&#26032;&#25968;&#25454;&#24211;</h3></div></div><div></div></div><p>&#36824;&#26377;&#24456;&#22810;&#26356;&#26032;&#30340;&#26041;&#27861;&#21487;&#20197;&#20379;&#20320;&#20351;&#29992;&#12290;&#25105;&#23558;&#23637;&#31034;&#19968;&#20010;&#20363;&#23376;&#65292;&#35828;&#26126;&#36890;&#36807;&#26576;&#19968;&#20010;&#20027;&#38190;&#26356;&#26032;&#19968;&#20010;&#23383;&#27573;&#12290;
      &#22312;&#36825;&#20010;&#20363;&#23376;&#37324;&#65292;&#25105;&#29992;&#20102;&#19968;&#20010;&#20351;&#29992;&#27036;&#23450;&#21442;&#25968;&#30340;SQL Statement&#12290;&#22823;&#22810;&#25968;&#26597;&#35810;&#21644;&#26356;&#26032;&#30340;&#26041;&#27861;&#37117;&#26377;&#36825;&#20010;&#21151;&#33021;&#12290;
      &#21442;&#25968;&#20540;&#36890;&#36807;&#23545;&#35937;&#25968;&#32452;&#20256;&#36882;&#12290;</p><pre class="programlisting">import javax.sql.DataSource;

import org.springframework.jdbc.core.JdbcTemplate;

public class ExecuteAnUpdate {
    private JdbcTemplate jt;
    private DataSource dataSource;

    public void setName(int id, String name) {
        jt = new JdbcTemplate(dataSource);
        jt.update("update mytable set name = ? where id = ?", new Object[] {name, new Integer(id)});
    }

    public void setDataSource(DataSource dataSource) {
        this.dataSource = dataSource;
    }
}</pre><p></p></div></div><div class="sect1" lang="zh_cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jdbc-datasource"></a>10.3.&nbsp;&#25511;&#21046;&#22914;&#20309;&#36830;&#25509;&#25968;&#25454;&#24211;</h2></div></div><div></div></div><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-DataSourceUtils"></a>10.3.1.&nbsp;DataSourceUtils</h3></div></div><div></div></div><p>&#36825;&#20010;&#36741;&#21161;&#31867;&#25552;&#20379;&#20174;JNDI&#33719;&#21462;&#36830;&#25509;&#21644;&#22312;&#24517;&#35201;&#26102;&#20851;&#38381;&#36830;&#25509;&#30340;&#26041;&#27861;&#12290;&#23427;&#25903;&#25345;&#32447;&#31243;&#32465;&#23450;&#30340;&#36830;&#25509;&#65292;
      &#27604;&#22914;&#34987;&#29992;&#20110;DataSourceTransactionManager&#12290;</p><p>&#27880;&#24847;&#65306;&#26041;&#27861;getDataSourceFromJndi&#29992;&#20197;&#38024;&#23545;&#37027;&#20123;&#19981;&#20351;&#29992;BeanFactory&#25110;&#32773;ApplicationContext
      &#30340;&#24212;&#29992;&#12290;&#23545;&#20110;&#21518;&#32773;&#65292;&#24314;&#35758;&#22312;factory&#20013;&#37197;&#32622;&#20320;&#30340;bean&#29978;&#33267;<tt class="literal">JdbcTemplate</tt>&#30340;&#24341;&#29992;&#65306;
      &#20351;&#29992;<tt class="literal">JndiObjectFactoryBean</tt>&#21487;&#20197;&#20174;JNDI&#20013;&#24471;&#21040;&#19968;&#20010;<tt class="literal">DataSource</tt>
      &#24182;&#23558;<tt class="literal">DataSource</tt>&#30340;&#24341;&#29992;&#32473;&#21035;&#30340;bean&#12290;&#35201;&#20999;&#25442;&#21040;&#21478;&#19968;&#20010;<tt class="literal">DataSource</tt>
      &#23601;&#20165;&#20165;&#26159;&#19968;&#20010;&#37197;&#32622;&#30340;&#38382;&#39064;&#65306;&#20320;&#29978;&#33267;&#21487;&#20197;&#29992;&#19968;&#20010;&#38750;JNDI&#30340;<tt class="literal">DataSource</tt>&#26469;&#26367;&#25442;
      <tt class="literal">FactoryBean</tt>&#30340;&#23450;&#20041;&#65281;</p></div><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-SmartDataSource"></a>10.3.2.&nbsp;SmartDataSource</h3></div></div><div></div></div><p>&#23454;&#29616;&#36825;&#20010;&#25509;&#21475;&#30340;&#31867;&#21487;&#20197;&#25552;&#20379;&#19968;&#20010;&#20851;&#31995;&#25968;&#25454;&#24211;&#30340;&#36830;&#25509;&#12290;
      &#23427;&#32487;&#25215;<tt class="literal">javax.sql.DataSource</tt>&#25509;&#21475;&#65292;&#20351;&#29992;&#23427;&#21487;&#20197;&#30693;&#36947;&#22312;&#19968;&#27425;&#25968;&#25454;&#24211;&#25805;&#20316;&#21518;&#65292;
      &#26159;&#21542;&#38656;&#35201;&#20851;&#38381;&#36830;&#25509;&#12290;&#22914;&#26524;&#25105;&#20204;&#38656;&#35201;&#37325;&#29992;&#19968;&#20010;&#36830;&#25509;&#65292;&#37027;&#20040;&#23427;&#23545;&#20110;&#25928;&#29575;&#26159;&#24456;&#26377;&#29992;&#30340;&#12290;</p></div><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-AbstractDataSource"></a>10.3.3.&nbsp;AbstractDataSource</h3></div></div><div></div></div><p>&#36825;&#20010;&#23454;&#29616;Spring&#30340;<tt class="literal">DataSource</tt>&#30340;&#25277;&#35937;&#31867;&#65292;&#20851;&#27880;&#19968;&#20123;"&#26080;&#36259;"&#30340;&#19996;&#35199;&#12290;
      &#22914;&#26524;&#20320;&#35201;&#20889;&#33258;&#24049;&#30340;<tt class="literal">DataSource</tt>&#23454;&#29616;&#65292;&#20320;&#21487;&#20197;&#32487;&#25215;&#36825;&#20010;&#31867;&#12290;</p></div><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-SingleConnectionDataSource"></a>10.3.4.&nbsp;SingleConnectionDataSource</h3></div></div><div></div></div><p>&#36825;&#20010;<tt class="literal">SmartDataSource</tt>&#30340;&#23454;&#29616;&#23553;&#35013;&#20102;&#21333;&#20010;&#22312;&#20351;&#29992;&#21518;&#19981;&#20250;&#20851;&#38381;&#30340;&#36830;&#25509;&#12290;
      &#25152;&#20197;&#24456;&#26126;&#26174;&#65292;&#23427;&#27809;&#26377;&#22810;&#32447;&#31243;&#30340;&#33021;&#21147;&#12290;</p><p>&#22914;&#26524;&#23458;&#25143;&#31471;&#20195;&#30721;&#24819;&#20851;&#38381;&#36825;&#20010;&#35748;&#20026;&#26159;&#27744;&#31649;&#29702;&#30340;&#36830;&#25509;&#65292;&#27604;&#22914;&#20351;&#29992;&#25345;&#20037;&#21270;&#24037;&#20855;&#30340;&#26102;&#20505;&#65292;
      &#38656;&#35201;&#23558;<tt class="literal">suppressClose</tt>&#35774;&#32622;&#25104;true&#12290;&#36825;&#26679;&#20250;&#36820;&#22238;&#19968;&#20010;&#31105;&#27490;&#20851;&#38381;&#30340;&#20195;&#29702;&#26469;&#25509;&#31649;&#29289;&#29702;&#36830;&#25509;&#12290;
      &#38656;&#35201;&#27880;&#24847;&#30340;&#26159;&#65292;&#20320;&#23558;&#26080;&#27861;&#23558;&#19981;&#20877;&#33021;&#23558;&#36825;&#20010;&#36830;&#25509;&#36716;&#25442;&#25104;&#26412;&#22320;Oracle&#36830;&#25509;&#25110;&#32773;&#31867;&#20284;&#30340;&#36830;&#25509;&#12290;</p><p>&#23427;&#30340;&#20027;&#35201;&#20316;&#29992;&#26159;&#29992;&#26469;&#27979;&#35797;&#12290;&#20363;&#22914;&#65292;&#23427;&#21487;&#20197;&#24456;&#23481;&#26131;&#30340;&#35753;&#27979;&#35797;&#20195;&#30721;&#33073;&#31163;&#24212;&#29992;&#26381;&#21153;&#22120;&#27979;&#35797;&#65292;&#32780;&#21482;&#38656;&#35201;&#19968;&#20010;&#31616;&#26131;&#30340;JNDI&#29615;&#22659;&#12290;
      &#21644;<tt class="literal">DriverManagerDataSource</tt>&#30456;&#21453;&#65292;&#23427;&#22312;&#25152;&#26377;&#30340;&#26102;&#20505;&#37117;&#37325;&#29992;&#19968;&#20010;&#36830;&#25509;&#65292;
      &#20197;&#27492;&#26469;&#36991;&#20813;&#24314;&#31435;&#29289;&#29702;&#36830;&#25509;&#36807;&#22810;&#30340;&#28040;&#32791;&#12290;</p></div><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-DriverManagerDataSource"></a>10.3.5.&nbsp;DriverManagerDataSource</h3></div></div><div></div></div><p>&#36825;&#20010;<tt class="literal">SmartDataSource</tt>&#30340;&#23454;&#29616;&#36890;&#36807;bean&#30340;&#23646;&#24615;&#37197;&#32622;JDBC&#39537;&#21160;&#65292;
      &#24182;&#27599;&#27425;&#37117;&#36820;&#22238;&#19968;&#20010;&#26032;&#30340;&#36830;&#25509;&#12290;</p><p>&#23427;&#23545;&#20110;&#27979;&#35797;&#25110;&#32773;&#33073;&#31163;J2EE&#23481;&#22120;&#30340;&#29420;&#31435;&#29615;&#22659;&#37117;&#26159;&#26377;&#29992;&#30340;&#65292;
      &#23427;&#21487;&#20197;&#20316;&#20026;&#19981;&#21516;&#30340;ApplicationContext&#20013;&#30340;<tt class="literal">&#25968;&#25454;&#28304;</tt>bean&#65292;
      &#20063;&#21487;&#20197;&#21644;&#31616;&#26131;&#30340;JNDI&#29615;&#22659;&#19968;&#36215;&#24037;&#20316;&#12290;&#34987;&#35748;&#20026;&#26159;&#27744;&#31649;&#29702;&#30340;<tt class="literal">Connection.close()</tt>&#25805;&#20316;
      &#30340;&#35843;&#29992;&#21482;&#20250;&#31616;&#21333;&#30340;&#20851;&#38381;&#36830;&#25509;&#65292;&#25152;&#20197;&#20219;&#20309;&#20351;&#29992;&#25968;&#25454;&#28304;&#30340;&#25345;&#20037;&#21270;&#20195;&#30721;&#37117;&#21487;&#20197;&#24037;&#20316;&#12290;</p></div><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-DataSourceTransactionManager"></a>10.3.6.&nbsp;DataSourceTransactionManager</h3></div></div><div></div></div><p>&#36825;&#20010;PlatformTransactionManager&#30340;&#23454;&#29616;&#26159;&#23545;&#20110;&#21333;&#20010;JDBC&#25968;&#25454;&#28304;&#30340;&#12290;
      &#20174;&#26576;&#20010;&#25968;&#25454;&#28304;&#32465;&#23450;&#19968;&#20010;JDBC&#36830;&#25509;&#21040;&#19968;&#20010;&#32447;&#31243;&#65292;&#21487;&#33021;&#20801;&#35768;&#27599;&#20010;&#25968;&#25454;&#28304;&#19968;&#20010;&#32447;&#31243;&#36830;&#25509;&#12290;</p><p>&#24212;&#29992;&#31243;&#24207;&#30340;&#20195;&#30721;&#38656;&#35201;&#36890;&#36807;<tt class="literal">DataSourceUtils.getConnection(DataSource)</tt>&#21462;&#24471;JDBC&#36830;&#25509;&#20195;&#26367;
      J2EE&#26631;&#20934;&#30340;&#26041;&#27861;<tt class="literal">DataSource.getConnection</tt>&#12290;&#36825;&#26159;&#25512;&#33616;&#30340;&#26041;&#27861;&#65292;
      &#22240;&#20026;&#23427;&#20250;&#25243;&#20986;<tt class="literal">org.springframework.dao</tt>&#20013;&#30340;unchecked&#30340;&#24322;&#24120;&#20195;&#26367;<tt class="literal">SQLException</tt>&#12290;
      Framework&#20013;&#25152;&#26377;&#30340;&#31867;&#37117;&#20351;&#29992;&#36825;&#31181;&#26041;&#27861;&#65292;&#27604;&#22914;<tt class="literal">JdbcTemplate</tt>&#12290;
      &#22914;&#26524;&#19981;&#20351;&#29992;&#20107;&#21153;&#31649;&#29702;&#65292;&#37027;&#20040;&#23601;&#20250;&#20351;&#29992;&#26631;&#20934;&#30340;&#26041;&#27861;&#65292;&#36825;&#26679;&#20182;&#23601;&#21487;&#20197;&#22312;&#20219;&#20309;&#24773;&#20917;&#19979;&#20351;&#29992;&#12290;</p><p>&#25903;&#25345;&#33258;&#23450;&#20041;&#30340;&#38548;&#31163;&#32423;&#65292;&#20197;&#21450;&#24212;&#29992;&#20110;&#36866;&#24403;&#30340;JDBC statement&#26597;&#35810;&#30340;&#36229;&#26102;&#12290;
      &#35201;&#25903;&#25345;&#21518;&#32773;&#65292;&#24212;&#29992;&#31243;&#24207;&#20195;&#30721;&#24517;&#39035;&#20351;&#29992;<tt class="literal">JdbcTemplate</tt>&#25110;&#32773;&#23545;&#27599;&#19968;&#20010;&#21019;&#24314;&#30340;statement
      &#37117;&#35843;&#29992;<tt class="literal">DataSourceUtils.<tt class="literal">applyTransactionTimeout</tt></tt>&#12290;</p><p>&#22240;&#20026;&#23427;&#19981;&#38656;&#35201;&#23481;&#22120;&#25903;&#25345;JTA&#65292;&#22312;&#21482;&#26377;&#21333;&#20010;&#36164;&#28304;&#30340;&#24773;&#20917;&#19979;&#65292;
      &#36825;&#20010;&#23454;&#29616;&#21487;&#20197;&#20195;&#26367;<tt class="literal">JtaTransactionManager</tt>&#12290;
      &#22914;&#26524;&#20320;&#22362;&#25345;&#38656;&#35201;&#30340;&#36830;&#25509;&#30340;&#26597;&#25214;&#27169;&#24335;&#65292;&#20004;&#32773;&#38388;&#30340;&#20999;&#25442;&#21482;&#38656;&#35201;&#26356;&#25442;&#37197;&#32622;&#12290;
      &#19981;&#36807;&#38656;&#35201;&#27880;&#24847;JTA&#19981;&#25903;&#25345;&#38548;&#31163;&#32423;&#12290;</p></div></div><div class="sect1" lang="zh_cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jdbc-object"></a>10.4.&nbsp;JDBC&#25805;&#20316;&#30340;Java&#23545;&#35937;&#21270;</h2></div></div><div></div></div><p><tt class="literal">org.springframework.jdbc.object</tt>&#21253;&#30001;&#19968;&#20123;&#20801;&#35768;&#20320;
    &#20197;&#26356;&#38754;&#21521;&#23545;&#35937;&#30340;&#26041;&#24335;&#35775;&#38382;&#25968;&#25454;&#24211;&#30340;&#31867;&#32452;&#25104;&#12290;&#20320;&#21487;&#20197;&#25191;&#34892;&#26597;&#35810;&#24182;&#33719;&#24471;&#19968;&#20010;&#21253;&#21547;&#19994;&#21153;&#23545;&#35937;&#30340;List&#65292;
    &#36825;&#20123;&#19994;&#21153;&#23545;&#35937;&#20851;&#31995;&#25968;&#25454;&#30340;&#23383;&#27573;&#20540;&#26144;&#23556;&#25104;&#23427;&#20204;&#30340;&#23646;&#24615;&#12290;&#20320;&#20063;&#21487;&#20197;&#25191;&#34892;&#23384;&#20648;&#36807;&#31243;&#65292;&#26356;&#26032;&#65292;&#21024;&#38500;&#21644;&#25554;&#20837;&#25805;&#20316;&#12290;</p><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-SqlQuery"></a>10.4.1.&nbsp;SqlQuery</h3></div></div><div></div></div><p>&#36825;&#26159;&#19968;&#20010;&#34920;&#31034;SQL&#26597;&#35810;&#30340;&#21487;&#37325;&#29992;&#30340;&#32780;&#19988;&#32447;&#31243;&#23433;&#20840;&#30340;&#23545;&#35937;&#12290;
      &#23376;&#31867;&#24517;&#39035;&#23454;&#29616;newResultReader()&#26041;&#27861;&#26469;&#25552;&#20379;&#19968;&#20010;&#23545;&#35937;&#65292;&#23427;&#33021;&#22312;&#24490;&#29615;&#22788;&#29702;ResultSet&#30340;&#26102;&#20505;&#20445;&#23384;&#32467;&#26524;&#12290;
      &#36825;&#20010;&#31867;&#24456;&#23569;&#34987;&#30452;&#25509;&#20351;&#29992;&#65292;&#32780;&#20351;&#29992;&#23427;&#30340;&#23376;&#31867;<tt class="literal">MappingSqlQuery</tt>&#65292;&#23427;&#25552;&#20379;&#22810;&#24471;&#22810;&#30340;&#26041;&#27861;
      &#23558;&#25968;&#25454;&#34892;&#26144;&#23556;&#21040;Java&#31867;&#12290;<tt class="literal">MappingSqlQueryWithParameters</tt>
      &#21644;<tt class="literal">UpdatableSqlQuery</tt>&#26159;&#32487;&#25215;<tt class="literal">SqlQuery</tt>&#30340;&#21478;&#22806;&#20004;&#20010;&#23454;&#29616;&#12290;</p></div><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-MappingSqlQuery"></a>10.4.2.&nbsp;MappingSqlQuery</h3></div></div><div></div></div><p><tt class="literal">MappingSqlQuery</tt>&#26159;&#19968;&#20010;&#21487;&#20197;&#37325;&#29992;&#30340;&#26597;&#35810;&#23545;&#35937;&#65292;
      &#23427;&#30340;&#23376;&#31867;&#24517;&#39035;&#23454;&#29616;&#25277;&#35937;&#26041;&#27861;<tt class="literal">mapRow(ResultSet, int)</tt>&#26469;&#25226;JDBC
      <tt class="literal">ResultSet</tt>&#30340;&#27599;&#19968;&#34892;&#36716;&#25442;&#25104;&#23545;&#35937;&#12290;</p><p>&#22312;&#25152;&#26377;&#30340;<tt class="literal">SqlQuery</tt>&#23454;&#29616;&#20013;&#65292;&#36825;&#20010;&#31867;&#26159;&#26368;&#24120;&#20351;&#29992;&#24182;&#19988;&#20063;&#26159;&#26368;&#23481;&#26131;&#20351;&#29992;&#30340;&#12290;</p><p>&#19979;&#38754;&#26159;&#19968;&#20010;&#33258;&#23450;&#20041;&#26597;&#35810;&#30340;&#31616;&#21333;&#20363;&#23376;&#65292;&#23427;&#25226;customer&#34920;&#20013;&#30340;&#25968;&#25454;&#26144;&#23556;&#25104;&#21483;&#20570;Customer&#30340;Java&#31867;&#12290;</p><pre class="programlisting">  private class CustomerMappingQuery extends MappingSqlQuery {
    public CustomerMappingQuery(DataSource ds) {
      super(ds, "SELECT id, name FROM customer WHERE id = ?");
      super.declareParameter(new SqlParameter("id", Types.INTEGER));
      compile();
    }
    public Object mapRow(ResultSet rs, int rowNumber) throws SQLException {
      Customer cust = new Customer();
      cust.setId((Integer) rs.getObject("id"));
      cust.setName(rs.getString("name"));
      return cust;
    } 
  }</pre><p>&#25105;&#20204;&#20026;customer&#26597;&#35810;&#25552;&#20379;&#19968;&#20010;&#26500;&#24314;&#26041;&#27861;&#65292;&#23427;&#21482;&#26377;<tt class="literal">&#25968;&#25454;&#28304;</tt>&#36825;&#19968;&#20010;&#21442;&#25968;&#12290;
      &#22312;&#26500;&#24314;&#26041;&#27861;&#20013;&#65292;&#25105;&#20204;&#35843;&#29992;&#36229;&#31867;&#30340;&#26500;&#24314;&#26041;&#27861;&#65292;&#24182;&#23558;<tt class="literal">&#25968;&#25454;&#28304;</tt>&#21644;&#23558;&#35201;&#29992;&#26469;&#26597;&#35810;&#21462;&#24471;&#25968;&#25454;&#30340;SQL&#20316;&#20026;&#21442;&#25968;&#12290;
      &#22240;&#20026;&#36825;&#20010;SQL&#23558;&#34987;&#29992;&#26469;&#24314;&#31435;<tt class="literal">PreparedStatement</tt>&#65292;&#25152;&#20197;&#23427;&#21487;&#20197;&#21253;&#21547;&#65311;&#26469;&#32465;&#23450;&#25191;&#34892;&#26102;&#20250;&#24471;&#21040;&#30340;&#21442;&#25968;&#12290;
      &#27599;&#19968;&#20010;&#21442;&#25968;&#24517;&#39035;&#36890;&#36807;<tt class="literal">declareParameter</tt>&#26041;&#27861;&#24182;&#20256;&#36882;&#32473;&#23427;&#19968;&#20010;<tt class="literal">SqlParameter</tt>&#26469;&#22768;&#26126;&#12290;
      <tt class="literal">SqlParameter</tt>&#26377;&#19968;&#20010;&#21517;&#23383;&#21644;&#19968;&#20010;&#22312;<tt class="literal">java.sql.Types</tt>&#23450;&#20041;&#30340;JDBC&#31867;&#22411;&#12290;
      &#22312;&#25152;&#26377;&#30340;&#21442;&#25968;&#37117;&#23450;&#20041;&#23436;&#21518;&#65292;&#25105;&#20204;&#35843;&#29992;<tt class="literal">compile</tt>&#26041;&#27861;&#24314;&#31435;&#38543;&#21518;&#20250;&#25191;&#34892;&#30340;<tt class="literal">PreparedStatement</tt>&#12290;</p><p>&#25105;&#20204;&#26469;&#30475;&#19968;&#27573;&#20195;&#30721;&#65292;&#26469;&#23454;&#20363;&#21270;&#36825;&#20010;&#33258;&#23450;&#20041;&#26597;&#35810;&#23545;&#35937;&#24182;&#25191;&#34892;&#65306;</p><pre class="programlisting">    public Customer getCustomer(Integer id) {
        CustomerMappingQuery custQry = new CustomerMappingQuery(dataSource); 
        Object[] parms = new Object[1];
        parms[0] = id;
        List customers = custQry.execute(parms);
        if (customers.size() &gt; 0)
            return (Customer) customers.get(0);
        else
            return null;
    }</pre><p>&#22312;&#20363;&#23376;&#20013;&#30340;&#36825;&#20010;&#26041;&#27861;&#36890;&#36807;&#19968;&#20010;&#21442;&#25968;id&#24471;&#21040;customer&#12290;&#22312;&#24314;&#31435;&#20102;<tt class="literal">CustomerMappingQuery</tt>
      &#31867;&#30340;&#19968;&#20010;&#23454;&#20363;&#21518;&#65292;&#25105;&#20204;&#20877;&#21019;&#24314;&#19968;&#20010;&#25968;&#32452;&#65292;&#29992;&#26469;&#25918;&#32622;&#25152;&#26377;&#38656;&#35201;&#20256;&#36882;&#30340;&#21442;&#25968;&#12290;
      &#22312;&#36825;&#20010;&#20363;&#23376;&#20013;&#21482;&#26377;&#19968;&#20010;<tt class="literal">Integer</tt>&#30340;&#21442;&#25968;&#38656;&#35201;&#20256;&#36882;&#12290;
      &#29616;&#22312;&#25105;&#20204;&#20351;&#29992;&#36825;&#20010;&#25968;&#32452;&#25191;&#34892;&#26597;&#35810;&#65292;&#25105;&#20204;&#20250;&#24471;&#21040;&#19968;&#20010;<tt class="literal">List</tt>&#21253;&#21547;&#30528;<tt class="literal">Customer</tt>&#23545;&#35937;&#65292;
      &#23427;&#23545;&#24212;&#26597;&#35810;&#36820;&#22238;&#32467;&#26524;&#30340;&#27599;&#19968;&#34892;&#12290;&#22312;&#36825;&#20010;&#20363;&#23376;&#20013;&#22914;&#26524;&#26377;&#21305;&#37197;&#30340;&#35805;&#65292;&#21482;&#20250;&#26377;&#19968;&#20010;&#23454;&#20307;&#12290;</p></div><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-SqlUpdate"></a>10.4.3.&nbsp;SqlUpdate</h3></div></div><div></div></div><p>&#36825;&#20010;RdbmsOperation&#23376;&#31867;&#34920;&#31034;&#19968;&#20010;SQL&#26356;&#26032;&#25805;&#20316;&#12290;&#23601;&#20687;&#26597;&#35810;&#19968;&#26679;&#65292;
      &#26356;&#26032;&#23545;&#35937;&#26159;&#21487;&#37325;&#29992;&#30340;&#12290;&#21644;&#25152;&#26377;&#30340;RdbmsOperation&#23545;&#35937;&#19968;&#26679;&#65292;&#26356;&#26032;&#21487;&#20197;&#26377;&#21442;&#25968;&#24182;&#23450;&#20041;&#22312;SQL&#20013;&#12290;</p><p>&#31867;&#20284;&#20110;&#26597;&#35810;&#23545;&#35937;&#20013;&#30340;execute()&#26041;&#27861;&#65292;&#36825;&#20010;&#31867;&#25552;&#20379;&#24456;&#22810;update()&#30340;&#26041;&#27861;&#12290;</p><p>&#36825;&#20010;&#31867;&#26159;&#20855;&#20307;&#30340;&#12290;&#36890;&#36807;SQL&#35774;&#23450;&#21644;&#21442;&#25968;&#22768;&#26126;&#65292;&#23427;&#21487;&#20197;&#24456;&#23481;&#26131;&#30340;&#21442;&#25968;&#21270;&#65292;&#34429;&#28982;&#20182;&#20063;&#21487;&#20197;&#23376;&#20363;&#21270;
      (&#20363;&#22914;&#22686;&#21152;&#33258;&#23450;&#20041;&#26041;&#27861;)&#12290;</p><pre class="programlisting">import java.sql.Types;

import javax.sql.DataSource;

import org.springframework.jdbc.core.SqlParameter;
import org.springframework.jdbc.object.SqlUpdate;

public class UpdateCreditRating  extends SqlUpdate {
    public UpdateCreditRating(DataSource ds) {
        setDataSource(ds);
        setSql("update customer set credit_rating = ? where id = ?");
        declareParameter(new SqlParameter(Types.NUMERIC));
        declareParameter(new SqlParameter(Types.NUMERIC));
        compile();
    }

    /**
     * @param id for the Customer to be updated
     * @param rating the new value for credit rating
     * @return number of rows updated
     */
    public int run(int id, int rating) {
        Object[] params =
            new Object[] {
                new Integer(rating),
                new Integer(id)};
        return update(params);
    }
}</pre></div><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-StoredProcedure"></a>10.4.4.&nbsp;StoredProcedure</h3></div></div><div></div></div><p>&#36825;&#26159;RDBMS&#23384;&#20648;&#36807;&#31243;&#30340;&#23545;&#35937;&#25277;&#35937;&#30340;&#36229;&#31867;&#12290;&#23427;&#26159;&#19968;&#20010;&#25277;&#35937;&#31867;&#65292;&#23427;&#30340;&#25191;&#34892;&#26041;&#27861;&#37117;&#26159;protected&#30340;&#65292;
      &#20197;&#36991;&#20813;&#34987;&#30452;&#25509;&#35843;&#29992;&#65292;&#32780;&#21482;&#33021;&#36890;&#36807;&#25552;&#20379;&#26356;&#20005;&#26684;&#24418;&#24335;&#30340;&#23376;&#31867;&#35843;&#29992;&#12290;</p><p>&#32487;&#25215;&#30340;sql&#23646;&#24615;&#26159;RDBMS&#20013;&#23384;&#20648;&#36807;&#31243;&#30340;&#21517;&#23383;&#12290;&#34429;&#28982;&#36825;&#20010;&#31867;&#20013;&#25552;&#20379;&#30340;&#20854;&#20182;&#21151;&#33021;&#22312;JDBC3.0&#20013;&#20063;&#21313;&#20998;&#30340;&#37325;&#35201;&#65292;
      &#20294;&#26368;&#20540;&#24471;&#27880;&#24847;&#30340;&#26159;JDBC3.0&#20013;&#30340;&#20351;&#29992;&#21629;&#21517;&#30340;&#21442;&#25968;&#12290;</p><p>&#19979;&#38754;&#26159;&#19968;&#27573;&#20363;&#23376;&#31243;&#24207;&#65292;&#23427;&#35843;&#29992;Oracle&#25968;&#25454;&#24211;&#25552;&#20379;&#30340;&#20989;&#25968;sysdate()&#12290;
      &#35201;&#20351;&#29992;&#23384;&#20648;&#36807;&#31243;&#30340;&#21151;&#33021;&#65292;&#20320;&#24517;&#39035;&#21019;&#24314;&#19968;&#20010;&#32487;&#25215;<tt class="literal">StoredProcedure</tt>&#30340;&#31867;.
      &#36825;&#37324;&#27809;&#26377;&#20219;&#20309;&#36755;&#20837;&#21442;&#25968;&#65292;&#20294;&#38656;&#35201;&#20351;&#29992;<tt class="literal">SqlOutParameter</tt>&#31867;&#22768;&#26126;&#19968;&#20010;date&#22411;&#30340;&#36755;&#20986;&#21442;&#25968;&#12290;
      <tt class="literal">execute()</tt>&#26041;&#27861;&#20250;&#36820;&#22238;&#19968;&#20010;&#20351;&#29992;&#21517;&#23383;&#20316;&#20026;key&#26469;&#26144;&#23556;&#27599;&#19968;&#20010;&#34987;&#22768;&#26126;&#30340;&#36755;&#20986;&#21442;&#25968;&#30340;&#23454;&#20307;&#30340;Map&#12290;</p><pre class="programlisting">import java.sql.Types;
import java.util.HashMap;
import java.util.Iterator;
import java.util.Map;

import javax.sql.DataSource;

import org.springframework.jdbc.core.SqlOutParameter;
import org.springframework.jdbc.datasource.*;
import org.springframework.jdbc.object.StoredProcedure;

public class TestSP {

    public static void main(String[] args)  {
        
        System.out.println("DB TestSP!");
        TestSP t = new TestSP();
        t.test();
        System.out.println("Done!");
        
    }
    
    void test() {
        DriverManagerDataSource ds = new DriverManagerDataSource();
        ds.setDriverClassName("oracle.jdbc.driver.OracleDriver");
        ds.setUrl("jdbc:oracle:thin:@localhost:1521:mydb");
        ds.setUsername("scott");
        ds.setPassword("tiger");

        MyStoredProcedure sproc = new MyStoredProcedure(ds);
        Map res = sproc.execute();
        printMap(res);
                
    }

    private class MyStoredProcedure extends StoredProcedure {
        public static final String SQL = "sysdate";

        public MyStoredProcedure(DataSource ds) {
            setDataSource(ds);
            setFunction(true);
            setSql(SQL);
            declareParameter(new SqlOutParameter("date", Types.DATE));
            compile();
        }

        public Map execute() {
            Map out = execute(new HashMap());
            return out;
        }

    }

    private static void printMap(Map r) {
        Iterator i = r.entrySet().iterator();
        while (i.hasNext()) {
            System.out.println((String) i.next().toString());  
        }
    }
}</pre></div><div class="sect2" lang="zh_cn"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-SqlFunction"></a>10.4.5.&nbsp;SqlFunction</h3></div></div><div></div></div><p>SQL "function"&#23553;&#35013;&#36820;&#22238;&#21333;&#19968;&#34892;&#32467;&#26524;&#30340;&#26597;&#35810;&#12290;&#40664;&#35748;&#30340;&#24773;&#20917;&#36820;&#22238;&#19968;&#20010;int&#65292;&#24403;&#28982;&#25105;&#20204;&#21487;&#20197;&#37325;&#36733;&#23427;&#65292;
      &#36890;&#36807;&#39069;&#22806;&#36820;&#22238;&#21442;&#25968;&#24471;&#21040;&#20854;&#20182;&#31867;&#22411;&#12290;&#36825;&#21644;&#20351;&#29992;<tt class="literal">JdbcTemplate</tt>&#30340;
      <tt class="literal">queryForXxx</tt>&#26041;&#27861;&#24456;&#30456;&#20284;&#12290;&#20351;&#29992;<tt class="literal">SqlFunction</tt>&#30340;&#22909;&#22788;&#26159;
      &#19981;&#29992;&#24517;&#39035;&#22312;&#21518;&#21488;&#24314;&#31435;<tt class="literal">JdbcTemplate</tt>&#12290;</p><p>&#36825;&#20010;&#31867;&#30340;&#30446;&#30340;&#26159;&#35843;&#29992;SQL function&#65292;&#20351;&#29992;&#20687;"select user()"&#25110;&#32773;"select sysdate from dual"
      &#24471;&#21040;&#21333;&#19968;&#30340;&#32467;&#26524;&#12290;&#23427;&#19981;&#26159;&#29992;&#26469;&#35843;&#29992;&#22797;&#26434;&#30340;&#23384;&#20648;&#21151;&#33021;&#20063;&#19981;&#26159;&#29992;&#26469;&#20351;&#29992;<tt class="literal">CallableStatement</tt>
      &#26469;&#35843;&#29992;&#23384;&#20648;&#36807;&#31243;&#25110;&#32773;&#23384;&#20648;&#21151;&#33021;&#12290;&#23545;&#20110;&#36825;&#31867;&#30340;&#22788;&#29702;&#24212;&#24403;&#20351;&#29992;<tt class="literal">StoredProcedure</tt>&#25110;&#32773;<tt class="literal">SqlCall</tt>&#12290;</p><p>&#36825;&#26159;&#19968;&#20010;&#20855;&#20307;&#30340;&#31867;&#65292;&#23427;&#36890;&#24120;&#19981;&#38656;&#35201;&#23376;&#31867;&#21270;&#12290;&#20351;&#29992;&#36825;&#20010;&#21253;&#30340;&#20195;&#30721;&#21487;&#20197;&#36890;&#36807;&#22768;&#26126;SQL&#21644;&#21442;&#25968;&#21019;&#24314;&#36825;&#20010;&#31867;&#22411;&#30340;&#23545;&#35937;&#65292;
      &#28982;&#21518;&#33021;&#37325;&#22797;&#30340;&#20351;&#29992;run&#26041;&#27861;&#25191;&#34892;&#36825;&#20010;function&#12290;&#19979;&#38754;&#26159;&#19968;&#20010;&#24471;&#21040;&#19968;&#24352;&#34920;&#30340;&#34892;&#25968;&#30340;&#20363;&#23376;&#65306;</p><pre class="programlisting">    public int countRows() {
        SqlFunction sf = new SqlFunction(dataSource, "select count(*) from mytable");
        sf.compile();
        return sf.run();
    }</pre><p></p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="dao.html">&#19978;&#19968;&#39029;</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="index.html">&#19978;&#19968;&#32423;</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="orm.html">&#19979;&#19968;&#39029;</a></td></tr><tr><td width="40%" align="left" valign="top">&#31532;&nbsp;9&nbsp;&#31456;&nbsp;DAO&#25903;&#25345;&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">&#36215;&#22987;&#39029;</a></td><td width="40%" align="right" valign="top">&nbsp;&#31532;&nbsp;11&nbsp;&#31456;&nbsp;&#20351;&#29992;ORM&#24037;&#20855;&#36827;&#34892;&#25968;&#25454;&#35775;&#38382; </td></tr></table></div></body></html>