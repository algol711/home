<html>
<!-- Mirrored from www.redsaga.com/spring_ref/2.0RC2/html/cci.html by HTTrack Website Copier/3.x [XR&CO'2005], Tue, 17 Oct 2006 16:56:40 GMT -->
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;21.&nbsp;JCA CCI</title><link rel="stylesheet" href="http://www.redsaga.com/spring_ref/2.0RC2/styles/html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.60.1"><link rel="home" href="index.html" title="Spring Framework &#24320;&#21457;&#21442;&#32771;&#25163;&#20876;"><link rel="up" href="pt04.html" title="Part&nbsp;IV.&nbsp;&#25972;&#21512;"><link rel="previous" href="jmx.html" title="Chapter&nbsp;20.&nbsp;JMX"><link rel="next" href="mail.html" title="Chapter&nbsp;22.&nbsp;Spring&#37038;&#20214;&#25277;&#35937;&#23618;"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div xmlns="http://www.w3.org/TR/xhtml1/transitional" style="background-color:#31430f;border:none;height:110px;border:1px solid black;"><a style="border:none;background: url();" href="http://www.springframework.org/" title="The Spring Framework"><img style="border:none;" src="images/banner4.jpg"></a><a style="border:none;background: url();" href="http://www.interface21.com/" title="Interface21 - Spring from the Source"><img style="border:none;position:absolute;right:32px;" src="images/bannerR.gif"></a></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="cci"></a>Chapter&nbsp;21.&nbsp;JCA CCI</h2></div></div><div></div></div>
   <table align="center">
<tr>
<td>
<script type="text/javascript"><!--
google_ad_client = "pub-2627642070897863";
google_ad_width = 336;
google_ad_height = 280;
google_ad_format = "336x280_as";
google_ad_type = "text_image";
//2006-10-13: com_336x280
google_ad_channel = "7652836435";
google_color_border = "FFFFFF";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_text = "000000";
google_color_url = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
<td>
<script type="text/javascript"><!--
google_ad_client = "pub-2627642070897863";
google_ad_width = 336;
google_ad_height = 280;
google_ad_format = "336x280_as";
google_ad_type = "text_image";
//2006-10-13: com_336x280
google_ad_channel = "7652836435";
google_color_border = "FFFFFF";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_text = "000000";
google_color_url = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</tr>
</table>
   <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e24683"></a>21.1.&nbsp;&#20171;&#32461;</h2></div></div><div></div></div><p>J2EE&#25552;&#20379;JCA(Java Connector Architecture)&#35268;&#33539;&#26469;&#26631;&#20934;&#21270;&#23545;EIS&#30340;&#35775;&#38382;&#12290;&#36825;&#20010;&#35268;&#33539;&#34987;&#20998;&#20026;&#20960;&#20010;&#19981;&#21516;&#30340;&#37096;&#20998;&#65306;</p><div class="itemizedlist"><ul type="disc"><li><p>SPI(Service provider interfaces)&#26159;&#36830;&#25509;&#22120;&#25552;&#20379;&#32773;&#65288;connector provider&#65289;&#24517;&#39035;&#23454;&#29616;&#30340;&#25509;&#21475;&#12290;
	&#36825;&#20123;&#25509;&#21475;&#32452;&#25104;&#20102;&#19968;&#20010;&#33021;&#34987;&#37096;&#32626;&#22312;J2EE&#24212;&#29992;&#26381;&#21153;&#22120;&#19978;&#30340;&#36164;&#28304;&#36866;&#37197;&#22120;&#65288;resource adapter&#65289;&#12290;
	&#22312;&#36825;&#31181;&#24773;&#20917;&#19979;&#65292;&#30001;&#26381;&#21153;&#22120;&#26469;&#31649;&#29702;&#36830;&#25509;&#27744;&#65288;connection pooling&#65289;&#12289;&#20107;&#21153;&#21644;&#23433;&#20840;&#65288;&#25176;&#31649;&#27169;&#24335;&#65288;managed mode&#65289;&#65289;&#12290;
	&#24212;&#29992;&#26381;&#21153;&#22120;&#36824;&#36127;&#36131;&#31649;&#29702;&#23458;&#25143;&#31471;&#25152;&#25317;&#26377;&#30340;&#37197;&#32622;&#12290;&#19968;&#20010;&#36830;&#25509;&#22120;&#65288;connector&#65289;&#21516;&#26679;&#33021;&#22312;&#33073;&#31163;&#24212;&#29992;&#26381;&#21153;&#22120;&#30340;&#24773;&#20917;&#19979;&#20351;&#29992;&#12290;&#22312;&#36825;&#31181;&#24773;&#20917;&#19979;&#65292;&#24212;&#29992;&#31243;&#24207;&#24517;&#39035;&#30452;&#25509;&#23545;&#23427;&#36827;&#34892;&#37197;&#32622;&#65288;&#38750;&#25176;&#31649;&#27169;&#24335;&#65288;non-managed mode&#65289;&#65289;&#12290; 
	</p></li><li><p> CCI (Common Client Interface)&#26159;&#24212;&#29992;&#31243;&#24207;&#29992;&#26469;&#19982;&#36830;&#25509;&#22120;&#20132;&#20114;&#24182;&#19982;EIS&#36890;&#20449;&#30340;&#25509;&#21475;&#12290;&#21516;&#26679;&#36824;&#20026;&#26412;&#22320;&#20107;&#21153;&#21010;&#30028;&#25552;&#20379;&#20102;API&#12290;</p></li></ul></div><p>Spring&#23545;CCI&#30340;&#25903;&#25345;&#65292;&#30446;&#30340;&#26159;&#20026;&#20102;&#25552;&#20379;&#20197;Spring&#20856;&#22411;&#30340;&#26041;&#24335;&#26469;&#35775;&#38382;CCI&#36830;&#25509;&#22120;&#30340;&#31867;&#65292;&#24182;&#26377;&#25928;&#22320;&#20351;&#29992;Spring&#30340;&#36890;&#29992;&#36164;&#28304;&#21644;&#20107;&#21153;&#31649;&#29702;&#26426;&#21046;&#12290;</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="http://www.redsaga.com/spring_ref/2.0RC2/images/admons/note.png"></td><th align="left">Note</th></tr><tr><td colspan="2" align="left" valign="top"><p>&#36830;&#25509;&#22120;&#30340;&#23458;&#25143;&#31471;&#19981;&#24517;&#24635;&#26159;&#20351;&#29992;CCI&#12290; &#26576;&#20123;&#36830;&#25509;&#22120;&#26292;&#38706;&#23427;&#20204;&#33258;&#24049;&#30340;API&#26469;&#25552;&#20379;JCA&#36164;&#28304;&#36866;&#37197;&#22120;&#65288;resource adapter&#65289;&#20197;&#20415;&#20351;&#29992;J2EE&#23481;&#22120;&#25552;&#20379;&#30340;&#26576;&#20123;&#31995;&#32479;&#22865;&#32422;&#65288;system contracts&#65289;&#65288;&#36830;&#25509;&#27744;&#65288;connection pooling&#65289;&#65292;&#20840;&#23616;&#20107;&#21153;&#65288;global transactions&#65289;&#65292;&#23433;&#20840;&#65288;security&#65289;&#65289;&#12290;Spring&#24182;&#27809;&#26377;&#20026;&#36825;&#31867;&#36830;&#25509;&#22120;&#29305;&#26377;&#65288;connector-specific&#65289;&#30340;API&#25552;&#20379;&#29305;&#27530;&#30340;&#25903;&#25345;&#12290; </p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e24700"></a>21.2.&nbsp;&#37197;&#32622;CCI</h2></div></div><div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e24703"></a>21.2.1.&nbsp;&#36830;&#25509;&#22120;&#37197;&#32622;</h3></div></div><div></div></div><p>&#20351;&#29992;JCA CCI&#30340;&#22522;&#30784;&#36164;&#28304;&#26159;<tt class="interfacename">ConnectionFactory</tt>&#25509;&#21475;&#12290;
      &#34987;&#20351;&#29992;&#30340;&#36830;&#25509;&#22120;&#24517;&#39035;&#25552;&#20379;&#36825;&#20010;&#25509;&#21475;&#30340;&#19968;&#20010;&#23454;&#29616;&#12290; </p><p>
      &#20026;&#20102;&#20351;&#29992;&#20320;&#30340;&#36830;&#25509;&#22120;&#65292;&#20320;&#21487;&#20197;&#25226;&#23427;&#37096;&#32626;&#21040;&#20320;&#30340;&#24212;&#29992;&#26381;&#21153;&#22120;&#65292;&#24182;&#20174;&#26381;&#21153;&#22120;&#30340;JNDI&#29615;&#22659;&#65288;&#25176;&#31649;&#27169;&#24335;&#65289;&#21462;&#22238;<tt class="interfacename">ConnectionFactory</tt>&#12290;
      &#36830;&#25509;&#22120;&#24517;&#39035;&#25171;&#21253;&#20026;&#19968;&#20010;RAR&#25991;&#20214;(resource adapte archive)&#24182;&#21253;&#21547;&#19968;&#20010;&#37096;&#32626;&#25551;&#36848;&#31526;&#25991;&#20214;<tt class="filename">ra.xml</tt> &#12290;
      &#24403;&#20320;&#37096;&#32626;&#26102;&#38656;&#35201;&#25351;&#23450;&#36164;&#28304;&#30340;&#23454;&#38469;&#21517;&#23383;&#12290;&#22914;&#26524;&#24819;&#36890;&#36807;Spring&#35775;&#38382;&#23427;&#65292;&#21482;&#38656;&#35201;&#31616;&#21333;&#22320;&#20351;&#29992;Spring&#30340; <tt class="classname">JndiObjectFactoryBean</tt> 
      &#26469;&#36890;&#36807;JNDI&#21517;&#23383;&#33719;&#21462;&#24037;&#21378;&#12290; </p><p>
      &#20351;&#29992;&#36830;&#25509;&#22120;&#30340;&#21478;&#22806;&#19968;&#20010;&#26041;&#27861;&#26159;&#25226;&#23427;&#23884;&#20837;&#21040;&#20320;&#30340;&#24212;&#29992;&#31243;&#24207;&#20013;(&#38750;&#25176;&#31649;&#27169;&#24335;&#65288;non-managed mode&#65289;)&#65292;&#32780;&#19981;&#29992;&#22312;&#24212;&#29992;&#26381;&#21153;&#22120;&#20013;&#37096;&#32626;&#24182;&#37197;&#32622;&#23427;&#12290;
      Spring&#36890;&#36807;&#24050;&#25552;&#20379;&#30340;<tt class="literal">FactoryBean</tt> (<tt class="classname">LocalConnectionFactoryBean</tt>)&#26469;&#23558;&#36830;&#25509;&#22120;&#37197;&#32622;&#20026;&#19968;&#20010;bean&#12290;
      &#22312;&#36825;&#31181;&#26041;&#24335;&#20013;&#65292;&#20320;&#21482;&#38656;&#35201;&#25226;&#36830;&#25509;&#22120;&#31867;&#24211;&#25918;&#20837;classpath&#30446;&#24405;&#19979;(&#19981;&#38656;&#35201;RAR&#25991;&#20214;&#21644;<tt class="filename">ra.xml</tt> &#25551;&#36848;&#31526;)&#12290;
      &#22914;&#26524;&#26377;&#24517;&#35201;&#30340;&#35805;&#65292;&#20320;&#21487;&#20197;&#35299;&#21387;&#36830;&#25509;&#22120;&#30340;RAR&#25991;&#20214;&#26469;&#24471;&#21040;&#37027;&#20010;&#31867;&#24211;&#12290;</p><p>
      &#19968;&#26086;&#20320;&#35775;&#38382; <tt class="interfacename">ConnectionFactory</tt> &#23454;&#20363;&#65292;
      &#20320;&#23601;&#21487;&#20197;&#27880;&#20837;&#21040;&#20320;&#30340;&#32452;&#20214;&#20013;&#12290;&#36825;&#20123;&#32452;&#20214;&#26082;&#21487;&#20197;&#29992;&#31616;&#21333;&#30340;CCI API&#26469;&#32534;&#30721;&#20063;&#21487;&#20197;&#21033;&#29992;Spring&#25552;&#20379;&#30340;CCI&#35775;&#38382;&#31867;&#65288;&#27604;&#22914;&#65292; <tt class="classname">CciTemplate</tt>&#65289;&#12290; 
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="http://www.redsaga.com/spring_ref/2.0RC2/images/admons/note.png"></td><th align="left">Note</th></tr><tr><td colspan="2" align="left" valign="top"><p>
		&#24403;&#22312;&#38750;&#25176;&#31649;&#27169;&#24335;&#65288;non-managed mode&#65289;&#19979;&#20351;&#29992;&#36830;&#25509;&#22120;&#26102;&#65292;&#20320;&#23558;&#19981;&#33021;&#22815;&#20351;&#29992;&#20840;&#23616;&#20107;&#21153;&#65292;
		&#22240;&#20026;&#35813;&#36164;&#28304;&#20174;&#19981;&#20250;&#34987;&#21152;&#20837;&#25110;&#21024;&#38500;&#21040;&#24403;&#21069;&#32447;&#31243;&#30340;&#24403;&#21069;&#20840;&#23616;&#20107;&#21153;&#20013;&#12290;&#35813;&#36164;&#28304;&#26681;&#26412;&#19981;&#30693;&#36947;&#20219;&#20309;&#21487;&#33021;&#27491;&#22312;&#36816;&#34892;&#30340;&#20840;&#23616;&#24615;&#30340;J2EE&#20107;&#21153;&#12290; 
		</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e24744"></a>21.2.2.&nbsp;&#22312;Spring&#20013;&#37197;&#32622;<tt class="interfacename">ConnectionFactory</tt></h3></div></div><div></div></div><p>
      &#20026;&#20102;&#21019;&#24314;&#21040; EIS &#30340;&#36830;&#25509;&#65292;&#22914;&#26524;&#22788;&#20110;&#25176;&#31649;&#27169;&#24335;&#65288;managed mode&#65289;&#65292;&#20320;&#38656;&#35201;&#20174;&#24212;&#29992;&#26381;&#21153;&#22120;&#33719;&#21462;&#19968;&#20010; <tt class="interfacename">ConnectionFactory</tt> &#65292;
      &#25110;&#32773;&#24403;&#20320;&#22312;&#38750;&#25176;&#31649;&#27169;&#24335;&#65288;non-managed mode&#65289;&#26102;&#30452;&#25509;&#20174;Spring&#21435;&#33719;&#21462;&#12290; </p><p>&#22312;&#25176;&#31649;&#27169;&#24335;&#65288;managed mode&#65289;&#19979;&#65292;&#20320;&#21487;&#20197;&#20174;JNDI&#35775;&#38382;<tt class="interfacename">ConnectionFactory</tt>&#65292;&#23427;&#30340;&#23646;&#24615;&#23558;&#34987;&#37197;&#32622;&#22312;&#24212;&#29992;&#26381;&#21153;&#22120;&#20013;&#12290;</p><pre class="programlisting">&lt;bean id="eciConnectionFactory" class="org.springframework.jndi.JndiObjectFactoryBean"&gt;
  &lt;property name="jndiName" value="eis/cicseci"/&gt;
&lt;/bean&gt;</pre><p>
	  &#22312;&#38750;&#25176;&#31649;&#27169;&#24335;&#65288;non-managed mode&#65289;&#19979;&#65292;&#20320;&#24517;&#39035;&#22312;Spring&#37197;&#32622;&#20013;&#23558;&#20320;&#35201;&#29992;&#30340; <tt class="interfacename">ConnectionFactory</tt> &#37197;&#32622;&#20026;&#19968;&#20010;JavaBean&#12290;
	<tt class="classname">LocalConnectionFactoryBean</tt> &#31867;&#25552;&#20379;&#36825;&#31181;&#37197;&#32622;&#39118;&#26684;&#65292;&#25226;<tt class="classname">ManagedConnectionFactory</tt>&#20256;&#20837;&#21040;&#20320;&#30340;&#36830;&#25509;&#22120;&#30340;&#23454;&#29616;&#20013;&#65292;
	&#26292;&#38706;&#20026;&#24212;&#29992;&#32423;&#30340;CCI <tt class="interfacename">ConnectionFactory</tt>&#12290; 
	  </p><pre class="programlisting">&lt;bean id="eciManagedConnectionFactory" class="com.ibm.connector2.cics.ECIManagedConnectionFactory"&gt;
  &lt;property name="serverName" value="TXSERIES"/&gt;
  &lt;property name="connectionURL" value="tcp://localhost/"/&gt;
  &lt;property name="portNumber" value="2006"/&gt;
&lt;/bean&gt;

&lt;bean id="eciConnectionFactory" class="org.springframework.jca.support.LocalConnectionFactoryBean"&gt;
  &lt;property name="managedConnectionFactory" ref="eciManagedConnectionFactory"/&gt;
&lt;/bean&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="http://www.redsaga.com/spring_ref/2.0RC2/images/admons/note.png"></td><th align="left">Note</th></tr><tr><td colspan="2" align="left" valign="top"><p>
	&#20320;&#19981;&#33021;&#30452;&#25509;&#23454;&#20363;&#21270;&#19968;&#20010;&#25351;&#23450;&#30340; <tt class="interfacename">ConnectionFactory</tt>&#25509;&#21475;&#12290;
	&#20320;&#38656;&#35201;&#20026;&#20320;&#30340;&#36830;&#25509;&#22120;&#23454;&#29616;&#30456;&#24212;&#30340; <tt class="classname">ManagedConnectionFactory</tt> &#25509;&#21475;&#65292;&#36825;&#20010;&#25509;&#21475;&#26159;JCA SPI&#35268;&#33539;&#30340;&#19968;&#37096;&#20998;&#12290;
	</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e24786"></a>21.2.3.&nbsp;&#37197;&#32622;CCI&#36830;&#25509;</h3></div></div><div></div></div><p>
      JCA CCI&#20801;&#35768;&#24320;&#21457;&#32773;&#20351;&#29992;&#33258;&#24049;&#30340;&#36830;&#25509;&#22120;&#30340; <tt class="interfacename">ConnectionSpec</tt>&#25509;&#21475;&#20855;&#20307;&#23454;&#29616;&#26469;&#37197;&#32622;&#21040; EIS &#30340;&#36830;&#25509;&#12290;
      &#20026;&#20102;&#37197;&#32622;&#35813;&#36830;&#25509;&#30340;&#23646;&#24615;&#65292;&#20320;&#38656;&#35201;&#29992;&#19968;&#20010;&#25351;&#23450;&#30340;<tt class="classname">ConnectionSpecConnectionFactoryAdapter</tt>&#31867;&#22411;&#30340;&#36866;&#37197;&#22120;&#26469;&#23553;&#35013;&#30446;&#26631;&#36830;&#25509;&#24037;&#21378;&#12290;
      &#22240;&#27492;&#65292;&#29305;&#23450;&#30340; <tt class="interfacename">ConnectionSpec</tt> &#25509;&#21475;&#21487;&#20197;&#29992; <tt class="literal">connectionSpec</tt> &#23646;&#24615;&#26469;&#35774;&#32622;&#65288;&#20316;&#20026;&#19968;&#20010;&#20869;&#37096;bean&#65289;&#12290; 
     </p><p>&#36825;&#20010;&#23646;&#24615;&#19981;&#26159;&#24517;&#38656;&#30340;&#65292;&#22240;&#20026;CCI  <tt class="interfacename">ConnectionFactory</tt> &#25509;&#21475;&#23450;&#20041;&#20102;&#20004;&#20010;&#26041;&#27861;&#26469;&#33719;&#21462; CCI &#36830;&#25509;&#12290;
      <tt class="interfacename">ConnectionSpec</tt> &#30340;&#19968;&#20123;&#23646;&#24615;&#24120;&#24120;&#34987;&#37197;&#32622;&#22312;&#24212;&#29992;&#26381;&#21153;&#22120;&#20013;&#65288;&#25176;&#31649;&#27169;&#24335;&#65288;managed mode&#65289;&#65289;&#25110;&#30456;&#20851;&#30340;&#26412;&#22320; <tt class="classname">ManagedConnectionFactory</tt> &#23454;&#29616;&#12290;
     </p><pre class="programlisting">public interface ConnectionFactory implements Serializable, Referenceable {
  ...
  Connection getConnection() throws ResourceException;
  Connection getConnection(ConnectionSpec connectionSpec) throws ResourceException;
  ...
}</pre><p>
      Spring&#25552;&#20379;&#20102;<tt class="classname">ConnectionSpecConnectionFactoryAdapter</tt>&#36866;&#37197;&#22120;&#65292;
	  &#20801;&#35768;&#20320;&#25351;&#23450;&#19968;&#20010;<tt class="interfacename">ConnectionSpec</tt>&#25509;&#21475;&#30340;&#23454;&#20363;, &#35813;&#23454;&#20363;&#21487;&#20197;&#34987;&#32473;&#23450;<tt class="interfacename">ConnectionFactory</tt>&#30340;&#25152;&#26377;&#25805;&#20316;&#20351;&#29992;&#12290;
      &#22914;&#26524;&#25351;&#23450;&#20102;&#36866;&#37197;&#22120;&#30340; <tt class="literal">connectionSpec</tt> &#23646;&#24615;&#65292;&#36866;&#37197;&#22120;&#20351;&#29992;&#27809;&#26377;&#21442;&#25968;&#30340; <tt class="literal">getConnection</tt> &#26041;&#27861;&#65292;
      &#32780;&#19981;&#26159;&#26377; <tt class="interfacename">ConnectionSpec</tt> &#21442;&#25968;&#30340;&#26041;&#27861;&#12290;</p><pre class="programlisting">&lt;bean id="managedConnectionFactory"
    class="com.sun.connector.cciblackbox.CciLocalTxManagedConnectionFactory"&gt;
  &lt;property name="connectionURL" value="jdbc:hsqldb:hsql://localhost:9001"/&gt;
  &lt;property name="driverName" value="org.hsqldb.jdbcDriver"/&gt;
&lt;/bean&gt;

&lt;bean id="targetConnectionFactory"
    class="org.springframework.jca.support.LocalConnectionFactoryBean"&gt;
  &lt;property name="managedConnectionFactory" ref="managedConnectionFactory"/&gt;
&lt;/bean&gt;

&lt;bean id="connectionFactory"
    class="org.springframework.jca.cci.connection.ConnectionSpecConnectionFactoryAdapter"&gt;
  &lt;property name="targetConnectionFactory" ref="targetConnectionFactory"/&gt;
  &lt;property name="connectionSpec"&gt;
    &lt;bean class="com.sun.connector.cciblackbox.CciConnectionSpec"&gt;
      &lt;property name="user" value="sa"/&gt;
      &lt;property name="password" value=""/&gt;
    &lt;/bean&gt;
  &lt;/property&gt;
&lt;/bean&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e24838"></a>21.2.4.&nbsp;&#20351;&#29992;&#19968;&#20010; CCI &#21333;&#36830;&#25509;</h3></div></div><div></div></div><p>
      &#22914;&#26524;&#20320;&#24819;&#20351;&#29992;&#19968;&#20010; CCI &#21333;&#36830;&#25509;&#65292;Spring&#25552;&#20379;&#19968;&#20010;&#39069;&#22806;&#30340; <tt class="interfacename">ConnectionFactory</tt> &#36866;&#37197;&#22120;&#26469;&#31649;&#29702;&#23427;&#12290;
      <tt class="classname">SingleConnectionFactory</tt> &#36866;&#37197;&#22120;&#31867;&#23558;&#24310;&#36831;&#25171;&#24320;&#19968;&#20010;&#21333;&#29420;&#30340;&#36830;&#25509;&#24182;&#22312;&#24212;&#29992;&#31243;&#24207;&#38144;&#27585;&#36825;&#20010;bean&#30340;&#26102;&#20505;&#20851;&#38381;&#23427;&#12290;
      &#36825;&#20010;&#31867;&#23558;&#26292;&#38706;&#20986;&#29305;&#27530;<tt class="interfacename">Connection</tt>&#25509;&#21475;&#30340;&#30456;&#24212;&#30340;&#20195;&#29702;&#65292;&#24182;&#20849;&#20139;&#21516;&#19968;&#20010;&#24213;&#23618;&#29289;&#29702;&#36830;&#25509;&#12290;
      </p><pre class="programlisting">&lt;bean id="eciManagedConnectionFactory"
    class="com.ibm.connector2.cics.ECIManagedConnectionFactory"&gt;
  &lt;property name="serverName" value="TEST"/&gt;
  &lt;property name="connectionURL" value="tcp://localhost/"/&gt;
  &lt;property name="portNumber" value="2006"/&gt;
&lt;/bean&gt;

&lt;bean id="targetEciConnectionFactory"
    class="org.springframework.jca.support.LocalConnectionFactoryBean"&gt;
  &lt;property name="managedConnectionFactory" ref="eciManagedConnectionFactory"/&gt;
&lt;/bean&gt;

&lt;bean id="eciConnectionFactory"
    class="org.springframework.jca.cci.connection.SingleConnectionFactory"&gt;
  &lt;property name="targetConnectionFactory" ref="targetEciConnectionFactory"/&gt;
&lt;/bean&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="http://www.redsaga.com/spring_ref/2.0RC2/images/admons/note.png"></td><th align="left">Note</th></tr><tr><td colspan="2" align="left" valign="top"><p>
	<tt class="interfacename">ConnectionFactory</tt>&#36866;&#37197;&#22120;&#19981;&#33021;&#30452;&#25509;&#34987;&#37197;&#32622;&#20026;&#24102;&#26377;<tt class="interfacename">ConnectionSpec</tt>&#23646;&#24615;.
	&#22914;&#26524;&#20320;&#38656;&#35201;&#21547;&#26377;&#29305;&#23450;<tt class="interfacename">ConnectionSpec</tt>&#30340;&#21333;&#19968;&#36830;&#25509;&#65292;&#37027;&#20040;&#21487;&#20197;&#24448;<tt class="classname">SingleConnectionFactory</tt>&#27880;&#20837;&#19968;&#20010;&#24102;&#26377;<tt class="interfacename">ConnectionSpec</tt>&#30340;<tt class="classname">ConnectionSpecConnectionFactoryAdapter</tt>&#36866;&#37197;&#22120;&#12290;
        </p></td></tr></table></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e24875"></a>21.3.&nbsp;&#20351;&#29992;Spring&#30340; CCI&#35775;&#38382;&#25903;&#25345;</h2></div></div><div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cci-record-creator"></a>21.3.1.&nbsp;&#35760;&#24405;&#36716;&#25442;</h3></div></div><div></div></div><p>    
      &#23545;JCA CCI&#25903;&#25345;&#30340;&#19968;&#20010;&#30446;&#26631;&#26159;&#25552;&#20379;&#26041;&#20415;&#30340;&#26426;&#21046;&#26469;&#25805;&#20316;CCI&#35760;&#24405;&#12290;
      &#24320;&#21457;&#20154;&#21592;&#21487;&#20197;&#36890;&#36807;&#20351;&#29992;Spring <tt class="classname">CciTemplate</tt> &#26469;&#25351;&#23450;&#21019;&#24314;&#35760;&#24405;&#24182;&#20174;&#35760;&#24405;&#20013;&#25552;&#21462;&#25968;&#25454;&#30340;&#31574;&#30053;&#12290;
      &#22914;&#26524;&#20320;&#19981;&#24819;&#22312;&#20320;&#30340;&#24212;&#29992;&#31243;&#24207;&#20013;&#30452;&#25509;&#25805;&#20316;&#35760;&#24405;&#65292;&#20320;&#21487;&#20197;&#20351;&#29992;&#19979;&#38754;&#30340;&#25509;&#21475;&#26469;&#37197;&#32622;&#29992;&#20110;&#36755;&#20837;&#36755;&#20986;&#35760;&#24405;&#30340;&#31574;&#30053;&#12290; 
      </p><p>  
        &#20026;&#21019;&#24314;&#19968;&#20010;&#36755;&#20837;<tt class="interfacename">Record</tt>&#65292;&#24320;&#21457;&#20154;&#21592;&#21487;&#20197;&#20351;&#29992;  <tt class="interfacename">RecordCreator</tt> &#25509;&#21475;&#30340;&#19968;&#20010;&#29305;&#23450;&#23454;&#29616;&#12290; 
      </p><pre class="programlisting">public interface RecordCreator {

  Record createRecord(RecordFactory recordFactory) throws ResourceException, DataAccessException;
}</pre><p>  
      &#27491;&#22914;&#20320;&#25152;&#30475;&#21040;&#30340;&#19968;&#26679;&#65292; <tt class="literal">createRecord(..)</tt>&#26041;&#27861;&#25509;&#25910;&#19968;&#20010; <tt class="interfacename">RecordFactory</tt> &#23454;&#20363;&#20316;&#20026;&#21442;&#25968;&#65292;&#35813;&#21442;&#25968;&#23545;&#24212;&#20110;&#25152;&#20351;&#29992;&#30340; <tt class="interfacename">ConnectionFactory</tt> &#30340;<tt class="interfacename">RecordFactory</tt>&#25509;&#21475;&#12290;
      &#23427;&#33021;&#34987;&#29992;&#20110;&#21019;&#24314; <tt class="interfacename">IndexedRecord</tt> &#25110;&#32773; <tt class="interfacename">MappedRecord</tt>  &#30340;&#23454;&#20363;&#12290;
      &#19979;&#38754;&#30340;&#20363;&#23376;&#23637;&#31034;&#20102;&#22914;&#20309;&#20351;&#29992; <tt class="interfacename">RecordFactory</tt> &#25509;&#21475;&#21644;&#32034;&#24341;&#65288;indexed&#65289;/&#26144;&#23556;&#65288;mapped&#65289;&#35760;&#24405;&#12290; 
      </p><pre class="programlisting">public class MyRecordCreator implements RecordCreator {

  public Record createRecord(RecordFactory recordFactory) throws ResourceException {
    IndexedRecord input = recordFactory.createIndexedRecord("input");
    input.add(new Integer(id));
    return input;
  }
}</pre><p>
      &#19968;&#20010;&#36755;&#20986;<tt class="interfacename">Record</tt>&#25509;&#21475;&#33021;&#34987;&#29992;&#20110;&#20174;EIS&#25509;&#25910;&#25968;&#25454;&#12290;
      &#22240;&#27492;&#65292;&#19968;&#20010; <tt class="interfacename">RecordExtractor</tt> &#25509;&#21475;&#30340;&#29305;&#23450;&#23454;&#29616;&#21487;&#20197;&#34987;&#20256;&#32473;Spring&#30340; <tt class="classname">CciTemplate</tt> &#65292;
      &#29992;&#26469;&#20174;&#36755;&#20986;<tt class="interfacename">Record</tt>&#25509;&#21475;&#20013;&#25552;&#21462;&#25968;&#25454;&#12290;
      </p><pre class="programlisting">public interface RecordExtractor {

  Object extractData(Record record) throws ResourceException, SQLException, DataAccessException;
}</pre><p>&#19979;&#38754;&#30340;&#20363;&#23376;&#23637;&#31034;&#20102;&#22914;&#20309;&#20351;&#29992; <tt class="interfacename">RecordExtractor</tt> &#25509;&#21475;&#12290;</p><pre class="programlisting">public class MyRecordExtractor implements RecordExtractor {

  public Object extractData(Record record) throws ResourceException {
    CommAreaRecord commAreaRecord = (CommAreaRecord) record;
    String str = new String(commAreaRecord.toByteArray());
    String field1 = string.substring(0,6);
    String field2 = string.substring(6,1);
    return new OutputObject(Long.parseLong(field1), field2);
  }
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e24944"></a>21.3.2.&nbsp;<tt class="classname">CciTemplate</tt> &#31867;</h3></div></div><div></div></div><p>
      <tt class="classname">CciTemplate</tt> &#31867;&#26159; CCI &#26680;&#24515;&#25903;&#25345;&#21253;(<tt class="literal">org.springframework.jca.cci.core</tt>)&#20013;&#30340;&#20013;&#24515;&#31867;&#12290;
      &#23427;&#31616;&#21270;&#20102;CCI&#30340;&#20351;&#29992;&#65292;&#22240;&#20026;&#23427;&#20250;&#22788;&#29702;&#36164;&#28304;&#30340;&#21019;&#24314;&#21644;&#37322;&#25918;&#12290;&#36825;&#26377;&#21161;&#20110;&#36991;&#20813;&#24120;&#35265;&#30340;&#38169;&#35823;&#65292;&#27604;&#22914;&#24635;&#26159;&#24536;&#35760;&#20851;&#38381;&#36830;&#25509;&#12290;
      &#23427;&#20851;&#27880;&#36830;&#25509;&#21644;&#20132;&#20114;&#23545;&#35937;&#30340;&#29983;&#21629;&#21608;&#26399;&#65292;&#20174;&#32780;&#20351;&#24212;&#29992;&#31243;&#24207;&#30340;&#20195;&#30721;&#21487;&#20197;&#19987;&#27880;&#20110;&#22788;&#29702;&#20174;&#24212;&#29992;&#25968;&#25454;&#20013;&#29983;&#25104;&#36755;&#20837;&#35760;&#24405;&#21644;&#20174;&#36755;&#20986;&#35760;&#24405;&#20013;&#25552;&#21462;&#24212;&#29992;&#25968;&#25454;&#12290; </p><p>JCA CCI&#35268;&#33539;&#23450;&#20041;&#20102;&#20004;&#20010;&#19981;&#21516;&#30340;&#26041;&#27861;&#26469;&#22312;EIS&#19978;&#35843;&#29992;&#25805;&#20316;&#12290;CCI <tt class="interfacename">Interaction</tt> &#25509;&#21475;&#25552;&#20379;&#20004;&#20010; <tt class="literal">execute</tt>  &#26041;&#27861;&#30340;&#31614;&#21517;&#65306;</p><pre class="programlisting">public interface javax.resource.cci.Interaction {
  ...
  boolean execute(InteractionSpec spec, Record input, Record output) throws ResourceException;

  Record execute(InteractionSpec spec, Record input) throws ResourceException;
  ...
}</pre><p>&#20381;&#36182;&#20110;&#27169;&#26495;&#26041;&#27861;&#30340;&#35843;&#29992;&#65292;<tt class="classname">CciTemplate</tt> &#31867;&#21487;&#20197;&#30693;&#36947; interaction&#19978;&#30340;&#21738;&#20010; <tt class="literal">execute</tt>  &#26041;&#27861;&#34987;&#35843;&#29992;&#12290;
      &#22312;&#20219;&#20309;&#24773;&#20917;&#19979;&#65292;&#37117;&#24517;&#39035;&#26377;&#19968;&#20010;&#27491;&#30830;&#21021;&#22987;&#21270;&#36807;&#30340; <tt class="interfacename">InteractionSpec</tt> &#25509;&#21475;&#23454;&#20363;&#12290; </p><p><tt class="literal">CciTemplate.execute(..)</tt>&#21487;&#20197;&#22312;&#20197;&#19979;&#20004;&#31181;&#26041;&#24335;&#19979;&#20351;&#29992;&#65306;</p><div class="itemizedlist"><ul type="disc"><li><p>&#22312;&#25552;&#20379;&#30452;&#25509;&#30340;<tt class="interfacename">Record</tt> &#21442;&#25968;&#30340;&#24773;&#20917;&#19979;&#65292;&#20320;&#20165;&#20165;&#38656;&#35201;&#31616;&#21333;&#30340;&#20256;&#36882;&#36755;&#20837;&#35760;&#24405;&#32473; CCI &#65292;
	  &#32780;&#36820;&#22238;&#30340;&#23545;&#35937;&#23601;&#26159;&#23545;&#24212;&#30340; CCI &#36755;&#20986;&#35760;&#24405;&#12290;</p></li><li><p>  
          &#22312;&#25552;&#20379;&#20351;&#29992;&#35760;&#24405;&#26144;&#23556;&#30340;&#24212;&#29992;&#23545;&#35937;&#30340;&#24773;&#20917;&#19979;&#65292;&#20320;&#38656;&#35201;&#25552;&#20379;&#30456;&#24212;&#30340; <tt class="interfacename">RecordCreator</tt> &#21644; <tt class="interfacename">RecordExtractor</tt> &#23454;&#20363;&#12290;</p></li></ul></div><p>&#31532;&#19968;&#31181;&#26041;&#27861;&#23558;&#20351;&#29992;&#19979;&#38754;&#30340;&#27169;&#26495;&#26041;&#27861;&#12290;&#36825;&#20123;&#27169;&#26495;&#26041;&#27861;&#23558;&#30452;&#25509;&#23545;&#24212;&#21040; <tt class="interfacename">Interaction</tt> &#25509;&#21475;&#12290; 
        </p><pre class="programlisting">public class CciTemplate implements CciOperations {
  ...
  public Record execute(InteractionSpec spec, Record inputRecord)
      throws DataAccessException { ... }

  public void execute(InteractionSpec spec, Record inputRecord, Record outputRecord)
      throws DataAccessException { ... }
  ...
}</pre><p>&#31532;&#20108;&#31181;&#26041;&#27861;&#38656;&#35201;&#25105;&#20204;&#20197;&#21442;&#25968;&#30340;&#26041;&#24335;&#25351;&#23450;&#21019;&#24314;&#35760;&#24405;&#21644;&#35760;&#24405;&#25552;&#21462;&#30340;&#31574;&#30053;&#12290;
	      &#20351;&#29992;&#21069;&#38754;&#35760;&#24405;&#36716;&#21270;&#19968;&#33410;&#20013;&#25551;&#36848;&#30340;&#25509;&#21475;&#12290;&#23545;&#24212;&#30340; <tt class="classname">CciTemplate</tt>  &#26041;&#27861;&#22914;&#19979;&#65306; 
	</p><pre class="programlisting">public class CciTemplate implements CciOperations {
  ...
  public Record execute(InteractionSpec spec, RecordCreator inputCreator)
      throws DataAccessException { ... }

  public Object execute(InteractionSpec spec, Record inputRecord, RecordExtractor outputExtractor)
      throws DataAccessException { ... }

  public Object execute(InteractionSpec spec, RecordCreator creator, RecordExtractor extractor)
      throws DataAccessException { ... }
  ...
}</pre><p>
      &#38500;&#38750;&#22312;&#27169;&#26495;&#19978;&#35774;&#32622; <tt class="literal">outputRecordCreator</tt> &#23646;&#24615;(&#21442;&#35265;&#19979;&#19968;&#37096;&#20998;)&#65292;
      &#19981;&#28982;&#27599;&#20010;&#26041;&#27861;&#23558;&#35843;&#29992;CCI <tt class="interfacename">Interaction</tt> &#20013;&#30456;&#24212;&#30340;&#21547;&#26377;&#20004;&#20010;&#21442;&#25968;&#65306; <tt class="interfacename">InteractionSpec</tt> &#21644;&#36755;&#20837; <tt class="interfacename">Record</tt>&#30340; <tt class="literal">execute</tt> &#26041;&#27861;&#65292;
      &#24182;&#25509;&#25910;&#19968;&#20010;&#36755;&#20986; <tt class="interfacename">Record</tt>&#20316;&#20026;&#36820;&#22238;&#20540;&#12290;
      </p><p> 
      &#36890;&#36807; <tt class="literal">createIndexRecord(..)</tt> &#21644; <tt class="literal">createMappedRecord(..)</tt> &#26041;&#27861;&#65292;<tt class="classname">CciTemplate</tt>&#22312;<tt class="interfacename">RecordCreator</tt>&#23454;&#29616;&#31867;&#22806;&#37096;&#20063;&#25552;&#20379;&#20102;&#21019;&#24314; <tt class="literal">IndexRecord</tt>  &#21644; <tt class="literal">MappedRecord</tt>&#12290;
      &#36824;&#21487;&#20197;&#29992;&#26469;&#22312;DAO&#23454;&#29616;&#20869;&#21019;&#24314;&#35760;&#24405;&#23454;&#20363;&#24182;&#20256;&#20837;&#21040;&#30456;&#24212;&#30340; <tt class="literal">CciTemplate.execute(..)</tt> &#26041;&#27861;&#12290; </p><pre class="programlisting">public class CciTemplate implements CciOperations {
  ...
  public IndexedRecord createIndexedRecord(String name) throws DataAccessException { ... }

  public MappedRecord createMappedRecord(String name) throws DataAccessException { ... }
  ...
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e25057"></a>21.3.3.&nbsp;DAO&#25903;&#25345;</h3></div></div><div></div></div><p>
      Spring&#30340; CCI &#25903;&#25345;&#20026; DAO &#25552;&#20379;&#20102;&#19968;&#20010;&#25277;&#35937;&#31867;&#65292;&#25903;&#25345; <tt class="interfacename">ConnectionFactory</tt> &#25110; <tt class="classname">CciTemplate</tt> &#23454;&#20363;&#30340;&#27880;&#20837;&#12290;
      &#36825;&#20010;&#31867;&#30340;&#21517;&#23383;&#26159; <tt class="classname">CciDaoSupport</tt>&#65306;&#23427;&#25552;&#20379;&#20102;&#31616;&#21333;&#30340; <tt class="literal">setConnectionFactory</tt> &#21644; <tt class="literal">setCciTemplate</tt> &#26041;&#27861;&#12290;
      &#22312;&#20869;&#37096;&#65292;&#35813;&#31867;&#23558;&#20026;&#20256;&#20837;&#30340; <tt class="interfacename">ConnectionFactory</tt> &#21019;&#24314;&#19968;&#20010; <tt class="classname">CciTemplate</tt> &#23454;&#20363;&#65292;
      &#24182;&#25226;&#23427;&#26292;&#38706;&#32473;&#23376;&#31867;&#20013;&#20855;&#20307;&#30340;&#25968;&#25454;&#35775;&#38382;&#23454;&#29616;&#20351;&#29992;&#12290;  </p><pre class="programlisting">public abstract class CciDaoSupport {
  ...
  public void setConnectionFactory(ConnectionFactory connectionFactory) { ... }
  public ConnectionFactory getConnectionFactory() { ... }

  public void setCciTemplate(CciTemplate cciTemplate) { ... }
  public CciTemplate getCciTemplate() { ... }
  ...
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="automatic-output-generation"></a>21.3.4.&nbsp;&#33258;&#21160;&#36755;&#20986;&#35760;&#24405;&#29983;&#25104; </h3></div></div><div></div></div><p>   
      &#22914;&#26524;&#25152;&#29992;&#30340;&#36830;&#25509;&#22120;&#21482;&#25903;&#25345;&#20197;&#36755;&#20837;&#36755;&#20986;&#35760;&#24405;&#20316;&#20026;&#21442;&#25968;&#30340; <tt class="literal">Interaction.execute(..)</tt> &#26041;&#27861;
      &#65288;&#23601;&#26159;&#35828;&#65292;&#23427;&#35201;&#27714;&#20256;&#20837;&#26399;&#26395;&#30340;&#36755;&#20986;&#35760;&#24405;&#32780;&#19981;&#26159;&#36820;&#22238;&#36866;&#24403;&#30340;&#36755;&#20986;&#35760;&#24405;&#65289;&#65292;
      &#20320;&#21487;&#20197;&#35774;&#23450; <tt class="classname">CciTemplate</tt> &#31867;&#30340; <tt class="literal">outputRecordCreator</tt> &#23646;&#24615;&#26469;&#33258;&#21160;&#29983;&#25104;&#19968;&#20010;&#36755;&#20986;&#35760;&#24405;&#65292;
      &#24403;&#25509;&#25910;&#21040;&#21709;&#24212;&#26102;JCA&#36830;&#25509;&#22120;&#65288;JCA connector&#65289;&#23558;&#22635;&#20805;&#35813;&#35760;&#24405;&#24182;&#36820;&#22238;&#32473;&#27169;&#26495;&#30340;&#35843;&#29992;&#32773;&#12290; 
      </p><p> 
     &#22240;&#20026;&#36825;&#20010;&#30446;&#30340;&#65292;&#36825;&#20010;&#23646;&#24615;&#21482;&#25345;&#26377; <tt class="interfacename">RecordCreator</tt> &#25509;&#21475;&#30340;&#19968;&#20010;&#23454;&#29616;&#12290;<tt class="interfacename">RecordCreator</tt>  &#25509;&#21475;&#24050;&#32463;&#22312;<a href="cci.html#cci-record-creator" title="21.3.1.&nbsp;&#35760;&#24405;&#36716;&#25442;">Section&nbsp;21.3.1, &#8220;&#35760;&#24405;&#36716;&#25442;&#8221;</a>&#36827;&#34892;&#20102;&#35752;&#35770;&#12290;
	<tt class="literal">outputRecordCreator</tt> &#23646;&#24615;&#24517;&#39035;&#30452;&#25509;&#22312; <tt class="classname">CciTemplate</tt>&#20013;&#25351;&#23450;&#65292;&#21487;&#20197;&#22312;&#24212;&#29992;&#20195;&#30721;&#20013;&#20570;&#21040;&#36825;&#19968;&#28857;&#12290; </p><pre class="programlisting">cciTemplate.setOutputRecordCreator(new EciOutputRecordCreator());</pre><p>&#25110;&#32773;&#22914;&#26524;<tt class="classname">CciTemplate</tt> &#34987;&#37197;&#32622;&#20026;&#19968;&#20010;&#19987;&#38376;&#30340;bean&#23454;&#20363;&#65292;&#37027;&#20040;outputRecordCreator&#36824;&#21487;&#20197;&#22312;Spring&#25991;&#20214;&#20013;&#37197;&#32622;&#65288;&#25512;&#33616;&#30340;&#20570;&#27861;&#65289;&#65306;</p><pre class="programlisting">&lt;bean id="eciOutputRecordCreator" class="eci.EciOutputRecordCreator"/&gt;

&lt;bean id="cciTemplate" class="org.springframework.jca.cci.core.CciTemplate"&gt;
  &lt;property name="connectionFactory" ref="eciConnectionFactory"/&gt;
  &lt;property name="outputRecordCreator" ref="eciOutputRecordCreator"/&gt;
&lt;/bean&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="http://www.redsaga.com/spring_ref/2.0RC2/images/admons/note.png"></td><th align="left">Note</th></tr><tr><td colspan="2" align="left" valign="top"><p>&#22240;&#20026; <tt class="classname">CciTemplate</tt> &#31867;&#26159;&#32447;&#31243;&#23433;&#20840;&#30340;&#65292;&#25152;&#20197;&#23427;&#36890;&#24120;&#34987;&#37197;&#32622;&#20026;&#19968;&#20010;&#20849;&#20139;&#23454;&#20363;&#12290; </p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="template-summary"></a>21.3.5.&nbsp;&#24635;&#32467;</h3></div></div><div></div></div><p>&#19979;&#34920;&#24635;&#32467;&#20102; <tt class="classname">CciTemplate</tt> &#31867;&#21644;&#22312; CCI <tt class="interfacename">Interaction</tt>  &#25509;&#21475;&#19978;&#35843;&#29992;&#30456;&#24212;&#26041;&#27861;&#30340;&#26426;&#21046;&#65306; 
      </p><div class="table"><a name="d0e25141"></a><p class="title"><b>Table&nbsp;21.1.&nbsp;Usage of <tt class="interfacename">Interaction</tt> execute methods</b></p><table summary="Usage of Interaction execute methods" border="1"><colgroup><col align="left"><col align="left"><col align="left"></colgroup><thead><tr><th align="center">CciTemplate method signature</th><th align="center">CciTemplate outputRecordCreator
                property</th><th align="center">execute method called on the CCI
                Interaction</th></tr></thead><tbody><tr><td align="center">Record execute(InteractionSpec,
                Record)</td><td align="center">not set</td><td align="center">Record execute(InteractionSpec,
                Record)</td></tr><tr><td align="center">Record execute(InteractionSpec,
                Record)</td><td align="center">set</td><td align="center">boolean execute(InteractionSpec, Record,
                Record)</td></tr><tr><td align="center">void execute(InteractionSpec, Record,
                Record)</td><td align="center">not set</td><td align="center">void execute(InteractionSpec, Record,
                Record)</td></tr><tr><td align="center">void execute(InteractionSpec, Record,
                Record)</td><td align="center">set</td><td align="center">void execute(InteractionSpec, Record,
                Record)</td></tr><tr><td align="center">Record execute(InteractionSpec,
                RecordCreator)</td><td align="center">not set</td><td align="center">Record execute(InteractionSpec,
                Record)</td></tr><tr><td align="center">Record execute(InteractionSpec,
                RecordCreator)</td><td align="center">set</td><td align="center">void execute(InteractionSpec, Record,
                Record)</td></tr><tr><td align="center">Record execute(InteractionSpec, Record,
                RecordExtractor)</td><td align="center">not set</td><td align="center">Record execute(InteractionSpec,
                Record)</td></tr><tr><td align="center">Record execute(InteractionSpec, Record,
                RecordExtractor)</td><td align="center">set</td><td align="center">void execute(InteractionSpec, Record,
                Record)</td></tr><tr><td align="center">Record execute(InteractionSpec,
                RecordCreator, RecordExtractor)</td><td align="center">not set</td><td align="center">Record execute(InteractionSpec,
                Record)</td></tr><tr><td align="center">Record execute(InteractionSpec,
                RecordCreator, RecordExtractor)</td><td align="center">set</td><td align="center">void execute(InteractionSpec, Record,
                Record)</td></tr></tbody></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e25230"></a>21.3.6.&nbsp;&#30452;&#25509;&#20351;&#29992;&#19968;&#20010; CCI <tt class="interfacename">Connection</tt> &#25509;&#21475;&#21644;<tt class="interfacename">Interaction</tt>&#25509;&#21475;</h3></div></div><div></div></div><p>      
	     &#31867;&#20284;&#20110;<tt class="classname">JdbcTemplate</tt> &#31867;&#21644; <tt class="classname">JmsTemplate</tt> &#31867;&#30340;&#25805;&#20316;&#26041;&#24335;&#65292;<tt class="classname">CciTemplate</tt> &#31867;&#21516;&#26679;&#25552;&#20379;&#30452;&#25509;&#25805;&#20316;CCI &#36830;&#25509;&#21644;&#20132;&#20114;&#30340;&#21487;&#33021;&#24615;&#12290;
	      &#27604;&#22914;&#35828;&#22914;&#26524;&#20320;&#24819;&#23545;&#19968;&#20010;CCI&#36830;&#25509;&#25191;&#34892;&#22810;&#31181;&#25805;&#20316;&#65292;&#36825;&#23601;&#20250;&#24456;&#26377;&#29992;&#12290; 
	 </p><p>   
 <tt class="interfacename">ConnectionCallback</tt> &#25509;&#21475;&#25552;&#20379;&#20197;CCI <tt class="interfacename">Connection</tt> &#20316;&#20026;&#21442;&#25968;&#65292;&#20026;&#20102;&#22312;&#23427;&#19978;&#38754;&#25191;&#34892;&#33258;&#23450;&#20041;&#21160;&#20316;&#65292;&#28155;&#21152;&#20102;&#21019;&#24314;<tt class="interfacename">Connection</tt>&#30340;CCI  <tt class="interfacename">ConnectionFactory</tt>&#12290;
	&#21518;&#32773;&#22312;&#33719;&#21462;&#30456;&#20851; <tt class="interfacename">RecordFactory</tt> &#23454;&#20363;&#21644;&#21019;&#24314;indexed/mapped records&#26102;&#24456;&#26377;&#29992;&#12290;&#20363;&#22914;&#65306;
      </p><pre class="programlisting">public interface ConnectionCallback {

  Object doInConnection(Connection connection, ConnectionFactory connectionFactory)
      throws ResourceException, SQLException, DataAccessException;
}</pre><p> 
	<tt class="interfacename">InteractionCallback</tt> &#25509;&#21475;&#25552;&#20379; CCI <tt class="interfacename">Interaction</tt> &#25509;&#21475;&#65292;&#20026;&#20102;&#22312;&#23427;&#19978;&#38754;&#25191;&#34892;&#33258;&#23450;&#20041;&#21160;&#20316;&#65292;&#35831;&#28155;&#21152;&#30456;&#24212;&#30340;CCI <tt class="interfacename">ConnectionFactory</tt>&#12290;</p><pre class="programlisting">public interface InteractionCallback {

  Object doInInteraction(Interaction interaction, ConnectionFactory connectionFactory)
      throws ResourceException, SQLException, DataAccessException;
}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="http://www.redsaga.com/spring_ref/2.0RC2/images/admons/note.png"></td><th align="left">Note</th></tr><tr><td colspan="2" align="left" valign="top"><p><tt class="interfacename">InteractionSpec</tt> &#23545;&#35937;&#36824;&#21487;&#20197;&#22312;&#22810;&#20010;template&#35843;&#29992;&#20043;&#38388;&#34987;&#20849;&#20139;&#25110;&#32773;&#22312;&#27599;&#20010;&#22238;&#35843;&#26041;&#27861;&#20869;&#37325;&#26032;&#21019;&#24314;&#65292;&#36825;&#23436;&#20840;&#21462;&#20915;&#20110; DAO &#30340;&#23454;&#29616;&#12290; </p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e25287"></a>21.3.7.&nbsp;<tt class="classname">CciTemplate</tt> &#20351;&#29992;&#31034;&#20363;</h3></div></div><div></div></div><p>&#22312;&#36825;&#31456;&#33410;&#20013;&#65292;&#25105;&#20204;&#23558;&#23637;&#31034;&#22914;&#20309;&#20351;&#29992; <tt class="classname">CciTemplate</tt> &#21644;IBM CICS ECI&#36830;&#25509;&#22120;&#22312;ECI&#27169;&#24335;&#19979;&#35775;&#38382;&#19968;&#20010;CICS.</p><p>&#39318;&#20808;&#65292;&#22312;CCI <tt class="interfacename">InteractionSpec</tt> &#36827;&#34892;&#19968;&#20123;&#21021;&#22987;&#21270;&#20197;&#25351;&#23450;&#35775;&#38382;&#21738;&#20010;CICS&#31243;&#24207;&#24182;&#19988;&#25351;&#23450;&#22914;&#20309;&#36827;&#34892;&#20132;&#20114;&#12290; </p><pre class="programlisting">ECIInteractionSpec interactionSpec = new ECIInteractionSpec();
interactionSpec.setFunctionName("MYPROG");
interactionSpec.setInteractionVerb(ECIInteractionSpec.SYNC_SEND_RECEIVE);</pre><p>&#28982;&#21518;&#65292;&#31243;&#24207;&#36890;&#36807;Spring&#30340;&#27169;&#26495;&#20351;&#29992; CCI &#24182;&#22312;&#33258;&#23450;&#20041;&#23545;&#35937;&#21644; CCI  <tt class="literal">Records</tt> &#20043;&#38388;&#25351;&#23450;&#26144;&#23556;&#12290; </p><pre class="programlisting">public class MyDaoImpl extends CciDaoSupport implements MyDao {

  public OutputObject getData(InputObject input) {
    ECIInteractionSpec interactionSpec = ...;

    OutputObject output = (ObjectOutput) getCciTemplate().execute(interactionSpec,
        new RecordCreator() {
          public Record createRecord(RecordFactory recordFactory) throws ResourceException {
            return new CommAreaRecord(input.toString().getBytes());
          }
        },
        new RecordExtractor() {
          public Object extractData(Record record) throws ResourceException {
            CommAreaRecord commAreaRecord = (CommAreaRecord)record;
            String str = new String(commAreaRecord.toByteArray());
            String field1 = string.substring(0,6);
            String field2 = string.substring(6,1);
            return new OutputObject(Long.parseLong(field1), field2);
          }
        });

    return output;
  }
}</pre><p>
          &#27491;&#22914;&#20043;&#21069;&#35752;&#35770;&#30340;&#37027;&#26679;&#65292;callbacks &#21487;&#20197;&#34987;&#29992;&#26469;&#30452;&#25509;&#22312; CCI &#36830;&#25509;&#25110;&#20132;&#20114;&#19978;&#25805;&#20316;&#12290;</p><pre class="programlisting">public class MyDaoImpl extends CciDaoSupport implements MyDao {

  public OutputObject getData(InputObject input) {
    ObjectOutput output = (ObjectOutput) getCciTemplate().execute(
        new ConnectionCallback() {
          public Object doInConnection(Connection connection, ConnectionFactory factory)
              throws ResourceException {
            ...
          }
        });
    }
    return output;
  }
}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="http://www.redsaga.com/spring_ref/2.0RC2/images/admons/note.png"></td><th align="left">Note</th></tr><tr><td colspan="2" align="left" valign="top"><p>&#24403;getCciTemplate().execute&#21442;&#25968;&#26159;<tt class="interfacename">ConnectionCallback</tt>&#26102;&#65292;
      &#25152;&#29992;&#30340; <tt class="interfacename">Connection</tt> &#23558;&#34987; <tt class="classname">CciTemplate</tt> &#31649;&#29702;&#21644;&#20851;&#38381;&#65292;
      &#20294;&#26159;&#20219;&#20309;&#22312;&#36830;&#25509;&#19978;&#24314;&#31435;&#30340;&#20132;&#20114;&#24517;&#39035;&#34987;callback&#23454;&#29616;&#31867;&#25152;&#31649;&#29702;&#12290; 
	</p></td></tr></table></div><p>
			&#23545;&#20110;&#19968;&#20010;&#26356;&#29305;&#27530;&#30340;callback&#65292;&#20320;&#21487;&#20197;&#23454;&#29616;&#19968;&#20010; <tt class="interfacename">InteractionCallback</tt> &#12290;
			&#36825;&#26679;&#20256;&#20837;&#30340; <tt class="interfacename">Interaction</tt>  &#23558;&#20250;&#34987; <tt class="classname">CciTemplate</tt> &#31649;&#29702;&#21644;&#20851;&#38381;&#12290;
			</p><pre class="programlisting">public class MyDaoImpl extends CciDaoSupport implements MyDao {

  public String getData(String input) {
    ECIInteractionSpec interactionSpec = ...;

    String output = (String) getCciTemplate().execute(interactionSpec,
        new InteractionCallback() {
          public Object doInInteraction(Interaction interaction, ConnectionFactory factory)
              throws ResourceException {
            Record input = new CommAreaRecord(inputString.getBytes());
            Record output = new CommAreaRecord();
            interaction.execute(holder.getInteractionSpec(), input, output);
            return new String(output.toByteArray());
          }
        });

    return output;
  }
}</pre><p>&#19978;&#38754;&#30340;&#20363;&#23376;&#20013;&#65292;&#22312;&#38750;&#25176;&#31649;&#27169;&#24335;&#65288;non-managed&#65289;&#19979;&#23545;&#24212;&#30340;spring beans&#30340;&#37197;&#32622;&#20250;&#26159;&#19979;&#38754;&#36825;&#26679;&#65306; </p><pre class="programlisting">&lt;bean id="managedConnectionFactory" class="com.ibm.connector2.cics.ECIManagedConnectionFactory"&gt;
  &lt;property name="serverName" value="TXSERIES"/&gt;
  &lt;property name="connectionURL" value="local:"/&gt;
  &lt;property name="userName" value="CICSUSER"/&gt;
  &lt;property name="password" value="CICS"/&gt;
&lt;/bean&gt;

&lt;bean id="connectionFactory" class="org.springframework.jca.support.LocalConnectionFactoryBean"&gt;
  &lt;property name="managedConnectionFactory" ref="managedConnectionFactory"/&gt;
&lt;/bean&gt;

&lt;bean id="component" class="mypackage.MyDaoImpl"&gt;
  &lt;property name="connectionFactory" ref="connectionFactory"/&gt;
&lt;/bean&gt;</pre><p> &#22312;&#25176;&#31649;&#27169;&#24335;&#65288;managed mode&#65289;(&#20063;&#23601;&#26159;&#35828;&#65292;&#22312;&#19968;&#20010;J2EE&#29615;&#22659;)&#19979;&#65292;&#37197;&#32622;&#21487;&#33021;&#22914;&#19979;&#25152;&#31034;&#65306; </p><pre class="programlisting">&lt;bean id="connectionFactory" class="org.springframework.jndi.JndiObjectFactoryBean"&gt;
  &lt;property name="jndiName" value="eis/cicseci"/&gt;
&lt;/bean&gt;

&lt;bean id="component" class="MyDaoImpl"&gt;
  &lt;property name="connectionFactory" ref="connectionFactory"/&gt;
&lt;/bean&gt;</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e25348"></a>21.4.&nbsp;&#24314;&#27169;CCI&#35775;&#38382;&#20026;&#25805;&#20316;&#23545;&#35937;</h2></div></div><div></div></div><p> 
    <tt class="literal">org.springframework.jca.cci.object</tt> &#21253;&#20013;&#21253;&#21547;&#30340;&#25903;&#25345;&#31867;&#20801;&#35768;&#20320;&#20197;&#21478;&#19968;&#31181;&#39118;&#26684;&#35775;&#38382;EIS&#65306;
    &#36890;&#36807;&#21487;&#37325;&#29992;&#30340;&#25805;&#20316;&#23545;&#35937;&#65292;&#31867;&#20284;&#20110;Spring&#30340;JDBC&#25805;&#20316;&#23545;&#35937;&#65288;&#21442;&#35265;JDBC&#19968;&#31456;&#65289;&#12290;
    &#23427;&#36890;&#24120;&#37117;&#23553;&#35013;&#20102; CCI &#30340;API&#65306;&#23558;&#24212;&#29992;&#32423;&#30340;&#36755;&#20837;&#23545;&#35937;&#20256;&#20837;&#21040;&#25805;&#20316;&#23545;&#35937;&#65292;
    &#20174;&#32780;&#23427;&#33021;&#21019;&#24314;&#36755;&#20837;record&#28982;&#21518;&#36716;&#25442;&#25509;&#25910;&#21040;&#30340;record&#25968;&#25454;&#21040;&#19968;&#20010;&#24212;&#29992;&#32423;&#36755;&#20986;&#23545;&#35937;&#24182;&#36820;&#22238;&#23427;&#12290; 
    </p><p><span class="emphasis"><em>&#27880;&#24847;</em></span>: &#36825;&#31181;&#26041;&#27861;&#20869;&#22312;&#22320;&#22522;&#20110; <tt class="classname">CciTemplate</tt>  &#31867;&#21644;
    <tt class="interfacename">RecordCreator</tt> /<tt class="interfacename">RecordExtractor</tt>  &#25509;&#21475;&#65292;&#37325;&#29992;&#20102;Spring&#26680;&#24515;CCI&#25903;&#25345;&#30340;&#26426;&#21046;&#12290;</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e25369"></a>21.4.1.&nbsp;<tt class="classname">MappingRecordOperation</tt></h3></div></div><div></div></div><p> <tt class="classname">MappingRecordOperation</tt> &#26412;&#36136;&#19978;&#19982; <tt class="classname">CciTemplate</tt> &#20570;&#30340;&#20107;&#24773;&#26159;&#19968;&#26679;&#30340;&#65292;
      &#20294;&#26159;&#23427;&#34920;&#36798;&#20102;&#19968;&#20010;&#26126;&#30830;&#30340;&#12289;&#39044;&#37197;&#32622;&#65288;pre-configured&#65289;&#30340;&#25805;&#20316;&#20316;&#20026;&#23545;&#35937;&#12290;&#23427;&#25552;&#20379;&#20102;&#20004;&#20010;&#27169;&#26495;&#26041;&#27861;&#26469;&#25351;&#26126;&#22914;&#20309;&#36716;&#25442;&#19968;&#20010;&#36755;&#20837;&#23545;&#35937;&#21040;&#36755;&#20837;&#35760;&#24405;&#65292;
      &#20197;&#21450;&#22914;&#20309;&#36716;&#25442;&#19968;&#20010;&#36755;&#20986;&#35760;&#24405;&#21040;&#36755;&#20986;&#23545;&#35937;&#65288;&#35760;&#24405;&#26144;&#23556;&#65289;&#65306; 
		</p><div class="itemizedlist"><ul type="disc"><li><p><tt class="literal">createInputRecord(..)</tt>  &#25351;&#23450;&#20102;&#22914;&#20309;&#36716;&#25442;&#19968;&#20010;&#36755;&#20837;&#23545;&#35937;&#21040;&#36755;&#20837;<tt class="interfacename">Record</tt></p></li><li><p><tt class="literal">extractOutputData(..)</tt> &#25351;&#23450;&#20102;&#22914;&#20309;&#20174;&#36755;&#20986; <tt class="interfacename">Record</tt> &#20013;&#25552;&#21462;&#36755;&#20986;&#23545;&#35937;
		  </p></li></ul></div><p>&#19979;&#38754;&#26159;&#36825;&#20123;&#26041;&#27861;&#30340;&#31614;&#21517;&#65306; </p><pre class="programlisting">public abstract class MappingRecordOperation extends EisOperation {
  ...
  protected abstract Record createInputRecord(RecordFactory recordFactory, Object inputObject)
      throws ResourceException, DataAccessException { ... }

  protected abstract Object extractOutputData(Record outputRecord)
      throws ResourceException, SQLException, DataAccessException { ... }
  ...
}</pre><p> &#22240;&#27492;&#65292;&#20026;&#20102;&#25191;&#34892;&#19968;&#20010; EIS &#25805;&#20316;&#65292;&#20320;&#38656;&#35201;&#20351;&#29992;&#19968;&#20010;&#21333;&#29420;&#30340;execute&#26041;&#27861;&#65292;&#24182;&#20256;&#36882;&#19968;&#20010;&#24212;&#29992;&#32423;&#65288;application-level&#65289;&#36755;&#20837;&#23545;&#35937;&#24182;&#25509;&#25910;&#19968;&#20010;&#24212;&#29992;&#32423;&#36755;&#20986;&#23545;&#35937;&#20316;&#20026;&#32467;&#26524;&#65306; 			
			</p><pre class="programlisting">public abstract class MappingRecordOperation extends EisOperation {
  ...
  public Object execute(Object inputObject) throws DataAccessException {
  ...
}</pre><p> 
      &#27491;&#22914;&#20320;&#25152;&#30475;&#21040;&#30340;&#65292;&#19982; <tt class="classname">CciTemplate</tt> &#31867;&#30456;&#21453;&#65292;
      &#36825;&#20010;<tt class="literal">execute</tt>&#26041;&#27861;&#24182;&#27809;&#26377; <tt class="interfacename">InteractionSpec</tt> &#21442;&#25968;&#65292;
      &#28982;&#32780;&#65292;<tt class="interfacename">InteractionSpec</tt> &#23545;&#25805;&#20316;&#26159;&#20840;&#23616;&#30340;&#12290;
      &#19979;&#38754;&#30340;&#26500;&#36896;&#26041;&#27861;&#24517;&#39035;&#20351;&#29992;&#25351;&#23450;&#30340; <tt class="interfacename">InteractionSpec</tt> &#26469;&#21021;&#22987;&#21270;&#19968;&#20010;&#25805;&#20316;&#23545;&#35937;&#65306; 
      </p><pre class="programlisting">InteractionSpec spec = ...;
MyMappingRecordOperation eisOperation = new MyMappingRecordOperation(getConnectionFactory(), spec);
...</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e25424"></a>21.4.2.&nbsp;<tt class="classname">MappingCommAreaOperation</tt></h3></div></div><div></div></div><p> 
      &#19968;&#20123;&#36830;&#25509;&#22120;&#20351;&#29992;&#20102;&#22522;&#20110;COMMAREA&#30340;&#35760;&#24405;&#65292;&#35813;&#35760;&#24405;&#21253;&#21547;&#20102;&#21457;&#36865;&#32473;EIS&#30340;&#21442;&#25968;&#21644;&#36820;&#22238;&#30340;&#25968;&#25454;&#30340;&#23383;&#33410;&#25968;&#32452;&#12290;
      Spring&#25552;&#20379;&#20102;&#19968;&#20010;&#19987;&#38376;&#30340;&#25805;&#20316;&#31867;&#29992;&#20110;&#30452;&#25509;&#25805;&#20316;COMMAREA&#32780;&#19981;&#26159;&#25805;&#20316;&#35760;&#24405;&#12290; 
      <tt class="classname">MappingCommAreaOperation</tt> &#31867;&#25193;&#23637;&#20102;  <tt class="classname">MappingRecordOperation</tt>  &#31867;&#20197;&#25552;&#20379;&#36825;&#31181;&#19987;&#38376;&#30340;COMMAREA&#25903;&#25345;&#12290;
      &#23427;&#38544;&#21547;&#22320;&#20351;&#29992;&#20102; <tt class="classname">CommAreaRecord</tt>&#31867;&#20316;&#20026;&#36755;&#20837;&#21644;&#36755;&#20986;record&#31867;&#22411;&#65292;
      &#24182;&#25552;&#20379;&#20102;&#20004;&#20010;&#26032;&#30340;&#26041;&#27861;&#26469;&#36716;&#25442;&#36755;&#20837;&#23545;&#35937;&#21040;&#36755;&#20837;COMMAREA&#65292;&#20197;&#21450;&#36716;&#25442;&#36755;&#20986;COMMAREA&#21040;&#36755;&#20986;&#23545;&#35937;&#12290; 
      </p><pre class="programlisting">public abstract class MappingCommAreaOperation extends MappingRecordOperation {
  ...
  protected abstract byte[] objectToBytes(Object inObject)
      throws IOException, DataAccessException;

  protected abstract Object bytesToObject(byte[] bytes)
      throws IOException, DataAccessException;
  ...
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e25441"></a>21.4.3.&nbsp;&#33258;&#21160;&#36755;&#20986;&#35760;&#24405;&#29983;&#25104;</h3></div></div><div></div></div><p> 
	&#30001;&#20110;&#27599;&#20010; <tt class="classname">MappingRecordOperation</tt> &#23376;&#31867;&#30340;&#20869;&#37096;&#37117;&#26159;&#22522;&#20110; <tt class="classname">CciTemplate</tt> &#30340;&#65292;&#25152;&#20197;
	&#29992; <tt class="classname">CciTemplate</tt> &#20197;&#30456;&#21516;&#30340;&#26041;&#24335;&#33258;&#21160;&#29983;&#25104;&#36755;&#20986;record&#37117;&#26159;&#26377;&#25928;&#30340;&#12290;
	&#27599;&#20010;&#25805;&#20316;&#23545;&#35937;&#25552;&#20379;&#19968;&#20010;&#30456;&#24212;&#30340;  <tt class="literal">setOutputRecordCreator(..)</tt> &#26041;&#27861;&#12290;
	&#26356;&#22810;&#30340;&#20449;&#24687;&#65292;&#35831;&#21442;&#35265;&#21069;&#38754;&#30340;<a href="cci.html#automatic-output-generation" title="21.3.4.&nbsp;&#33258;&#21160;&#36755;&#20986;&#35760;&#24405;&#29983;&#25104; ">Section&nbsp;21.3.4, &#8220;&#33258;&#21160;&#36755;&#20986;&#35760;&#24405;&#29983;&#25104; &#8221;</a>&#19968;&#33410;&#12290; 			
			</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e25460"></a>21.4.4.&nbsp;&#24635;&#32467;</h3></div></div><div></div></div><p>&#25805;&#20316;&#23545;&#35937;&#20351;&#29992;&#20102;&#36319; <tt class="classname">CciTemplate</tt> &#30456;&#21516;&#30340;&#26041;&#27861;&#26469;&#20351;&#29992;&#35760;&#24405;&#12290;
      </p><div class="table"><a name="d0e25468"></a><p class="title"><b>Table&nbsp;21.2.&nbsp;Usage of Interaction execute methods</b></p><table summary="Usage of Interaction execute methods" border="1"><colgroup><col align="left"><col align="left"><col align="left"></colgroup><thead><tr><th align="center"><tt class="classname">MappingRecordOperation</tt> method
                signature</th><th align="center"><tt class="classname">MappingRecordOperation</tt>
                outputRecordCreator property</th><th align="center">execute method called on the CCI
                Interaction</th></tr></thead><tbody><tr><td align="center">Object execute(Object)</td><td align="center">not set</td><td align="center">Record execute(InteractionSpec,
                Record)</td></tr><tr><td align="center">Object execute(Object)</td><td align="center">set</td><td align="center">boolean execute(InteractionSpec, Record,
                Record)</td></tr></tbody></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e25502"></a>21.4.5.&nbsp;<tt class="classname">MappingRecordOperation</tt> &#20351;&#29992;&#31034;&#20363;</h3></div></div><div></div></div><p>
	      &#22312;&#26412;&#33410;&#20013;&#65292;&#23558;&#36890;&#36807;&#23637;&#31034;&#20351;&#29992; Blackbox CCI &#36830;&#25509;&#22120;&#35775;&#38382;&#19968;&#20010;&#25968;&#25454;&#24211;&#26469;&#35828;&#26126; <tt class="classname">MappingRecordOperation</tt> &#30340;&#29992;&#27861;&#12290; 
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="http://www.redsaga.com/spring_ref/2.0RC2/images/admons/note.png"></td><th align="left">Note</th></tr><tr><td colspan="2" align="left" valign="top"><p>&#35813;&#36830;&#25509;&#22120;&#30340;&#26368;&#21021;&#29256;&#26412;&#26159;&#30001;SUN&#25552;&#20379;&#30340;J2EE SDK(1.3&#29256;&#26412;)&#12290;</p></td></tr></table></div><p> 
      &#39318;&#20808;&#65292;&#24517;&#39035;&#22312; CCI <tt class="interfacename">InteractionSpec</tt> &#20013;&#36827;&#34892;&#19968;&#20123;&#21021;&#22987;&#21270;&#21160;&#20316;&#26469;&#25351;&#23450;&#25191;&#34892;&#21738;&#20123;SQL&#35831;&#27714;&#12290;
	&#22312;&#36825;&#20010;&#20363;&#23376;&#20013;&#65292;&#25105;&#20204;&#30452;&#25509;&#23450;&#20041;&#20102;&#23558;&#35831;&#27714;&#21442;&#25968;&#36716;&#25442;&#20026;CCI record&#20197;&#21450;&#23558;CCI&#32467;&#26524;&#35760;&#24405;&#36716;&#25442;&#20026;&#19968;&#20010; <tt class="classname">Person</tt> &#31867;&#30340;&#23454;&#20363;&#30340;&#26041;&#27861;&#12290; 
      </p><pre class="programlisting">public class PersonMappingOperation extends MappingRecordOperation {

  public PersonMappingOperation(ConnectionFactory connectionFactory) {
    setConnectionFactory(connectionFactory);
    CciInteractionSpec interactionSpec = new CciConnectionSpec();
    interactionSpec.setSql("select * from person where person_id=?");
    setInteractionSpec(interactionSpec);
  }

  protected Record createInputRecord(RecordFactory recordFactory, Object inputObject)
      throws ResourceException {
    Integer id = (Integer) inputObject;
    IndexedRecord input = recordFactory.createIndexedRecord("input");
    input.add(new Integer(id));
    return input;
  }

  protected Object extractOutputData(Record outputRecord)
      throws ResourceException, SQLException {
    ResultSet rs = (ResultSet) outputRecord;
    Person person = null;
    if (rs.next()) {
      Person person = new Person();
      person.setId(rs.getInt("person_id"));
      person.setLastName(rs.getString("person_last_name"));
      person.setFirstName(rs.getString("person_first_name"));
    }
    return person;
  }
}</pre><p>&#28982;&#21518;&#24212;&#29992;&#31243;&#24207;&#20250;&#20197;person&#26631;&#35782;&#31526;&#20316;&#20026;&#21442;&#25968;&#26469;&#24471;&#21040;&#25805;&#20316;&#23545;&#35937;&#12290;&#27880;&#24847;&#65306;&#25805;&#20316;&#23545;&#35937;&#33021;&#34987;&#35774;&#20026;&#20849;&#20139;&#23454;&#20363;&#65292;&#22240;&#20026;&#23427;&#26159;&#32447;&#31243;&#23433;&#20840;&#30340;&#12290; 
</p><pre class="programlisting">public class MyDaoImpl extends CciDaoSupport implements MyDao {

  public Person getPerson(int id) {
    PersonMappingOperation query = new PersonMappingOperation(getConnectionFactory());
    Person person = (Person) query.execute(new Integer(id));
    return person;
  }
}</pre><p>&#23545;&#24212;&#30340;Spring beans&#30340;&#37197;&#32622;&#30475;&#36215;&#26469;&#31867;&#20284;&#20110;&#19979;&#38754;&#38750;&#25176;&#31649;&#27169;&#24335;&#65288;non-managed mode&#65289;&#30340;&#37197;&#32622;&#65306; </p><pre class="programlisting">&lt;bean id="managedConnectionFactory"
    class="com.sun.connector.cciblackbox.CciLocalTxManagedConnectionFactory"&gt;
  &lt;property name="connectionURL" value="jdbc:hsqldb:hsql://localhost:9001"/&gt;
  &lt;property name="driverName" value="org.hsqldb.jdbcDriver"/&gt;
&lt;/bean&gt;

&lt;bean id="targetConnectionFactory"
    class="org.springframework.jca.support.LocalConnectionFactoryBean"&gt;
  &lt;property name="managedConnectionFactory" ref="managedConnectionFactory"/&gt;
&lt;/bean&gt;

&lt;bean id="connectionFactory"
    class="org.springframework.jca.cci.connection.ConnectionSpecConnectionFactoryAdapter"&gt;
  &lt;property name="targetConnectionFactory" ref="targetConnectionFactory"/&gt;
  &lt;property name="connectionSpec"&gt;
    &lt;bean class="com.sun.connector.cciblackbox.CciConnectionSpec"&gt;
      &lt;property name="user" value="sa"/&gt;
      &lt;property name="password" value=""/&gt;
    &lt;/bean&gt;
  &lt;/property&gt;
&lt;/bean&gt;

&lt;bean id="component" class="MyDaoImpl"&gt;
  &lt;property name="connectionFactory" ref="connectionFactory"/&gt;
&lt;/bean&gt;</pre><p>&#22312;&#25176;&#31649;&#27169;&#24335;&#65288;managed mode&#65289;(&#20063;&#23601;&#26159;&#35828;&#65292;&#22312;&#19968;&#20010;J2EE&#29615;&#22659;&#20013;)&#65292;&#37197;&#32622;&#21487;&#33021;&#30475;&#36215;&#26469;&#20687;&#36825;&#26679;&#65306; </p><pre class="programlisting">&lt;bean id="targetConnectionFactory" class="org.springframework.jndi.JndiObjectFactoryBean"&gt;
  &lt;property name="jndiName" value="eis/blackbox"/&gt;
&lt;/bean&gt;

&lt;bean id="connectionFactory"
    class="org.springframework.jca.cci.connection.ConnectionSpecConnectionFactoryAdapter"&gt;
  &lt;property name="targetConnectionFactory" ref="targetConnectionFactory"/&gt;
  &lt;property name="connectionSpec"&gt;
    &lt;bean class="com.sun.connector.cciblackbox.CciConnectionSpec"&gt;
      &lt;property name="user" value="sa"/&gt;
      &lt;property name="password" value=""/&gt;
    &lt;/bean&gt;
  &lt;/property&gt;
&lt;/bean&gt;

&lt;bean id="component" class="MyDaoImpl"&gt;
  &lt;property name="connectionFactory" ref="connectionFactory"/&gt;
&lt;/bean&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e25537"></a>21.4.6.&nbsp;<tt class="classname">MappingCommAreaOperation</tt> &#20351;&#29992;&#31034;&#20363;</h3></div></div><div></div></div><p> 
      &#22312;&#26412;&#33410;&#20013;&#65292;&#23558;&#23637;&#31034;  <tt class="classname">MappingCommAreaOperation</tt>&#31867;&#30340;&#29992;&#27861;&#65306;&#36890;&#36807;IBM ECI&#36830;&#25509;&#22120;&#20197;ECI&#30340;&#27169;&#24335;&#35775;&#38382;&#19968;&#20010;CICS&#12290; 
      </p><p> 
      	&#39318;&#20808;&#65292;CCI <tt class="interfacename">InteractionSpec</tt>  &#38656;&#35201;&#36827;&#34892;&#21021;&#22987;&#21270;&#20197;&#25351;&#23450;&#37027;&#20010;CICS&#31243;&#24207;&#21435;&#35775;&#38382;&#23427;&#20197;&#21450;&#22914;&#20309;&#19982;&#23427;&#20132;&#20114;&#12290; 
      </p><pre class="programlisting">public abstract class EciMappingOperation extends MappingCommAreaOperation {

  public EciMappingOperation(ConnectionFactory connectionFactory, String programName) {
    setConnectionFactory(connectionFactory);
    ECIInteractionSpec interactionSpec = new ECIInteractionSpec(),
    interactionSpec.setFunctionName(programName);
    interactionSpec.setInteractionVerb(ECIInteractionSpec.SYNC_SEND_RECEIVE);
    interactionSpec.setCommareaLength(30);
    setInteractionSpec(interactionSpec);
    setOutputRecordCreator(new EciOutputRecordCreator());
  }

  private static class EciOutputRecordCreator implements RecordCreator {
    public Record createRecord(RecordFactory recordFactory) throws ResourceException {
      return new CommAreaRecord();
    }
  }
}</pre><p> <tt class="classname">EciMappingOperation</tt> &#25277;&#35937;&#31867;&#21487;&#20197;&#34987;&#23376;&#31867;&#21270;&#20197;&#25351;&#23450;&#33258;&#23450;&#20041;&#23545;&#35937;&#21644; <tt class="literal">Records</tt> &#20043;&#38388;&#30340;&#26144;&#23556;&#12290; 
</p><pre class="programlisting">public class MyDaoImpl extends CciDaoSupport implements MyDao {

  public OutputObject getData(Integer id) {
    EciMappingOperation query = new EciMappingOperation(getConnectionFactory(), "MYPROG") {
      protected abstract byte[] objectToBytes(Object inObject) throws IOException {
        Integer id = (Integer) inObject;
        return String.valueOf(id);
      }
      protected abstract Object bytesToObject(byte[] bytes) throws IOException;
        String str = new String(bytes);
        String field1 = str.substring(0,6);
        String field2 = str.substring(6,1);
        String field3 = str.substring(7,1);
        return new OutputObject(field1, field2, field3);
      }
    });

    return (OutputObject) query.execute(new Integer(id));
  }
}</pre><p>&#23545;&#24212;&#30340;Spring beans&#30340;&#37197;&#32622;&#30475;&#36215;&#26469;&#31867;&#20284;&#20110;&#19979;&#38754;&#38750;&#25176;&#31649;&#27169;&#24335;&#65288;non-managed mode&#65289;&#30340;&#37197;&#32622;&#65306; </p><pre class="programlisting">&lt;bean id="managedConnectionFactory" class="com.ibm.connector2.cics.ECIManagedConnectionFactory"&gt;
  &lt;property name="serverName" value="TXSERIES"/&gt;
  &lt;property name="connectionURL" value="local:"/&gt;
  &lt;property name="userName" value="CICSUSER"/&gt;
  &lt;property name="password" value="CICS"/&gt;
&lt;/bean&gt;

&lt;bean id="connectionFactory" class="org.springframework.jca.support.LocalConnectionFactoryBean"&gt;
  &lt;property name="managedConnectionFactory" ref="managedConnectionFactory"/&gt;
&lt;/bean&gt;

&lt;bean id="component" class="MyDaoImpl"&gt;
  &lt;property name="connectionFactory" ref="connectionFactory"/&gt;
&lt;/bean&gt;</pre><p>&#22312;&#25176;&#31649;&#27169;&#24335;&#65288;managed mode&#65289;(&#20063;&#23601;&#26159;&#35828;&#65292;&#22312;&#19968;&#20010;J2EE&#29615;&#22659;&#20013;)&#65292;&#37197;&#32622;&#21487;&#33021;&#30475;&#36215;&#26469;&#20687;&#36825;&#26679;&#65306; </p><pre class="programlisting">&lt;bean id="connectionFactory" class="org.springframework.jndi.JndiObjectFactoryBean"&gt;
  &lt;property name="jndiName" value="eis/cicseci"/&gt;
&lt;/bean&gt;

&lt;bean id="component" class="MyDaoImpl"&gt;
  &lt;property name="connectionFactory" ref="connectionFactory"/&gt;
&lt;/bean&gt;</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e25572"></a>21.5.&nbsp;&#20107;&#21153;</h2></div></div><div></div></div><p>
    JCA&#20026;&#36164;&#28304;&#36866;&#37197;&#22120;&#65288;resource adapters&#65289;&#25351;&#23450;&#20102;&#20960;&#20010;&#32423;&#21035;&#30340;&#20107;&#21153;&#25903;&#25345;&#12290;
    &#20320;&#21487;&#20197;&#22312;<tt class="filename">ra.xml</tt> &#25991;&#20214;&#20013;&#25351;&#23450;&#20320;&#30340;&#36164;&#28304;&#36866;&#37197;&#22120;&#25903;&#25345;&#30340;&#20107;&#21153;&#31867;&#22411;&#12290;
    &#23427;&#26412;&#36136;&#19978;&#26377;&#19977;&#20010;&#36873;&#39033;&#65306;none(&#20363;&#22914;CICS EPI &#36830;&#25509;&#22120;)&#65292;&#26412;&#22320;&#20107;&#21153;(&#20363;&#22914;CICS ECI &#36830;&#25509;&#22120;)&#65292;&#20840;&#23616;&#20107;&#21153;(&#20363;&#22914;IMS &#36830;&#25509;&#22120;)&#12290; </p><pre class="programlisting">&lt;connector&gt;
  ...
  &lt;resourceadapter&gt;
    ...
    &lt;!-- transaction-support&gt;NoTransaction&lt;/transaction-support --&gt;
    &lt;!-- transaction-support&gt;LocalTransaction&lt;/transaction-support --&gt;
    &lt;transaction-support&gt;XATransaction&lt;/transaction-support&gt;
    ...
  &lt;resourceadapter&gt;
  ...
&lt;connector&gt;</pre><p>&#23545;&#20110;&#20840;&#23616;&#20107;&#21153;&#65292;&#20320;&#33021;&#20351;&#29992;Spring&#20013;&#24120;&#35265;&#30340;&#20107;&#21153;&#26426;&#21046;&#26469;&#21010;&#20998;&#20107;&#21153;&#65292;
    &#24182;&#20197; <tt class="classname">JtaTransactionManager</tt> &#20026;&#21518;&#31471;(&#22996;&#25176;&#32473;&#21518;&#38754;&#30340;J2EE&#20998;&#24067;&#24335;&#20107;&#21153;&#21327;&#35843;&#31243;&#24207;)&#12290; 
</p><p>&#23545;&#20110;&#21333;&#29420;CCI  <tt class="interfacename">ConnectionFactory</tt> &#19978;&#30340;&#26412;&#22320;&#20107;&#21153;&#65292;
    Spring&#20026;CCI&#25552;&#20379;&#20102;&#19968;&#20010;&#19987;&#38376;&#30340;&#20107;&#21153;&#31649;&#29702;&#31574;&#30053;&#65292;
	&#31867;&#20284;&#20110;JDBC&#20013;&#30340; <tt class="classname">DataSourceTransactionManager</tt>&#65292;
	CCI API&#23450;&#20041;&#20102;&#19968;&#20010;&#26412;&#22320;&#20107;&#21153;&#23545;&#35937;&#21644;&#30456;&#24212;&#30340;&#26412;&#22320;&#20107;&#21153;&#21010;&#20998;&#26041;&#27861;&#12290;
	Spring&#30340; <tt class="classname">CciLocalTransactionManager</tt> &#25191;&#34892;&#36825;&#26679;&#30340;&#26412;&#22320;CCI&#20107;&#21153;&#65292;
	&#23436;&#20840;&#20381;&#29031;Spring&#20013;&#24120;&#35265;&#30340;  <tt class="interfacename">PlatformTransactionManager</tt>  &#25277;&#35937;&#12290; </p><pre class="programlisting">&lt;bean id="eciConnectionFactory" class="org.springframework.jndi.JndiObjectFactoryBean"&gt;
  &lt;property name="jndiName" value="eis/cicseci"/&gt;
&lt;/bean&gt;

&lt;bean id="eciTransactionManager"
    class="org.springframework.jca.cci.connection.CciLocalTransactionManager"&gt;
  &lt;property name="connectionFactory" ref="eciConnectionFactory"/&gt;
&lt;/bean&gt;</pre><p> 
			&#22768;&#26126;&#24335;&#25110;&#32534;&#31243;&#24335;&#30340;&#20107;&#21153;&#31574;&#30053;&#37117;&#33021;&#34987;&#29992;&#20110;&#20219;&#24847;&#30340;Spring&#20107;&#21153;&#21010;&#20998;&#21151;&#33021;&#12290;
			&#36825;&#26159;Spring&#36890;&#29992;&#30340; <tt class="interfacename">PlatformTransactionManager</tt> &#25277;&#35937;&#30340;&#32467;&#26524;&#65292;&#23427;&#35299;&#32806;&#20102;&#23454;&#38469;&#36816;&#34892;&#31574;&#30053;&#20013;&#30340;&#20107;&#21153;&#21010;&#20998;&#12290;
			&#20320;&#21487;&#20197;&#20445;&#25345;&#29616;&#22312;&#30340;&#20107;&#21153;&#21010;&#20998;&#65292;&#20165;&#20165;&#38656;&#35201;&#22312;  <tt class="classname">JtaTransactionManager</tt>  &#21644; <tt class="classname">CciLocalTransactionManager</tt> &#20043;&#38388;&#36716;&#25442;&#21363;&#21487;&#12290; 
		</p><p>&#26377;&#20851;Spring&#30340;&#20107;&#21153;&#26426;&#21046;&#65292;&#35831;&#21442;&#35265; <a href="transaction.html" title="Chapter&nbsp;9.&nbsp;&#20107;&#21153;&#31649;&#29702;">Chapter&nbsp;9, <i>&#20107;&#21153;&#31649;&#29702;</i></a> &#19968;&#31456;&#12290;</p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="jmx.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="pt04.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="mail.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;20.&nbsp;JMX&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;22.&nbsp;Spring&#37038;&#20214;&#25277;&#35937;&#23618;</td></tr></table></div><div xmlns="http://www.w3.org/TR/xhtml1/transitional" style="background-color:#31430f;border:none;height:50px;border:1px solid black;text-align:center"><table cellspacing="0" cellpadding="0" width="100%" style="margin: 0px; padding: 0px"><tr><td width="50%" style="font-size: 110%; color: white; vertical-align: center; text-align: right">
        				Sponsored by
        			</td><td width="50%" style="padding: 0px"><a style="border:none;background: url();" href="http://www.interface21.com/" title="Brought to you by Interface21"><img style="border: none" src="images/interface21.gif"></a></td></tr></table></div></body>
<!-- Mirrored from www.redsaga.com/spring_ref/2.0RC2/html/cci.html by HTTrack Website Copier/3.x [XR&CO'2005], Tue, 17 Oct 2006 16:56:40 GMT -->
</html>
